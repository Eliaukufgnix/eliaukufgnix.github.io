<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CSharp | Eliaukufgnix</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="我的个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.5ab8ebd7.css" as="style"><link rel="preload" href="/assets/js/app.3e89323d.js" as="script"><link rel="preload" href="/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/assets/js/10.4e92518d.js" as="script"><link rel="prefetch" href="/assets/js/11.136159a4.js"><link rel="prefetch" href="/assets/js/12.04d8f4fb.js"><link rel="prefetch" href="/assets/js/13.3911ca0f.js"><link rel="prefetch" href="/assets/js/3.7c0fc0d6.js"><link rel="prefetch" href="/assets/js/4.fc333d27.js"><link rel="prefetch" href="/assets/js/5.bfef3080.js"><link rel="prefetch" href="/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/assets/js/8.64f5a877.js"><link rel="prefetch" href="/assets/js/9.c6ac0550.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5ab8ebd7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Eliaukufgnix</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/前端笔记.html" class="nav-link">
  个人笔记
</a></div><div class="nav-item"><a href="/suanfa/算法.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="https://github.com/Eliaukufgnix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/前端笔记.html" class="nav-link">
  个人笔记
</a></div><div class="nav-item"><a href="/suanfa/算法.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="https://github.com/Eliaukufgnix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>后端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/后端.html" class="active sidebar-link">CSharp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#c-基础" class="sidebar-link">C#基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#常用数据类型" class="sidebar-link">常用数据类型</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#常用关键字" class="sidebar-link">常用关键字</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#枚举enum" class="sidebar-link">枚举enum</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#字符串操作" class="sidebar-link">字符串操作</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#时间操作" class="sidebar-link">时间操作</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#构造函数和析构函数" class="sidebar-link">构造函数和析构函数</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#异常" class="sidebar-link">异常</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#工作流" class="sidebar-link">工作流</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/后端.html#c-高级" class="sidebar-link">C#高级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#泛型" class="sidebar-link">泛型</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#反射" class="sidebar-link">反射</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#委托和委托链" class="sidebar-link">委托和委托链</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#事件" class="sidebar-link">事件</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#lambda表达式" class="sidebar-link">Lambda表达式</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#匿名类型" class="sidebar-link">匿名类型</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#扩展方法" class="sidebar-link">扩展方法</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#异步" class="sidebar-link">异步</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#多线程" class="sidebar-link">多线程</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#线程池" class="sidebar-link">线程池</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#task任务" class="sidebar-link">Task任务</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#异步编程async-await" class="sidebar-link">异步编程Async/Await</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/后端.html#web技术" class="sidebar-link">Web技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#模板语法" class="sidebar-link">模板语法</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#ado-net" class="sidebar-link">ADO.NET</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#asp-net" class="sidebar-link">ASP.NET</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#弹框并跳页" class="sidebar-link">弹框并跳页</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#response和request" class="sidebar-link">Response和Request</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#querystring传值" class="sidebar-link">QueryString传值</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#session" class="sidebar-link">Session</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#cache" class="sidebar-link">Cache</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#i-o读写" class="sidebar-link">I/O读写</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#fileupload" class="sidebar-link">FileUpload</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#json" class="sidebar-link">JSON</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#nuget" class="sidebar-link">Nuget</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#序列化与反序列化" class="sidebar-link">序列化与反序列化</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#xml" class="sidebar-link">XML</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#xpath表达式" class="sidebar-link">XPath表达式</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#远程访问类" class="sidebar-link">远程访问类</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#html解析库htmlagilitypack" class="sidebar-link">HTML解析库HtmlAgilityPack</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#类库" class="sidebar-link">类库</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#linq" class="sidebar-link">LINQ</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#orm对象关系映射" class="sidebar-link">ORM对象关系映射</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#ef的创建方式" class="sidebar-link">EF的创建方式</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#ienumerable、iqueryable、list" class="sidebar-link">IEnumerable、IQueryable、List</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#entityframework常用方法" class="sidebar-link">EntityFramework常用方法</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#递归算法" class="sidebar-link">递归算法</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#automapper" class="sidebar-link">AutoMapper</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#automapper实践" class="sidebar-link">AutoMapper实践</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#autofac" class="sidebar-link">AutoFac</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#手动创建entityframework6" class="sidebar-link">手动创建EntityFramework6</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#autocomplete" class="sidebar-link">AutoComplete</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#comet技术" class="sidebar-link">Comet技术</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#socket" class="sidebar-link">Socket</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#websocket" class="sidebar-link">WebSocket</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#singalr" class="sidebar-link">SingalR</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#sqldependency-signalr实现数据即时更新" class="sidebar-link">SqlDependency+SignalR实现数据即时更新</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#支付接口调用" class="sidebar-link">支付接口调用</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#富文本编辑器" class="sidebar-link">富文本编辑器</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#日志组件" class="sidebar-link">日志组件</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#npoi专业的excel导出组件" class="sidebar-link">NPOI专业的excel导出组件</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#swaggerui组件" class="sidebar-link">SwaggerUI组件</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#webuploader控件使用" class="sidebar-link">WebUploader控件使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/后端.html#c-框架" class="sidebar-link">C#框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#asp-net-mvc-介绍" class="sidebar-link">ASP.NET MVC 介绍</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#asp-net-mvc-项目创建" class="sidebar-link">ASP.NET MVC 项目创建</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#asp-net-webapi" class="sidebar-link">ASP.NET WebAPI</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#asp-net-core" class="sidebar-link">ASP.NET Core</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#webservice" class="sidebar-link">WebService</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/后端.html#设计思想" class="sidebar-link">设计思想</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#面向对象-oop" class="sidebar-link">面向对象（OOP）</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#控制反转-ioc" class="sidebar-link">控制反转（IOC）</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#依赖注入-di" class="sidebar-link">依赖注入（DI）</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#面向切面-aop" class="sidebar-link">面向切面（AOP）</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#领域驱动-ddd" class="sidebar-link">领域驱动（DDD）</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/后端.html#设计模式六大原则" class="sidebar-link">设计模式六大原则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#单一职责-single-responsibility-principle" class="sidebar-link">单一职责（Single Responsibility Principle）</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#开闭原则-open-closed-principle" class="sidebar-link">开闭原则（open closed principle）</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#里氏替换" class="sidebar-link">里氏替换</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#迪米特法则" class="sidebar-link">迪米特法则</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#接口隔离" class="sidebar-link">接口隔离</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#依赖倒置dependence-inversion-principle" class="sidebar-link">依赖倒置Dependence Inversion Principle</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/后端.html#设计模式" class="sidebar-link">设计模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/后端.html#mvc模式" class="sidebar-link">MVC模式</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#单例模式" class="sidebar-link">单例模式</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#代理模式" class="sidebar-link">代理模式</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#工厂模式" class="sidebar-link">工厂模式</a></li><li class="sidebar-sub-header"><a href="/blog/后端.html#抽象工厂模式" class="sidebar-link">抽象工厂模式</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="csharp"><a href="#csharp" class="header-anchor">#</a> CSharp</h1> <h2 id="c-基础"><a href="#c-基础" class="header-anchor">#</a> C#基础</h2> <h3 id="常用数据类型"><a href="#常用数据类型" class="header-anchor">#</a> 常用数据类型</h3> <h4 id="值类型和引用类型"><a href="#值类型和引用类型" class="header-anchor">#</a> 值类型和引用类型</h4> <p>值类型:栈中         int short long bool 枚举 struct double float</p> <p>引用类型:堆中     类  Object String 数组 接口 抽象类 委托  事件</p> <p>值类型（Value Types）包括：</p> <ol><li>整数类型（Integral Types）：例如 <code>int</code>、<code>short</code>、<code>byte</code>等。</li> <li>浮点数类型（Floating-Point Types）：例如 <code>float</code>、<code>double</code>。</li> <li>字符类型（Character Type）：<code>char</code>。</li> <li>布尔类型（Boolean Type）：<code>bool</code>。</li> <li>枚举类型（Enum Types）：通过定义一组命名的常量来创建自定义类型。</li> <li>结构体类型（Struct Types）：通过使用 <code>struct</code> 关键字定义，可以包含多个成员变量。</li> <li><code>decimal</code>，用于处理精确的十进制数。</li></ol> <p>引用类型（Reference Types）包括：</p> <ol><li>类类型（Class Types）：通过使用 <code>class</code> 关键字定义，是引用类型的基本形式。</li> <li>接口类型（Interface Types）：通过使用 <code>interface</code> 关键字定义，描述类具有的行为和功能。</li> <li>数组类型（Array Types）：包括一维数组、多维数组和交错数组。</li> <li>委托类型（Delegate Types）：通过使用 <code>delegate</code> 关键字定义，表示对方法的引用。</li> <li>字符串类型（String Type）：通过使用 <code>string</code> 关键字定义，表示一个字符串序列。</li></ol> <h4 id="装箱和拆箱"><a href="#装箱和拆箱" class="header-anchor">#</a> 装箱和拆箱</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Object</span> a<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>a<span class="token punctuation">;</span>
</code></pre></div><p>struct和类区别:struct是值类型，不能继承</p> <p>显示转换:string a=&quot;一百&quot;    int b=(int)a;   强制类型 Conver.toInt32(a)</p> <p>隐式转换:  int a=100 long b=a;</p> <h3 id="常用关键字"><a href="#常用关键字" class="header-anchor">#</a> 常用关键字</h3> <p><strong>修饰符：</strong></p> <p>pulic private protected  internal</p> <ol><li><code>public</code>（公共）：在任何地方都可以访问该成员，没有访问限制。</li> <li><code>private</code>（私有）：只有在同一类内部才能访问该成员，其他类无法直接访问。</li> <li><code>protected</code>（受保护）：只有在同一类内部或派生类中才能访问该成员，其他类无法直接访问。</li> <li><code>internal</code>（内部）：只有在相同的程序集（assembly）中才能访问该成员。不同的程序集中的代码无法直接访问。</li></ol> <p>static</p> <ol><li>静态方法不需要实例化可直接使用</li> <li>静态类中的成员和方法必须是静态的</li></ol> <h4 id="重载和重写"><a href="#重载和重写" class="header-anchor">#</a> 重载和重写</h4> <p>virtual虚方法，表示可以被重写override，重载</p> <ul><li>重写（override）用于重新定义基类的虚方法，实现运行时多态。</li> <li>重载（overload）用于在同一个类中创建具有相同名称但参数不同的方法，实现编译时多态。</li></ul> <p>sealed 不可继承</p> <h4 id="抽象类和接口"><a href="#抽象类和接口" class="header-anchor">#</a> 抽象类和接口</h4> <p>abstruct抽象类 抽象方法</p> <ul><li>无法实例化</li> <li>可以包含抽象方法</li> <li>可以包含实例方法</li> <li>子类继承和重写</li> <li>可以作为接口的替代</li></ul> <p>interface 接口</p> <p>概念：一组行为规范，包含一些抽象的成员。</p> <p>作用：1约束  2安全</p> <p>成员：事件  <strong>属性</strong> <strong>方法</strong>  索引器(允许你使用索引的方式调用类中的成员)</p> <p>使用：</p> <ol><li>接口不是直接进行调用的，需要让类进行继承的。</li> <li>接口中的所有成员都是public。</li> <li>当一个类继承接口后，需要实现接口中的<strong>所有</strong>抽象成员。</li></ol> <p>使用接口声明的类，都是安全的类</p> <p>接口的声明：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMyTest</span><span class="token punctuation">{</span>
  <span class="token comment">//4个抽象成员</span>
  <span class="token comment">//索引器</span>
　<span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
　<span class="token comment">//事件</span>
　<span class="token keyword">event</span> <span class="token class-name">EventHandler</span> E <span class="token punctuation">;</span>
　<span class="token comment">//方法</span>
　<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
　<span class="token comment">//属性</span>
　<span class="token return-type class-name"><span class="token keyword">string</span></span> P <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="readonly和const"><a href="#readonly和const" class="header-anchor">#</a> readonly和const</h4> <p>readonly只读修饰符和const常量修饰符</p> <ul><li><code>readonly</code> 用于修饰只读字段，字段值在初始化后不能被修改，每个实例都有自己的字段副本。</li> <li><code>const</code> 用于定义编译时常量，字段值在编译时就确定，不能被修改，属于类本身而不是实例。</li></ul> <p>using关键词</p> <p><strong>流程控制</strong>：if  else   else if for  do do while  while switch   foreach    break  continue</p> <h3 id="枚举enum"><a href="#枚举enum" class="header-anchor">#</a> 枚举enum</h3> <p>枚举类型是一种<strong>值类型</strong>，定义好的值会存放到栈中。</p> <p>枚举类型在定义时使用 enum 关键字表示，枚举类型的定义与类成员的定义是一样的，或者直接定义在命名空间中。</p> <p>定义枚举类型的变量的语法形式如下。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>访问修饰符 <span class="token keyword">enum</span> 变量名 <span class="token punctuation">:</span> 数据类型
<span class="token punctuation">{</span>
  值l<span class="token punctuation">,</span>
  值<span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><p>枚举的获取</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">TypeEnum</span>
<span class="token punctuation">{</span>
    男<span class="token punctuation">,</span>
    女
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>TypeEnum<span class="token punctuation">.</span>男<span class="token punctuation">;</span><span class="token comment">//输出0</span>
<span class="token punctuation">(</span>TypeEnum<span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//输出男</span>

<span class="token comment">//获取所有枚举成员</span>
<span class="token class-name">Array</span> list<span class="token operator">=</span> Enum<span class="token punctuation">.</span><span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">TypeEnum</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取所有枚举成员的字段名</span>
<span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> foo <span class="token operator">=</span> Enum<span class="token punctuation">.</span><span class="token function">GetNames</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Days</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="字符串操作"><a href="#字符串操作" class="header-anchor">#</a> 字符串操作</h3> <p>substring</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> <span class="token string">&quot;20230227001&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//substring</span>
<span class="token comment">//参数1：起始位置</span>
<span class="token comment">//参数2：长度(javascript中第二个参数是结束位置)  如果长度不指定，默认截取到尾部</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>indexOf</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//indexOf获得字符出现的索引位置</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token char">'2'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>lastIndexOf</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//lastIndexOf获得字符出现的最后一个索引位置</span>
<span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> <span class="token string">@&quot;D:\KeDa\KeDa\img\test.png&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> ename <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> idList <span class="token operator">=</span> <span class="token string">&quot;1,2,3,4,5,&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>remove</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//remove删除字符</span>
<span class="token comment">//参数1：删除的起始位置</span>
<span class="token comment">//参数2：删除的长度</span>
idList <span class="token operator">=</span> idList<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>idList<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1,2,3,4,5</span>
</code></pre></div><p>split</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//split拆串</span>
<span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr<span class="token operator">=</span>  idList<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//字符串的相加</span>
</code></pre></div><p>StringBuilder</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//StringBuilder可变长字符串类</span>
<span class="token class-name"><span class="token keyword">string</span></span> a <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> b <span class="token operator">=</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token operator">+</span><span class="token string">&quot;12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//张三李四</span>
<span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
stringBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//当你的字符串拼接个数超过3,4以上 需要使用stringbuilder</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>stringBuilder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Contains</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//Contains字符串包含fangfa</span>
<span class="token class-name"><span class="token keyword">string</span></span> x <span class="token operator">=</span> <span class="token string">&quot;128&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> y <span class="token operator">=</span> <span class="token string">&quot;8&quot;</span><span class="token punctuation">;</span>
x<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="时间操作"><a href="#时间操作" class="header-anchor">#</a> 时间操作</h3> <p>在 C# 中，可以通过以下两种方式获取当前的时间戳：</p> <ol><li>使用 DateTime.Now 属性和 TimeStamp 属性</li></ol> <p>DateTime.Now 属性返回当前日期和时间的值，可以使用其 TimeStamp 属性将其转换为 Unix 时间戳。</p> <p>示例代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">DateTime</span> now <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">long</span></span> timeStamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTimeOffset</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUnixTimeSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li>使用 DateTimeOffset.UtcNow 属性和 ToUnixTimeSeconds() 方法</li></ol> <p>DateTimeOffset.UtcNow 属性返回当前 UTC 日期和时间的值，可以使用其 ToUnixTimeSeconds() 方法将其转换为 Unix 时间戳。</p> <p>示例代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">DateTimeOffset</span> now <span class="token operator">=</span> DateTimeOffset<span class="token punctuation">.</span>UtcNow<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">long</span></span> timeStamp <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">ToUnixTimeSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>无论使用哪种方式，都会返回当前时间的 Unix 时间戳，以秒为单位。</p> <p>注意：在 C# 中，Unix 时间戳通常是从 1970 年 1 月 1 日 00:00:00 UTC 开始的秒数。</p> <h3 id="构造函数和析构函数"><a href="#构造函数和析构函数" class="header-anchor">#</a> 构造函数和析构函数</h3> <p>构造函数：与类同名，没有返回值修饰的,一个类有多个构造函数;初始化类成员;</p> <p>构造函数不能继承的；但是子类创建的时候会运行父类的构造函数。</p> <p>析构函数：垃圾回收，当类使用完成后会有GLC 将内存资源进行释放。高级语言析构函数都是GLC,GC。</p> <h3 id="异常"><a href="#异常" class="header-anchor">#</a> 异常</h3> <p>常见异常：空指针异常</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token keyword">catch</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
Finally<span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h3 id="工作流"><a href="#工作流" class="header-anchor">#</a> 工作流</h3> <p>工作流（Workflow）是指根据一定的规则和流程，将任务或活动按照特定的顺序组织、协调和执行的过程。它涉及到多个参与者之间的协同工作，并描述了每个参与者的角色、任务和关系。</p> <p>工作流通常包含以下几个要素：</p> <ol><li><p>任务（Task）：工作流中的基本单位，表示需要完成的工作单元或活动。</p></li> <li><p>参与者（Participant）：执行工作流中任务的个体或角色，可以是人员、系统或其他实体。</p></li> <li><p>规则（Rule）：定义工作流的执行顺序、条件和约束等，用于控制任务的流转和处理。</p></li> <li><p>数据（Data）：任务执行过程中所涉及的输入和输出数据，用于支持任务的完成。</p></li> <li><p>状态（State）：用于跟踪任务的执行状态，记录任务当前所处的阶段或进展情况。</p></li> <li><p>通知（Notification）：在任务执行过程中，向相关参与者发送通知或提醒，以促进任务的协作和沟通。</p></li> <li><p>异常处理（Exception Handling）：处理工作流中出现的异常情况，例如任务超时、失败或被拒绝等。</p></li></ol> <p>工作流可以应用于各种场景，包括业务流程管理、审批流程、订单处理、问题解决流程等等。通过使用工作流，可以提高工作效率、降低错误率，同时也能够将任务的执行过程可视化、可追踪，便于监控和管理。</p> <p>在实际应用中，可以利用工作流引擎或工作流管理系统来设计、模拟和执行工作流。这些工具可以提供图形化界面和自动化的支持，简化了工作流的建模、部署和监控过程。</p> <h2 id="c-高级"><a href="#c-高级" class="header-anchor">#</a> C#高级</h2> <p>LINQ</p> <h3 id="泛型"><a href="#泛型" class="header-anchor">#</a> 泛型</h3> <h4 id="什么是泛型-有什么作用"><a href="#什么是泛型-有什么作用" class="header-anchor">#</a> 什么是泛型？有什么作用？</h4> <p>泛型是程序设计语言的一种特性。允许程序员在强类型程序设计语言中编写代码时定义一些可变部分，那些部分在使用前必须作出指明。各种程序设计语言和其编译器、运行环境对泛型的支持均不一样。将类型参数化以达到代码复用提高软件开发工作效率的一种数据类型。泛型类是引用类型，是堆对象，主要是引入了类型参数这个概念。</p> <p>优点：
1.使用泛型类、方法，我们可以极大提高代码的重用性，不需要对类型不同代码相同（仅类型参数不同）的代码写多次。
2.创建泛型类，可在编译时创建类型安全的集合，存在泛型约束。
3.避免装箱和拆箱操作降低性能，在大型集合中装箱和拆箱的影响非常大。</p> <p>缺点：</p> <p>编写泛型类或者泛型方法的时候，不能获取未来某一个对象中的特殊的一个值</p> <h4 id="泛型的使用方式有哪几种"><a href="#泛型的使用方式有哪几种" class="header-anchor">#</a> 泛型的使用方式有哪几种？</h4> <p>泛型一般有三种使用方式:<strong>泛型类</strong>、<strong>泛型接口</strong>、<strong>泛型方法</strong>。</p> <h4 id="泛型约束"><a href="#泛型约束" class="header-anchor">#</a> <strong>泛型约束</strong></h4> <p>对我们泛型对象类型进行约束。不加约束数据类型太多了，一般对值类型和引用类型进行划分。使用泛型约束。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token keyword">struct</span>
类型参数必须是值类型。可以指定除 Nullable 以外的任何值类型。有关更多信息，请参见使用可以为 <span class="token keyword">null</span> 的类型（C# 编程指南）。
<span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token keyword">class</span>
类型参数必须是引用类型；这一点也适用于任何类、接口、委托或数组类型。
<span class="token keyword">where</span> <span class="token class-name">T</span>：<span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
类型参数必须具有无参数的公共构造函数。当与其他约束一起使用时，<span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 约束必须最后指定。
<span class="token keyword">where</span> <span class="token class-name">T</span>：<span class="token operator">&lt;</span>基类名<span class="token operator">&gt;</span>
类型参数必须是指定的基类或派生自指定的基类。
<span class="token keyword">where</span> <span class="token class-name">T</span>：<span class="token operator">&lt;</span>接口名称<span class="token operator">&gt;</span>
类型参数必须是指定的接口或实现指定的接口。可以指定多个接口约束。约束接口也可以是泛型的。
<span class="token keyword">where</span> <span class="token class-name">T</span>：U
为 T 提供的类型参数必须是为 U 提供的参数或派生自为 U 提供的参数。
</code></pre></div><h4 id="项目中哪里用到了泛型"><a href="#项目中哪里用到了泛型" class="header-anchor">#</a> 项目中哪里用到了泛型？</h4> <ul><li>自定义接口通用返回结果 <code>CommonResult&lt;T&gt;</code> 通过参数 <code>T</code> 可根据具体的返回类型动态指定结果的数据类型</li> <li>定义 <code>Excel</code> 处理类 <code>ExcelUtil&lt;T&gt;</code> 用于动态指定 <code>Excel</code> 导出的数据类型</li> <li>构建集合工具类（参考 <code>Collections</code> 中的 <code>sort</code>, <code>binarySearch</code> 方法）。</li> <li>......</li></ul> <h3 id="反射"><a href="#反射" class="header-anchor">#</a> 反射</h3> <h4 id="何为反射"><a href="#何为反射" class="header-anchor">#</a> 何为反射？</h4> <p>反射机制是在运行状态中，可以获取任意一个类的所有属性和方法，还可以调用这些方法和属性。这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。</p> <h4 id="反射机制优缺点"><a href="#反射机制优缺点" class="header-anchor">#</a> 反射机制优缺点</h4> <ul><li><strong>优点</strong> ： 可以让咱们的代码更加灵活、为各种框架提供开箱即用的功能提供了便利</li> <li><strong>缺点</strong> ：让我们在运行时有了分析操作类的能力，这同样也增加了安全问题。比如可以无视泛型参数的安全检查（泛型参数的安全检查发生在编译时）。另外，反射的性能也要稍差点，不过，对于框架来说实际是影响不大的。</li></ul> <h4 id="反射的应用场景"><a href="#反射的应用场景" class="header-anchor">#</a> 反射的应用场景</h4> <ol><li>获取类型  Type</li> <li>创建对象  Active.CreateInstace</li> <li>加载程序集Assembly</li> <li>获取成员信息（元数据，函数，属性</li> <li>调用方法属性</li></ol> <p>像咱们平时大部分时候都是在写业务代码，很少会接触到直接使用反射机制的场景。</p> <p>但是，这并不代表反射没有用。相反，正是因为反射，你才能这么轻松地使用各种框架。像 Spring/Spring Boot、MyBatis 等等框架中都大量使用了反射机制。</p> <p><strong>这些框架中也大量使用了动态代理，而动态代理的实现也依赖反射。</strong> <strong>注解</strong> 的实现也用到了反射。</p> <p>为什么你使用 Spring 的时候 ，一个<code>@Component</code>注解就声明了一个类为 Spring Bean 呢？为什么你通过一个 <code>@Value</code>注解就读取到配置文件中的值呢？究竟是怎么起作用的呢？</p> <p>这些都是因为你可以基于反射分析类，然后获取到类/属性/方法/方法的参数上的注解。你获取到注解之后，就可以做进一步的处理。</p> <h4 id="反射常用类"><a href="#反射常用类" class="header-anchor">#</a> 反射常用类</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code>System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>Assembly 
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>MemberInfo
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>EventInfo
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>MethodInfo
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>PropertyInfo
System<span class="token punctuation">.</span>Type
</code></pre></div><p>以下是上面几个类的使用方法：
（1）使用Assembly定义和加载程序集，加载在程序集清单中列出模块，以及从此程序集中查找类型并创建该类型的实例。
（2）使用Module了解包含模块的程序集以及模块中的类等，还可以获取在模块上定义的所有全局方法或其他特定的非全局方法。</p> <p>（3）使用ConstructorInfo了解构造函数的名称、参数、访问修饰符（如pulic 或private）和实现详细信息（如abstract或virtual）等。使用Type的GetConstructors或 GetConstructor方法来调用特定的构造函数。
（4）使用MethodInfo了解方法的名称、返回类型、参数、访问修饰符（如pulic 或private）和实现详细信息（如abstract或virtual）等。使用Type的GetMethods或GetMethod方法来调用特定的方法。
（5）使用PropertyInfo了解属性的名称、数据类型、声明类型、反射类型和只读或可写状态等，获取或设置属性值。
（6）使用ParameterInfo了解参数的名称、数据类型、是输入参数还是输出参数，以及参数在方法签名中的位置等。</p> <h3 id="委托和委托链"><a href="#委托和委托链" class="header-anchor">#</a> 委托和委托链</h3> <p>可以将方法当作参数传入到另一个方法中。</p> <p>语法：修饰符 delegate 返回值  名称(参数...)</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token keyword">void</span> 方法名<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Action</span> action1<span class="token operator">=</span>方法名<span class="token punctuation">;</span>
<span class="token comment">// 委托调用</span>
action1<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>作用：</p> <p>1委托中放入方法 使用委托进行调用</p> <p>2可以实现程序的解耦     低耦合</p> <p>3C#委托是异步的基础</p> <p><strong>理解委托</strong></p> <p>不适用委托会产生的问题</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Good Morning, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;早上好, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Language</span>
<span class="token punctuation">{</span>
    English<span class="token punctuation">,</span> Chinese
<span class="token punctuation">}</span>
<span class="token comment">//主程序</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Language</span> lang<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>lang<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">case</span> Language<span class="token punctuation">.</span>English<span class="token punctuation">:</span>
            <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Language<span class="token punctuation">.</span>Chinese<span class="token punctuation">:</span>
            <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>委托是一个类，它定义了方法的类型，使得可以将方法当作另一个方法的参数来进行传递，这种将方法动态地赋给参数的做法，可以避免在程序中大量使用if … else(Switch)语句，同时使得程序具有更好的可扩展性。</p> <p>1、无参无返回值</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Action</span> action1<span class="token operator">=</span>方法名<span class="token punctuation">;</span>
<span class="token comment">// 异步调用：回调函数也是一个委托</span>
<span class="token comment">//BeginInvoke()有三个参数</span>
<span class="token comment">//action1.BeginInvoke(方法原参数，回调函数，回调函数中传递参数);</span>
action1<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token keyword">null</span>，<span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2、有参无返回值</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Action<span class="token punctuation">&lt;</span>返回值类型<span class="token punctuation">&gt;</span></span> action2<span class="token operator">=</span>方法名<span class="token punctuation">;</span>
<span class="token comment">//action2.BeginInvoke(方法原参数，回调函数，回调函数中传递参数);</span>
action2<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token keyword">null</span>，<span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3、有参有返回值</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span>参数类型，返回值类型<span class="token punctuation">&gt;</span></span> action3<span class="token operator">=</span>方法名<span class="token punctuation">;</span>
<span class="token comment">//action3.BeginInvoke(方法原参数，回调函数，回调函数中传递参数);</span>
action3<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>t<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//EndInvoke函数句柄结束，意味着异步函数执行完毕</span>
    <span class="token class-name"><span class="token keyword">string</span></span> result<span class="token operator">=</span>action3<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>，<span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span>参数类型，返回值类型<span class="token punctuation">&gt;</span></span> action3<span class="token operator">=</span>方法名<span class="token punctuation">;</span>
<span class="token comment">//action3.BeginInvoke(方法原参数，回调函数，回调函数中传递参数);</span>
action3<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>t<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//EndInvoke函数句柄结束，意味着异步函数执行完毕</span>
    <span class="token class-name"><span class="token keyword">string</span></span> result<span class="token operator">=</span>action3<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>AsyncState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>，<span class="token string">&quot;Amdin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>多播委托（委托链）</strong></p> <p><strong>可以将多个方法赋给同一个委托，或者叫将多个方法绑定到同一个委托，当调用这个委托的时候，将依次调用其所绑定的方法。</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">GreetingDelegate</span> delegate1<span class="token punctuation">;</span>
    delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span> 
    delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>
    <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Liker&quot;</span><span class="token punctuation">,</span> delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：如果委托是有返回值的，那么我们只能拿到最后一个返回值。</p> <p>掌握:1声明四种不同类型的委托</p> <p>​         2能够使用委托进行任何方法的调用</p> <p>​         3理解委托解耦</p> <p>​          4多播委托（委托链）</p> <h3 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h3> <p><strong>事件是委托的一个实例，主要是为了保证委托的安全。</strong></p> <p><strong>它封装了委托类型的变量，使得：在类的内部，不管你声明它是public还是protected，它总是private 的。在类的外部，注册“+=”和注销“-=”的访问限定符与你在声明事件时使用的访问符相同</strong></p> <p><strong>声明一个事件不过类似于声明一个进行了封装的委托类型的变量而已</strong></p> <p>使用事件的目的：</p> <p>事件应该由事件发布者触发，而不应该由事件的客户端（客户程序）来触发。</p> <h3 id="lambda表达式"><a href="#lambda表达式" class="header-anchor">#</a> Lambda表达式</h3> <p>是一个匿名函数，没有名字的函数</p> <p>是一个语法糖，特殊的写法。</p> <p>读做gose to</p> <p>符号: =&gt;</p> <p>演化过程：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token class-name">LambdaClass</span> lc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LambdaClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始状态</span>
            <span class="token class-name">LambdaClass<span class="token punctuation">.</span>SayHandler</span> hander1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LambdaClass<span class="token punctuation">.</span>SayHandler</span><span class="token punctuation">(</span>
                
                <span class="token keyword">delegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//进化1</span>
            <span class="token class-name">LambdaClass<span class="token punctuation">.</span>SayHandler</span> hander2 <span class="token operator">=</span> <span class="token keyword">delegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//进化2  delegate去掉后 换上了一个新的符号 gose to  =&gt;</span>
            <span class="token class-name">LambdaClass<span class="token punctuation">.</span>SayHandler</span> hander3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> age<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//进化3</span>
            <span class="token class-name">LambdaClass<span class="token punctuation">.</span>SayHandler</span> hander4 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//进化4 如果匿名方法中只有一行代码 那么花括号可以省略</span>
            <span class="token class-name">LambdaClass<span class="token punctuation">.</span>SayHandler</span> hander5 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">hander5</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="匿名类型"><a href="#匿名类型" class="header-anchor">#</a> 匿名类型</h3> <p>没有类型修饰的一种类型，有类型，类型是通过上下文自动推测的。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> a<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> b<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> c<span class="token operator">=</span>a<span class="token operator">+</span>b<span class="token punctuation">;</span>
</code></pre></div><h3 id="扩展方法"><a href="#扩展方法" class="header-anchor">#</a> 扩展方法</h3> <p>可以向现有类型“添加”方法，而无需创建新的派生类型、重新编译或以其他方式修改原始类型。</p> <p>扩展方法的 3 个要求：</p> <ol><li>声明扩展方法的类必须声明为 <code>static</code>；</li> <li>扩展方法本身必须声明为<code>static</code>；</li> <li>扩展方法第一个参数类型前一定要包含关键字 <code>this</code>。</li></ol> <p>实例：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//原始方法</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMethod</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">double</span></span> d1<span class="token punctuation">,</span> d2<span class="token punctuation">,</span> d3<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MyMethod</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> i<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">double</span></span> j<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">double</span></span> k<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        d1 <span class="token operator">=</span> i<span class="token punctuation">;</span>
        d2 <span class="token operator">=</span> j<span class="token punctuation">;</span>
        d3 <span class="token operator">=</span> k<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">SumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> d1 <span class="token operator">+</span> d2 <span class="token operator">+</span> d3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//扩展方法</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MythodExtension</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">DivdMethods</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">MyMethod</span> md<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> md<span class="token punctuation">.</span><span class="token function">SumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//扩展方法调用</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">MyMethod</span> md <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyMethod</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> reslut <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">DivdMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 方法一调用</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0:f2}&quot;</span><span class="token punctuation">,</span> reslut<span class="token punctuation">)</span><span class="token punctuation">;</span>

    reslut <span class="token operator">=</span> MythodExtension<span class="token punctuation">.</span><span class="token function">DivdMethods</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  方法二调用</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0:f2}&quot;</span><span class="token punctuation">,</span> reslut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="异步"><a href="#异步" class="header-anchor">#</a> 异步</h3> <p><strong>并行</strong>，一般指并行计算，是说同一时刻有多条指令同时被执行，这些指令可能执行于同一CPU的多核上，或者多个CPU上，或者多个<strong>物理主机</strong>甚至多个网络中。</p> <p><strong>多线程</strong>，一般指同一进程中多个线程（包含其数据结构、上下文与代码片段）协作运行。在多核计算机中多个线程将有机会同时运行于多个核上，如果线程中进行的是计算，则行成并行计算。</p> <p><strong>异步</strong>，与同步相对应，是指呼叫另一操作后，不等待其结果，继续执行之后的操作，若之后没有其他操作，当前线程将进入睡眠状态，而CPU时间将有机会切至其他线程。在异步操作完成后通过回调函数的方式获取通知与结果。异步的实现方式有多种，如多线程与完成端口。多线程将异步操作放入另一线程中运行，通过轮询或回调方法得到完成通知；完成端口，由操作系统接管异步操作的调度，通过硬件中断，在完成时触发回调方法，此方式不需要占用额外线程。</p> <h4 id="异步特点"><a href="#异步特点" class="header-anchor">#</a> 异步特点</h4> <p>1异步不会造成阻塞，同步会阻塞</p> <p>2异步可以启用额外的线程去执行任务。</p> <p>3异步并不会缩短任务的时间</p> <h4 id="异步的优缺点"><a href="#异步的优缺点" class="header-anchor">#</a> 异步的优缺点</h4> <p>因为异步操作无须额外的线程负担，并且使用回调的方式进行处理，在设计良好的情况下，处理函数可以不必使用共享变量（即使无法完全不用，最起码可以减少 共享变量的数量），减少了死锁的可能。当然异步操作也并非完美无暇。编写异步操作的复杂程度较高，程序主要使用回调方式进行处理，与普通人的思维方式有些 出入，而且难以调试。</p> <h4 id="适用范围"><a href="#适用范围" class="header-anchor">#</a> 适用范围</h4> <p>1.在执行I/O操作时</p> <p>2.网络读写 调用接口</p> <p>3.数据库的操作</p> <p>4.WebService</p> <p>5.耗时操作</p> <p>对于需要长时间CPU运算的场合，图形处理，算法执行不适合使用异步。</p> <p>但是往往由于使用多线程编程的简单和符合习惯，所以很多人往往会使用线程来执行耗时较长的I/O操作，也导致很多人就误认为异步==多线程</p> <p><strong>总结</strong>：需要耗时操作的尽量都使用异步执行。</p> <h4 id="主线程等待异步结果-让异步阻塞"><a href="#主线程等待异步结果-让异步阻塞" class="header-anchor">#</a> <strong>主线程等待异步结果</strong>（让异步阻塞）</h4> <p>方式一：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> result<span class="token punctuation">.</span>AsyncWaitHandle<span class="token punctuation">.</span><span class="token function">WaitOne</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//线程一直等待</span>
</code></pre></div><p>方式二：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token comment">//判断异步结果是否结束</span>
     <span class="token punctuation">{</span>
         Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;请继续等待...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//类似进度条</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>方式三：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    method<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>主线程等待就相当于程序的阻塞。</p> <h3 id="多线程"><a href="#多线程" class="header-anchor">#</a> 多线程</h3> <p>异步是多线程的基础。</p> <p>异步是一种思想（抽象），多线程是一种技术，利用了异步的思想。</p> <p>异步：请别人帮我干一件事的思想。</p> <p>多线程：请律师帮我打官司这件事情。</p> <p>基本使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Thread</span> t<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 创建一个ThreadStart类型的委托</span>
<span class="token class-name">ThreadStart</span> ts<span class="token operator">=</span>ac<span class="token punctuation">.</span>Say<span class="token punctuation">;</span>
<span class="token comment">// 传递后调用</span>
<span class="token class-name">Thread</span> t<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">;</span>
t<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>线程的挂起</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>；
</code></pre></div><p>线程的阻塞</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Thread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>示例：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> th1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>DoSomething<span class="token punctuation">)</span><span class="token punctuation">;</span>
    th1<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    th1<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>阻塞后，各线程会依次执行。</p> <p>线程终止，不推荐使用，不安全不可控。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Thread<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>.Net的公用语言运行时（Common Language Runtime，CLR）能区分两种不同类型的线程：前台线程和后台线程。这两者的区别就是：应用程序必须运行完所有的前台线程才可以退出；而对于后台线程，应用程序则可以不考虑其是否已经运行完毕而直接退出，所有的后台线程在应用程序退出时都会自动结束。</p> <p>一般后台线程用于处理时间较短的任务，如在一个Web服务器中可以利用后台线程来处理客户端发过来的请求信息。而前台线程一般用于处理需要长时间等待的任务，如在Web服务器中的监听客户端请求的程序，或是定时对某些系统资源进行扫描的程序。</p> <p><strong>重要性</strong></p> <p><strong>（1）有前台，不关闭</strong>
如果线程为前台线程，可能导致UI线程已关闭，但实际还有前台线程暗地里运行，所以程序并没有真正关闭。
<strong>（2）无前台，全关闭</strong>
当然也要注意，如果所有前台线程都关闭，后台线程会自动关闭，后台线程的代码逻辑可能没执行完就终止了。</p> <p><strong>线程传递参数</strong></p> <p>1使用ParameterizedThreadStart委托</p> <p>注意：此处只能接受object类型参数，因为Thread中只接受ThreadStart委托，而该委托是一个无参无返回值的。所以此处使用ParameterizedThreadStart。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>     <span class="token class-name">ParameterizedThreadStart</span> pts1 <span class="token operator">=</span> DoSomething<span class="token punctuation">;</span>
     <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>pts1<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name"><span class="token keyword">object</span></span> name <span class="token operator">=</span> <span class="token string">&quot;线程参数&quot;</span><span class="token punctuation">;</span>
     thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div><p>2使用lambda传递参数(推荐)</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token class-name"><span class="token keyword">string</span></span> hi <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
 <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
 <span class="token punctuation">{</span>
     <span class="token function">DoSomething</span><span class="token punctuation">(</span>hi<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>线程异常</strong></p> <p><strong>注意:只要有线程抛出异常，整个程序就会停止。所以，异常必须处理。</strong></p> <p>对创建线程try catch没用，需要对线程中调用的函数添加异常处理代码</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token comment">// 无用的 try catch</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>SayHi<span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 不会打印错误</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//正确</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>SayHi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>线程安全</strong></p> <p>试试下列代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">Check</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> thread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">Check</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread2<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread2<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Check</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    User<span class="token punctuation">.</span>Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> format <span class="token operator">=</span> <span class="token string">@&quot;{0} = {1}&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> name<span class="token punctuation">,</span> User<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>张三等于了李四</p> <p>原因：User.Name是静态属性，也就是共享资源，多个线程访问共享资源，需要对共享资源做同步处理。</p> <p>如何解决：</p> <p>创建一个只读对象对对象处理使用lock（锁操作）</p> <p>基本含义:  lock就是把一段代码定义为临界区，所谓临界区就是同一时刻只能有一个线程来操作临界区的代码，当一个线程位于代码的临界区时，另一个线程不能进入临界区，如果   试图进入临界区，则只能一直等待（即被阻止），直到已经进入临界区的线程访问完毕，并释放锁旗标</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">object</span></span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">object</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// -------------------------</span>
<span class="token keyword">lock</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    User<span class="token punctuation">.</span>Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> format <span class="token operator">=</span> <span class="token string">@&quot;{0} = {1}&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> name<span class="token punctuation">,</span> User<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>多线程的缺点</strong></p> <p>1线程占用一定资源，比如内存，CPU；创建和销毁操作都比较昂贵</p> <p>2线程调度器要管理线程</p> <p>3大量的创建线程，导致内存不够用，线程调度器繁忙。</p> <p>4当多个线程竞争同一个静态资源时，会造成死锁。</p> <h3 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h3> <p>由于线程的创建和销毁时比较昂贵的操作，所以在ASP.NET中自己设定了一个线程池，由底层进行统一调配。</p> <p>线程池思想：事先创建好几个对象，需要就从池中分配，用完就返回池中</p> <p>注意：</p> <p>（1）线程池，只适合短时操作，不要阻塞线程池线程
（2）线程池，<strong>线程是后台线程</strong>
（3）线程池的线程数量有上限
（4）ASP.NET 使用自己的线程池</p> <p><strong>优缺点</strong></p> <p>（1）电脑的内存是有限的，每个线程，都会占用内存，如果并发数量很多，内存会爆掉。
（2）使用线程池，当并发超过一定数量，则会排队，所以，并行的请求处理时间会被延长。</p> <p>用法：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>ThreadPool<span class="token punctuation">.</span><span class="token function">QueueUserWorkItem</span><span class="token punctuation">(</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
 <span class="token punctuation">{</span>
      <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>多线程和异步的区别</strong></p> <p>多线程是对cpu剩余劳动力的压榨，是一种技术，强调的是并发。</p> <p>异步强调的是非阻塞，是一种编程模式（pattern），主要解决了UI响应被阻塞的问题，可借助线程技术或者硬件本身的计算能力解决。</p> <p>背景：作为一个北漂，准备结束北漂生涯，谋划如何搬家。其余家当都变买了，就剩下有一辆小轿车，和一辆摩托车需要带回家。</p> <ol><li><p>阻塞式编程：先开其中一辆回去，再回来开另一辆车回去。</p></li> <li><p>传统异步式编程：摩托车办理快递，我开汽车回去。注意，快递公司派件（回调）时我不一定已经开车到家，如果必须本人签收，就比较麻烦了。----此种通过回调进行异步编程的方式，没法编写符合思维顺序的代码。</p></li> <li><p>基于多线程的异步编程：我获得了瞬间移动的超能力（cpu计算速度提升），以毫秒级的速度在汽车与摩托车之间切换驾驶。汽车（主线程）上有车载电话，可以使用处理其它事情。----期间频繁的上下文切换，会造成额外的损耗，造成反应能力比较差，只能开到60迈。</p></li></ol> <p>4.并行编程：我获得了分身的超能力（多核cpu的出现），两个我同时开两辆车回家。----充分发挥了cpu的能力，没有额外切换上下文的损耗，精力充沛，在120的时速狂飙。</p> <h3 id="task任务"><a href="#task任务" class="header-anchor">#</a> Task任务</h3> <p><strong>任务是什么</strong></p> <p>System.Threading.Tasks.Task,任务代表了一个异步操作。</p> <p>任务非常强大，极大的简化了异步编程，并且能带来显著的性能提升。</p> <p>举个简单例子，执行一个操作，我们要查询两张表的数据，我们创建两个任务分别各自查询一张表，是不是快些呢？</p> <p><strong>任务的线程是后台线程</strong></p> <p><strong>本质上讲，任务就是一个线程池的增强版API</strong></p> <p><strong>线程池的缺点</strong></p> <p>1线程池获取结果并不方便</p> <p>2异步处理不方便</p> <p>3连续的异步操作不方便</p> <p>目的：</p> <p>场景1:3个并发请求，通过3个接口获取数据，我们希望得到所有接口的数据进行下一步业务处理。</p> <p>场景2:3个并发请求，只要其中某一个完成了，就触发一个事件结果。</p> <p><strong>任务的创建</strong></p> <p>1.构造函数创建</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// True 线程池线程</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>IsThreadPoolThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2.Task.Factory.StartNew创建</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Task<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">StartNew</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// True 线程池线程</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>IsThreadPoolThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：任务工厂模式下，任务会立即调用执行。</p> <p>3.不使用线程池设置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// False 不使用线程池</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>IsThreadPoolThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> TaskCreationOptions<span class="token punctuation">.</span>LongRunning<span class="token punctuation">)</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>获取任务返回值</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;此处为执行完成的结果&quot;</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>任务的回调</strong></p> <p>task.ContinueWith</p> <p>（1）支持1个 task 接多个ContinueWith
（2）ContinueWith返回下一代 task，下一代可以继续ContinueWith</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>  <span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;boy,&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Result <span class="token operator">+</span> <span class="token string">&quot;come on.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Task的线程等待和延续</p> <p>Task下的线程等待和延续主要有以下几类：</p> <p><strong>Wait</strong></p> <p>针对单个Task的实例，可以让某一个线程进入等待。</p> <p><strong>WaitAny</strong></p> <p>执行的所有线程中只要有一个线程结束，主线程就就执行，否则就卡住</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token class-name">Stopwatch</span> sw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Stopwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sw<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;开始了，当前主线程是:{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List<span class="token punctuation">&lt;</span>Task<span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Task<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Task</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;我是第一个任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;1号开始了，当前1号线程是:{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;1号任务执行完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            taskList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Task</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;我是第二个任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;2号开始了，当前2号线程是:{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;2号任务执行完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            taskList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Task</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;我是第三个任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;3号开始了，当前3号线程是:{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;3号任务执行完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            taskList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t1<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t2<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t3<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Task<span class="token punctuation">.</span><span class="token function">WaitAny</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;全部执行完成了,执行时间{0}，当前ID是：{1}&quot;</span><span class="token punctuation">,</span>sw<span class="token punctuation">.</span>ElapsedMilliseconds<span class="token punctuation">,</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>WatiAll</strong></p> <p>表示任务列表中所有的任务都已经结束后，主线程恢复。</p> <p><strong>WhenAny</strong></p> <p>表示任务列表中任何一个任务结束后，配合ContinueWith进行回调触发。</p> <p><strong>WhenAll</strong></p> <p>表示任务列表中所有任务都结束后，配合ContinueWith进行回调触发。</p> <p>注意：WhenAny和WhenAll,都是开启一个新线程执行，不卡顿主线程。</p> <p><strong>TaskFactory</strong></p> <p>TaskFactory可以开启线程，当然也对应的线程的等待和延续。</p> <p>ContinueWhenAny:等价于Task的WhenAny+ContinueWith</p> <p>ContinueWhenAll:等价于Task的WhenAll+ContinueWith</p> <p>1.ContinueWhenAny</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Task<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">ContinueWhenAny</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>m<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>2.ContinueWhenAll</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Task<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">ContinueWhenAll</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>m<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Task解决的问题：</p> <p>1.让异步编程更加简单，调用方法简单获取返回值简单</p> <p>2.提供了一些强化功能，异步编程的最大问题是：不可控</p> <p>Task让异步编程变的可控而且更加简化</p> <p>3.链式编程解决方案</p> <h3 id="异步编程async-await"><a href="#异步编程async-await" class="header-anchor">#</a> 异步编程Async/Await</h3> <p>async/await是C#5.0引入的一个关键词，其目的是让异步编程边的更加简洁，也是为了顺应异步编程的大趋势。</p> <p>功能：</p> <p>1使用async/await能简单的创建异步方法，异步方法可以防止耗时操作阻塞当前线程。</p> <p>2使用async/await来构建异步方法，更加简洁。</p> <p><strong>语法</strong></p> <p>① 方法使用async作为修饰符</p> <p>② 方法内部包含一个或者多个await表达式，表示可以异步完成的任务</p> <p>③ 必须具备以下三种返回类型 void 、Task 、<code>Task&lt;T&gt;</code> ,其中后两种的返回对象表示未来完成的工作，调用方法和异步方法可以继续执行。</p> <p>④异步方法的参数可以任意类型，但是不能为out和ref参数</p> <p>⑤约定俗成，一般异步方法都是以 Async作为后缀的。</p> <p>⑥ 除了方法之外，Lambda表达式和匿名函数也可以作为异步对象。</p> <p>如果在async中没有出现await，那么该方法就会变成一个同步方法。</p> <p><strong>异步方法的控制流</strong></p> <p>1首先第一个await之前的部分，这部分应该是少量且无需长时间等待的代码。</p> <p>2await表达式，表示需要被异步执行的任务，await可以有多个。</p> <p>3在await表达式之后出现的方法的其余代码。</p> <p>例子1：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">DoSomethingAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步方法同步部分1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">long</span></span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            sum <span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步执行部分1,线程ID：{0}&quot;</span><span class="token punctuation">,</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">long</span></span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    result <span class="token operator">+=</span> i<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步执行部分结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;计算结果{0}&quot;</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
</code></pre></div><p>例子2：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomethingAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Task</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步开始了,线程：{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">long</span></span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    result <span class="token operator">+=</span> i<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步结束，计算结果{0},线程{1}&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t1<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> t1<span class="token punctuation">;</span>
           

        <span class="token punctuation">}</span>
</code></pre></div><p><strong>async/await和普通异步的对比</strong></p> <p>思考：实现一个程序，每次任务休眠5秒后，返回100，打印100</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步方法开始1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> aaa<span class="token operator">=</span>  Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;计算结果{0}&quot;</span><span class="token punctuation">,</span>  aaa<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>调用：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
    <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>


</code></pre></div><p>解释：上述代码运行后，是同步执行的，虽然Task会异步产生一个线程运行，但是由于Task中的返回值需要使用aaa.result获取，阻塞了线程，所以运行结果是同步的。</p> <p>将上述代码改装为异步：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething111</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步方法开始1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//通过第一个异步方法得到结果</span>

           <span class="token class-name"><span class="token keyword">var</span></span> aaa<span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            aaa<span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>解释：由于Task.Run()返回的是一个Task对象，所以如果不希望阻塞线程，那么可以调用ContinueWith进行回调处理，在回调中获取Task的返回值，ContinueWith不会阻塞主线程。</p> <p>优雅的写法async/await</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">async</span>  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething111</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步方法开始1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//通过第一个异步方法得到结果</span>

           <span class="token class-name"><span class="token keyword">var</span></span> aaa<span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;结果是{0}&quot;</span><span class="token punctuation">,</span> aaa<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>解释：Task.Run()执行的是一个耗时任务，await标记表示等待任务结果，将结果赋值给aaa，没错，就是这么优雅。</p> <h2 id="web技术"><a href="#web技术" class="header-anchor">#</a> Web技术</h2> <h3 id="模板语法"><a href="#模板语法" class="header-anchor">#</a> 模板语法</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span><span class="token operator">%</span># <span class="token operator">%</span><span class="token operator">&gt;</span> 解析数据源模板，常用在Repeater、GridView组件中渲染数据源使用。
<span class="token operator">&lt;</span><span class="token operator">%=</span> <span class="token operator">%</span><span class="token operator">&gt;</span> 获取后台<span class="token punctuation">(</span><span class="token punctuation">.</span>aspx<span class="token punctuation">.</span>cs<span class="token punctuation">)</span>成员模板，获取后台属性、变量值、方法。
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token operator">&gt;</span>  在<span class="token punctuation">.</span>aspx文件中嵌入<span class="token punctuation">.</span>NET后端代码<span class="token punctuation">(</span>不推荐使用<span class="token punctuation">)</span>。
<span class="token operator">&lt;</span><span class="token operator">%</span>@<span class="token operator">%</span><span class="token operator">&gt;</span> 引用模板语法<span class="token punctuation">,</span>例如在前端页面引入程序集文件。
</code></pre></div><h3 id="ado-net"><a href="#ado-net" class="header-anchor">#</a> ADO.NET</h3> <p>概念：framework平台下提供的一个com组件，组件能够帮助我们对数据库进行读写操作。</p> <p>Connection数据连接类：连接数据库</p> <p>DataAdapter数据适配器：查询  删除  更新  添加</p> <p>DataSet数据容器:内存存储空间</p> <p>Command命令类：查询 删除 更新 添加   执行数据库存储过程</p> <p>DataReader流读取器：获取数据</p> <p>查询有两种方式：</p> <p>一、DataAdapter+DataSet     需要有一个内存空间DataSet  <strong>一次性</strong>注入到空间中的</p> <p>优点：不占用连接池的。</p> <p>缺点：需要有内存空间，当数据量大的时候，内存吃紧。</p> <p>压力给到程序了。</p> <p>二、Command+DataReader   挂到数据库上，我一条一条读。程序会占用数据库的连接池</p> <p>优点：不需要程序内存，效率高。</p> <p>缺点：占用数据库的连接池,会导致连接池溢出。</p> <p>实战场景：</p> <p>考虑是否大量并发</p> <p>1学生表  2W数据，绑定    一</p> <p>2天猫双11秒杀   瞬时访问量1000W  二</p> <p>连接字符串的两种写法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Data</span> Source<span class="token operator">=</span>DESKTOP<span class="token operator">-</span>EA5IP0C\\SQLEXPRESS<span class="token punctuation">;</span>DataBase<span class="token operator">=</span>KeDa2023<span class="token punctuation">;</span><span class="token class-name">Integrated</span> Security<span class="token operator">=</span>True<span class="token punctuation">;</span>
server<span class="token operator">=</span>DESKTOP<span class="token operator">-</span>EA5IP0C\\SQLEXPRESS<span class="token punctuation">;</span>uid<span class="token operator">=</span>sa<span class="token punctuation">;</span>pwd<span class="token operator">=</span>sa<span class="token punctuation">;</span>database<span class="token operator">=</span>xxxx<span class="token punctuation">;</span>
</code></pre></div><p>B/S方向下的框架：</p> <p>.NET</p> <p>ASP.NET WebForm</p> <p>ASP.NET MVC</p> <p>ASP.NET WebAPI</p> <p>ASP.NET Core MVC/WebAPI</p> <h4 id="web-config"><a href="#web-config" class="header-anchor">#</a> Web.config</h4> <h5 id="_1、连接字符串两种方式"><a href="#_1、连接字符串两种方式" class="header-anchor">#</a> 1、连接字符串两种方式</h5> <div class="language-xml extra-class"><pre class="language-xml"><code>Data Source=UFGNIX;DataBase=xxxx;Integrated Security=True;
server=DESKTOP-EA5IP0C\\SQLEXPRESS;uid=sa;pwd=sa;database=xxxx;
</code></pre></div><h5 id="_2、配置文件调用连接"><a href="#_2、配置文件调用连接" class="header-anchor">#</a> 2、配置文件调用连接</h5> <p>配置文件中添加。例如：Web.config文件中configuration下添加</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sqlserver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Data Source=UFGNIX;DataBase=user;Integrated Security=True;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>调用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString
</code></pre></div><h5 id="_3、配置跨域"><a href="#_3、配置跨域" class="header-anchor">#</a> 3、配置跨域</h5> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--配置跨域--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.webServer</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directoryBrowse</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>httpProtocol</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>customHeaders</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Access-Control-Allow-Origin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Access-Control-Allow-Headers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>customHeaders</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>httpProtocol</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.webServer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h4> <p>1、DataAdapter+DataSet 需要有一个内存空间DataSet <strong>一次性</strong>注入到空间中。</p> <p>优点：不占用数据库连接池。</p> <p>缺点：需要内存空间，数据量太大时，内存容量限制。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>SqlClient</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>

<span class="token comment">// DataAdapter+DataSet方式</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=UFGNIX;DataBase=user;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> 
 <span class="token class-name">SqlDataAdapter</span> sqlDataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select * from student&quot;</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 sqlDataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> row <span class="token keyword">in</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">)</span> 
 <span class="token punctuation">{</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2、Command+DataReader 逐条读取，程序会占用数据库连接池。</p> <p>优点：不需要程序内存，效率高。</p> <p>缺点：占用数据库连接池，会导致连接池溢出。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>SqlClient</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>

<span class="token comment">// SqlCommand+SqlDataReader方式</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=UFGNIX;DataBase=user;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;select * from student&quot;</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlDataReader</span> rdr <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>rdr<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>rdr<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=UFGNIX;DataBase=user;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;delete from student where id =22&quot;</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> flag<span class="token operator">=</span>cmd<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;delete success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="修改"><a href="#修改" class="header-anchor">#</a> 修改</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=UFGNIX;DataBase=user;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span> 
    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;update student set name='张三' where id= 20&quot;</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> flag<span class="token operator">=</span>cmd<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;update success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="添加"><a href="#添加" class="header-anchor">#</a> 添加</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=UFGNIX;DataBase=user;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;insert into student values('付慧涛',23,'河南省')&quot;</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> flag<span class="token operator">=</span>cmd<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;instert success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="asp-net"><a href="#asp-net" class="header-anchor">#</a> ASP.NET</h3> <p>.NET平台下的一个web研发的一个体系。</p> <p>.NET Framework</p> <p>.NET Core</p> <p>ASP.NET WebForm</p> <p>ASP.NET MVC/ASP.NET Core MVC</p> <p>ASP.NET WebApi/ASP.NET Core WebApi</p> <h4 id="asp-net-webform框架"><a href="#asp-net-webform框架" class="header-anchor">#</a> ASP.NET WebForm框架</h4> <p>目的：拯救微软老程序员 winform</p> <p>B/S框架</p> <p>1丰富的组件(不丰富,被时代淘汰)</p> <p>2前后端分离 （不是完全的前后端分离）</p> <p>3模板语法</p> <p>4特殊处理文件 一般处理程序</p> <p>5提供了母版页概念</p> <p>6页面首次加载机制：为了保证服务器的健康，默认在页面提交时，服务器不对客户端的修改行为进行响应。</p> <p>7用户控件：允许开发者自己创建自定义的控件，制作完成后可以直接在页面上使用。</p> <h4 id="webform下常用的组件"><a href="#webform下常用的组件" class="header-anchor">#</a> WebForm下常用的组件</h4> <p>VS2022 创建空网站：<a href="https://blog.csdn.net/qq_44249722/article/details/123053100?app_version=5.14.3&amp;code=app_1562916241&amp;csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22123053100%22%2C%22source%22%3A%22qq_44249722%22%7D&amp;uLinkId=usr1mkqgl919blen&amp;utm_source=app" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_44249722/article/details/123053100?app_version=5.14.3&amp;code=app_1562916241&amp;csdn_share_tail={&quot;type&quot;%3A&quot;blog&quot;%2C&quot;rType&quot;%3A&quot;article&quot;%2C&quot;rId&quot;%3A&quot;123053100&quot;%2C&quot;source&quot;%3A&quot;qq_44249722&quot;}&amp;uLinkId=usr1mkqgl919blen&amp;utm_source=app<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Repeater</strong></p> <p>OnItemCommand行点击事件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">Repeater</span> ID<span class="token operator">=</span><span class="token string">&quot;rptStudent&quot;</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span> OnItemCommand<span class="token operator">=</span><span class="token string">&quot;rptStudent_ItemCommand&quot;</span><span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>ItemTemplate<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%</span>#<span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%</span>#<span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%</span>#<span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%</span>#<span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">LinkButton</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span> ID<span class="token operator">=</span><span class="token string">&quot;Edit&quot;</span> CommandName<span class="token operator">=</span><span class="token string">&quot;Edit&quot;</span> Text<span class="token operator">=</span><span class="token string">&quot;编辑&quot;</span> CssClass<span class="token operator">=</span><span class="token string">&quot;btn btn-xs btn-primary&quot;</span> CommandArgument<span class="token operator">=</span>'<span class="token operator">&lt;</span><span class="token operator">%</span>#<span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span>'<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>LinkButton<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">LinkButton</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span> ID<span class="token operator">=</span><span class="token string">&quot;Del&quot;</span> CommandName<span class="token operator">=</span><span class="token string">&quot;Del&quot;</span> Text<span class="token operator">=</span><span class="token string">&quot;删除&quot;</span> CssClass<span class="token operator">=</span><span class="token string">&quot;btn btn-xs btn-danger&quot;</span> CommandArgument<span class="token operator">=</span>'<span class="token operator">&lt;</span><span class="token operator">%</span>#<span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span>'<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>LinkButton<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ItemTemplate<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>Repeater<span class="token operator">&gt;</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Page_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SqlDataAdapter</span> dataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select * from student&quot;</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将DataSet数据容器设置Repeater组件的数据源</span>
        rptStudent<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
        <span class="token comment">// 组件进行数据绑定</span>
        rptStudent<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>DropDownList</strong></p> <p><strong>RadioButtonList</strong></p> <p><strong>TextBox</strong></p> <p><strong>Button</strong></p> <p><strong>Label</strong></p> <p><strong>textarea</strong>文本域  没有Text属性，有Value属性</p> <p><strong>HiddenField</strong> 隐藏控件</p> <p><strong>FileUpLoad</strong>fileupload组件，文件上传组件</p> <h4 id="webform框架的生命周期"><a href="#webform框架的生命周期" class="header-anchor">#</a> WebForm框架的生命周期</h4> <p><strong>生命周期过程</strong></p> <p>1、请求页面：页请求发生在页生命周期开始之前。</p> <p>2、开始：在开始阶段，将设置页属性，如Request和Response。在此阶段，页还将确定请求是回发请求还是新请求，并设置IsPostBack属性。</p> <p>3、初始化页面：页面初始化期间，可以使用页中的控件，并将设置每个控件的UniqueID属性。如果当前请求是回发请求，则回发数据尚未加载，并且控件属性值尚未还原为视图状态中的值。</p> <p>4、加载页面：加载期间，如果当前请求是回发请求，则将使用从视图状态和控件状态恢复的信息加载控件属性。</p> <p>5、验证：在验证期间，将调用所有验证程序控件的Validate方法，此方法将设置各个验证程序控件和页的IsValid属性。</p> <p>6、回发事件处理：如果请求是回发请求，则将调用所有事件处理程序。</p> <p>7、呈现页面：在页面呈现期间，视图状态将被保存到页面，然后页面将调用每个控件，以将其呈现的输出提供给页的Response属性的OutputStream。</p> <p>8、卸载页面：完全呈现页、将页发送至客户端并准备丢弃时，将调用卸载。此时，将卸载页属性（如Response和Request）并执行清理。</p> <p><strong>生命周期的事件</strong></p> <p>1、PreInit</p> <p>使用该事件来执行下列操作：</p> <p>检查 IsPostBack 属性来确定是不是第一次处理该页。</p> <p>创建或重新创建动态控件。</p> <p>动态设置主控页。</p> <p>动态设置 Theme 属性。</p> <p>读取或设置配置文件属性值。</p> <p>注意：</p> <p>如果请求是回发请求，则控件的值尚未从视图状态还原。如果在此阶段设置控件属性，则其值可能会在下一事件中被重写。</p> <p>2、Init</p> <p>在所有控件都已初始化且已应用所有外观设置后引发。使用该事件来读取或初始化控件属性。</p> <p>3、InitComplete</p> <p>由 Page 对象引发。使用该事件来处理要求先完成所有初始化工作的任务。</p> <p>4、PreLoad</p> <p>如果需要在 Load 事件之前对页或控件执行处理，请使用该事件。</p> <p>在 Page 引发该事件后，它会为自身和所有控件加载视图状态，然后会处理 Request 实例包括的任何回发数据。</p> <p>5、Load</p> <p>Page 在 Page 上调用 OnLoad 事件方法，然后以递归方式对每个子控件执行相同操作，如此循环往复，直到加载完本页和所有控件为止。</p> <p>使用 OnLoad 事件方法来设置控件中的属性并建立数据库连接</p> <p>6、控件事件</p> <p>使用这些事件来处理特定控件事件，如 Button 控件的 Click 事件或 TextBox 控件的 TextChanged 事件。</p> <p>注意：</p> <p>在回发请求中，如果页包含验证程序控件，请在执行任何处理之前检查 Page 和各个验证控件的 IsValid 属性。</p> <p>7、LoadComplete</p> <p>对需要加载页上的所有其他控件的任务使用该事件。</p> <p>8、PreRender</p> <p>在该事件发生前：</p> <p>Page 对象会针对每个控件和页EnsureChildControls。</p> <p>设置了 DataSourceID 属性的每个数据绑定控件会调用 DataBind 方法。有关更多信息，请参见下面的数据绑定控件的数据绑定事件。</p> <p>页上的每个控件都会发生 PreRender 事件。使用该事件对页或其控件的内容进行最后更改。</p> <p>9、SaveStateComplete</p> <p>在该事件发生前，已针对页和所有控件保存了 ViewState。将忽略此时对页或控件进行的任何更改。</p> <p>使用该事件执行满足以下条件的任务：要求已经保存了视图状态，但未对控件进行任何更改。</p> <p>10、Render</p> <p>这不是事件；在处理的这个阶段，Page 对象会在每个控件上调用此方法。所有 <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">http://ASP.NET<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Web 服务器控件都有一个用于写出发送给浏览器的控件标记的 Render 方法。</p> <p>如果创建自定义控件，通常要重写此方法以输出控件的标记。不过，如果自定义控件只合并标准的 <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">http://ASP.NET<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Web 服务器控件，不合并自定义标记，则不需要重写 Render 方法。有关更多信息，请参见开发自定义 <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">http://ASP.NET<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 服务器控件。</p> <p>用户控件（.ascx 文件）自动合并呈现，因此不需要在代码中显式呈现该控件。</p> <p>11、Unload</p> <p>该事件首先针对每个控件发生，继而针对该页发生。在控件中，使用该事件对特定控件执行最后清理，如关闭控件特定数据库连接。</p> <p>对于页自身，使用该事件来执行最后清理工作，如：关闭打开的文件和数据库连接，或完成日志记录或其他请求特定任务。</p> <p>注意</p> <p>在卸载阶段，页及其控件已被呈现，因此无法对响应流做进一步更改如果尝试调用方法（如 Response.Write 方法），则该页将引发异常。</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL21tYml6LnFwaWMuY24vbW1iaXpfanBnLzZPeHFTcVdCcXNLTmI0eWREbFJaUTZpYTQ4M0ZxY2FFUUtpYWFHanNtQ01kZ1czd25vSGJqcWVpY1UxaWNZeE5RYzkxaFhyZTFNMlA2NjViRk9YYXRvb2NiUS8w?x-oss-process=image/format,png" alt="img"></p> <h4 id="用户控件ascx"><a href="#用户控件ascx" class="header-anchor">#</a> 用户控件ascx</h4> <p>户可按照自己需求进行控件的自定义开发。例如：三级联动控件。</p> <p>MyProvinceControl.ascx文件源码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span><span class="token operator">%</span>@ <span class="token class-name">Control</span> Language<span class="token operator">=</span><span class="token string">&quot;C#&quot;</span> AutoEventWireup<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> CodeBehind<span class="token operator">=</span><span class="token string">&quot;MyProvinceControl.ascx.cs&quot;</span> Inherits<span class="token operator">=</span><span class="token string">&quot;Goods.MyProvinceControl&quot;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">DropDownList</span> ID<span class="token operator">=</span><span class="token string">&quot;ddlProvince&quot;</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span> AutoPostBack<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> CssClass<span class="token operator">=</span><span class="token string">&quot; form-control&quot;</span> OnSelectedIndexChanged<span class="token operator">=</span><span class="token string">&quot;ddlProvince_SelectedIndexChanged&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>DropDownList<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">DropDownList</span> ID<span class="token operator">=</span><span class="token string">&quot;ddlCity&quot;</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span> AutoPostBack<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> CssClass<span class="token operator">=</span><span class="token string">&quot; form-control&quot;</span> OnSelectedIndexChanged<span class="token operator">=</span><span class="token string">&quot;ddlCity_SelectedIndexChanged&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>DropDownList<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">DropDownList</span> ID<span class="token operator">=</span><span class="token string">&quot;ddlDistrict&quot;</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span> CssClass<span class="token operator">=</span><span class="token string">&quot; form-control&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>DropDownList<span class="token operator">&gt;</span>
</code></pre></div><p>MyProvinceControl.ascx.cs文件源码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>SqlClient</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>UI<span class="token punctuation">.</span>WebControls</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Goods</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">MyProvinceControl</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>UI<span class="token punctuation">.</span>UserControl</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Page_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>IsPostBack<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// 页面加载时绑定省份</span>
                <span class="token function">InitProvince</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 页面加载时，给三个下拉框加一个默认值</span>
                ddlProvince<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ListItem</span><span class="token punctuation">(</span><span class="token string">&quot;--请选择--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlCity<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ListItem</span><span class="token punctuation">(</span><span class="token string">&quot;--请选择--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlDistrict<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ListItem</span><span class="token punctuation">(</span><span class="token string">&quot;--请选择--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 省份变化事件</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ddlProvince_SelectedIndexChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">InitCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ddlCity<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ListItem</span><span class="token punctuation">(</span><span class="token string">&quot;--请选择--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ddlDistrict<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ddlDistrict<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ListItem</span><span class="token punctuation">(</span><span class="token string">&quot;--请选择--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 城市变化事件</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ddlCity_SelectedIndexChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">InitDistrict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ddlDistrict<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ListItem</span><span class="token punctuation">(</span><span class="token string">&quot;--请选择--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitProvince</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;goodsmanage&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">SqlDataAdapter</span> sqlDataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select * from S_Province&quot;</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sqlDataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlProvince<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
                <span class="token comment">// 页面加载时，设置省份下拉框的文本值</span>
                ddlProvince<span class="token punctuation">.</span>DataTextField <span class="token operator">=</span> <span class="token string">&quot;ProvinceName&quot;</span><span class="token punctuation">;</span>
                ddlProvince<span class="token punctuation">.</span>DataValueField <span class="token operator">=</span> <span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">;</span>
                ddlProvince<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> pid <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>ddlProvince<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;goodsmanage&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">SqlDataAdapter</span> sqlDataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;select * from S_City where ProvinceID=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">pid</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sqlDataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlCity<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
                ddlCity<span class="token punctuation">.</span>DataTextField <span class="token operator">=</span> <span class="token string">&quot;CityName&quot;</span><span class="token punctuation">;</span>
                ddlCity<span class="token punctuation">.</span>DataValueField <span class="token operator">=</span> <span class="token string">&quot;CityID&quot;</span><span class="token punctuation">;</span>
                ddlCity<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitDistrict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> cid <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>ddlCity<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;goodsmanage&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">SqlDataAdapter</span> sqlDataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;select * from S_District where CityID=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cid</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sqlDataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlDistrict<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
                ddlDistrict<span class="token punctuation">.</span>DataTextField <span class="token operator">=</span> <span class="token string">&quot;DistrictName&quot;</span><span class="token punctuation">;</span>
                ddlDistrict<span class="token punctuation">.</span>DataValueField <span class="token operator">=</span> <span class="token string">&quot;DistrictID&quot;</span><span class="token punctuation">;</span>
                ddlDistrict<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Pid属性，方便外部调用该组件内部的值</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> DId
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//返回第三个下拉框的选中值</span>
                <span class="token keyword">return</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>ddlDistrict<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">set</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">int</span></span> did <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">int</span></span> cid <span class="token operator">=</span> <span class="token function">GetCId</span><span class="token punctuation">(</span>did<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">int</span></span> pid <span class="token operator">=</span> <span class="token function">GetPId</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 控件先加载数据</span>
                <span class="token function">InitProvince</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlProvince<span class="token punctuation">.</span>SelectedValue <span class="token operator">=</span> pid<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">InitCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlCity<span class="token punctuation">.</span>SelectedValue <span class="token operator">=</span> cid<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">InitDistrict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ddlDistrict<span class="token punctuation">.</span>SelectedValue <span class="token operator">=</span> did<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 通过区县id获取城市id</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetCId</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> did<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> cid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;goodsmanage&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;select * from S_District where DistrictId=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">did</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SqlDataReader</span> reader <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    cid <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;CityID&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> cid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 通过城市id获取省id</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetPId</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> cid<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;goodsmanage&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                conn<span class="token punctuation">.</span>Open <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;select * from S_City where CityID=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cid</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SqlDataReader</span> reader <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    pid <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> pid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="一般处理程序"><a href="#一般处理程序" class="header-anchor">#</a> 一般处理程序</h4> <p>aspx.cs后台窗体文件</p> <p>.ashx一般处理程序，特殊文件，阉割版的web窗体</p> <p>静态页：静态的网页没有功能，只有展示效果。通常来说是由UI设计或者前端工程师做的。</p> <p>套静态页</p> <h4 id="母版页"><a href="#母版页" class="header-anchor">#</a> 母版页</h4> <p>以.master为结尾的一种特殊文件。</p> <p>母版页无法运行，页面继承母版页运行。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">ContentPlaceHolder</span> ID<span class="token operator">=</span><span class="token string">&quot;head&quot;</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>ContentPlaceHolder<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>asp<span class="token punctuation">:</span><span class="token class-name">ContentPlaceHolder</span> ID<span class="token operator">=</span><span class="token string">&quot;ContentPlaceHolder1&quot;</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>asp<span class="token punctuation">:</span>ContentPlaceHolder<span class="token operator">&gt;</span>
</code></pre></div><p><strong>注意：</strong></p> <p>当页面继承母版页时，服务器控件的ID会被编译带上母版页的前缀</p> <p>所以此时，我们在前端获取ID标识的时候需要使用：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>$<span class="token punctuation">(</span><span class="token string">&quot;#&lt;%=txtName.ClientID%&gt;&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>没有前台页面文件，只有后台处理文件，所以.ashx 一般用来写接口文件。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Goods<span class="token punctuation">.</span>common</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Goods</span>
<span class="token punctuation">{</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Handler 的摘要说明</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHttpHandler</span></span>
    <span class="token punctuation">{</span>
        
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ProcessRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> pid <span class="token operator">=</span>Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span> context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>QueryString<span class="token punctuation">[</span><span class="token string">&quot;pid&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> cid <span class="token operator">=</span>Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span> context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>QueryString<span class="token punctuation">[</span><span class="token string">&quot;cid&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> SQLServerDbHelper<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;select CityID,CityName from S_City where ProvinceID=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">pid</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">string</span></span> str <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> dr <span class="token keyword">in</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    str <span class="token operator">+=</span> <span class="token string">&quot;{\&quot;CityID\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> dr<span class="token punctuation">[</span><span class="token string">&quot;CityID&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;,\&quot;CityName\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> dr<span class="token punctuation">[</span><span class="token string">&quot;CityName&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;},&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                str <span class="token operator">+=</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
                context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> cid <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> SQLServerDbHelper<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;select DistrictID,DistrictName from S_District where CityID=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cid</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">string</span></span> str <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> dr <span class="token keyword">in</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    str <span class="token operator">+=</span> <span class="token string">&quot;{\&quot;DistrictID\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> dr<span class="token punctuation">[</span><span class="token string">&quot;DistrictID&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;,\&quot;DistrictName\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> dr<span class="token punctuation">[</span><span class="token string">&quot;DistrictName&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;},&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                str <span class="token operator">+=</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
                context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">&amp;&amp;</span>cid<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> SQLServerDbHelper<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">&quot;select ProvinceID,ProvinceName from S_Province&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">string</span></span> str <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> dr <span class="token keyword">in</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    str <span class="token operator">+=</span> <span class="token string">&quot;{\&quot;ProvinceID\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> dr<span class="token punctuation">[</span><span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;,\&quot;ProvinceName\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> dr<span class="token punctuation">[</span><span class="token string">&quot;ProvinceName&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;},&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                str <span class="token operator">+=</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
                context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsReusable
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="弹框并跳页"><a href="#弹框并跳页" class="header-anchor">#</a> 弹框并跳页</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;script&gt;alert('修改成功！');window.location.href='ArticleList.aspx';&lt;/script&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="response和request"><a href="#response和request" class="header-anchor">#</a> Response和Request</h3> <p>**Request：**用户在client使用Web浏览器向Web应用程序发出请求时，会将client信息发给server。server收到一个HTTP请求，包括了全部查询字符串參数或表单參数、Cookie数据以及浏览器信息。</p> <p>在asp.net中执行时把这些请求信息封装成Requset对象。</p> <p><strong>Response</strong>:封装了Webserver对client请求的响应，用来操作HTTP对应信息，将结果返回给请求者。</p> <p>Request和Response都有非常多属性和方法。初识阶段仅仅重点会用Response对象的Redirect和Write方法。Request对象的Form和QueryString集合。</p> <h3 id="querystring传值"><a href="#querystring传值" class="header-anchor">#</a> QueryString传值</h3> <p>语法：</p> <p>?key=value</p> <p>?key=value&amp;key=value.....</p> <h3 id="session"><a href="#session" class="header-anchor">#</a> Session</h3> <p>Session用于存储特定的用户会话所需的信息 。 Session对象的引入是为了弥补HTTP协议的不足，HTTP协议是一种无状态的协议。</p> <p>Session中文是“会话”的意思，在ASP.NET中代表了服务器与客户端之间的“会话”。Session的作用时间从用户到达某个特定的Web页开始，到该用户离开Web站点，或在程序中利用代码终止某个Session结束。引用Session 则可以让一个用户访问多个页面之间的切换也会保留该用户的信息。</p> <p>系统为<strong>每个</strong>访问者都设立一个<strong>独立</strong>的Session对象，用以存储Session变量，并且各个访问者的Session对象互不干扰。</p> <p>特点：</p> <p>1存储在服务器上的</p> <p>2session在浏览器不关闭的情况下 都可以获取的</p> <p>缺点：</p> <p>1.存储在服务器上的 所以对服务器有负载损耗，不适合存大量的数据</p> <p>2.Session容易出现丢失（windows）</p> <p><strong>语法</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//写入</span>
Session<span class="token punctuation">[</span><span class="token string">&quot;UserName&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;joye888&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//读取</span>
<span class="token class-name"><span class="token keyword">var</span></span> userName <span class="token operator">=</span> Session<span class="token punctuation">[</span><span class="token string">&quot;UserName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//遍历</span>
<span class="token class-name">IEnumerator</span> sessionEnum <span class="token operator">=</span> Session<span class="token punctuation">.</span>Keys<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>sessionEnum<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>Session<span class="token punctuation">[</span>sessionEnum<span class="token punctuation">.</span>Current<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token comment">//销毁</span>
Session<span class="token punctuation">.</span><span class="token function">Abandon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//结束会话</span>
Session<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不结束会话</span>
</code></pre></div><p><strong>配置节点语法</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sessionState</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Off|InProc|StateServer|SQLServer<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">cookieless</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true|false<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number of minutes<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">stateConnectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tcpip=server:port<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">sqlConnectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sql connection string<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">stateNetworkTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number of seconds<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>mode</strong>:设置将Session信息存储到哪里</p> <p>​    Off：不使用Session功能；</p> <p>​    InProc :将Session存储在IIS进程内，这是默认值,也最常用（优点是简单，性能最高。但是当重启IIS服务器时Session丢失。）；</p> <p>​    StateServer ：将Session存储在ASP.NET状态服务进程中（重新启动Web应用程序时保留会话状态，并使会话状态可以用于网络中的多个Web服务器。）；</p> <p>​    SQLServer ：将Session存储在SQL Server中（存储在内存和磁盘中，服务器挂掉重启后都还在）。</p> <p><strong>cookieless</strong>：设置客户端的Session信息存储到哪里</p> <p>​    true 使用Cookieless模式；这时客户端的Session信息就不再使用Cookie存储了，而是将其通过URL存储。</p> <p>​    false 使用Cookie模式，这是默认值。</p> <p><strong>timeout</strong> 设置经过多少分钟后服务器自动放弃Session信息。默认为20分钟。</p> <p>stateConnectionString 设置将Session信息存储在状态服务中时使用的服务器名称和端口号，例如：&quot;tcpip=127.0.0.1:42424”。当mode的值是StateServer是，这个属性是必需的。（默认端口42424）。</p> <p>sqlConnectionString 设置与SQL Server连接时的连接字符串。例如&quot;data source=localhost;Integrated Security=SSPI;Initial Catalog=joye&quot;。当mode的值是SQLServer时，这个属性是必需的。</p> <p>stateNetworkTimeout 设置当使用StateServer模式存储Session状态时，经过多少秒空闲后，断开Web服务器与存储状态信息的服务器的TCP/IP连接的。默认值是10秒钟。</p> <p><strong>配置MSSQL中存储Session</strong></p> <p>步骤1：</p> <p>打开cmd，输入cd C:\Windows\Microsoft.NET\Framework\v4.0.30319</p> <p>步骤2：</p> <p>然后输入aspnet_regsql.exe -ssadd -sstype p -S SQLEXPRESS -U 账号 -P 密码 来创建数据库</p> <p>步骤3:</p> <p>在&lt;system.web&gt;节点下配置状态连接串</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sessionState</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SQLServer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlConnectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server=WIN-A8APBAUAJ7J\SQLEXPRESS;uid=sa;pwd=sa;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sessionState</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>特点：浏览器关闭后，Session不会丢失。</p> <h3 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h3> <p><a href="https://so.csdn.net/so/search?q=Cookie&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Cookie<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一小段文本信息，伴随着用户请求和页面在web服务器和浏览器之间传递，Cookie包含每次用户访问站点时web应用程序读可以读取信息。</p> <p>Cookie 帮助网站存储有关访问者的信息。一般来说，Cookie 是一种保持 Web 应用程序连续性（即执行状态管理）的方法。</p> <p>Cookie存储在客户端磁盘上</p> <p><strong>Cookie的属性</strong></p> <p>name：Cookie的名称，Cookie一旦创建，名称便不可更改
value：Cookie的值，如果值为Unicode字符，需要为字符编码。如果为二进制数据，则需要使用BASE64编码
expires： 有效期
secure：该Cookie是否仅被使用安全协议传输。安全协议。安全协议有HTTPS，SSL等，在网络上传输数据之前先将数据加密。默认为false。
path：Cookie的使用路径。如果设置为“/sessionWeb/”，则只有contextPath为“/sessionWeb”的程序可以访问该Cookie。如果设置为“/”，则本域名下contextPath都可以访问该Cookie。注意最后一个字符必须为“/”。
domain：可以访问该Cookie的域名。如果设置为“.google.com”，则所有以“google.com”结尾的域名都可以访问该Cookie。注意第一个字符必须为“.”。</p> <h3 id="cache"><a href="#cache" class="header-anchor">#</a> Cache</h3> <blockquote><p>Cache存储器，<a href="https://baike.baidu.com/item/%E7%94%B5%E8%84%91/124859" target="_blank" rel="noopener noreferrer">电脑<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中为<a href="https://baike.baidu.com/item/%E9%AB%98%E9%80%9F%E7%BC%93%E5%86%B2%E5%AD%98%E5%82%A8%E5%99%A8/9027270" target="_blank" rel="noopener noreferrer">高速缓冲存储器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，是位于<a href="https://baike.baidu.com/item/CPU/120556" target="_blank" rel="noopener noreferrer">CPU<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://baike.baidu.com/item/%E4%B8%BB%E5%AD%98%E5%82%A8%E5%99%A8/10635399" target="_blank" rel="noopener noreferrer">主存储器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>DRAM（Dynamic Random Access Memory）之间，规模较小，但速度很高的存储器，通常由<a href="https://baike.baidu.com/item/SRAM/7705927" target="_blank" rel="noopener noreferrer">SRAM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（Static Random Access Memory <a href="https://baike.baidu.com/item/%E9%9D%99%E6%80%81%E5%AD%98%E5%82%A8%E5%99%A8/6797116" target="_blank" rel="noopener noreferrer">静态存储器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）组成。</p></blockquote> <p>ASP.NET、Servlet构建的都是动态页面技术，所谓动态页面技术就是我们的网页内容是经由数据源获取数据，经过一系列逻辑处理后，最终变成一些HTML代码展示给客户端，而计算过程中是有成本的。</p> <p>当数据量变大或者访问量变大时，这些无谓的成本就会越来越高。而有些数据并不是无时无刻不在变化的，如果我们可以将结果缓存起来，那么将极大的提高我们程序的性能。</p> <p><strong>ASP.NET Cache</strong></p> <p>framework平台为了方便我们访问Cache，在httpRuntime类中加入了一个静态属性Cache。另外在ASP.NET中还提供了另一种方便的访问缓存方式：Page.Cache.HttpContext.Cache。通过上述二者，我们可以非常方便的使用Cache。</p> <p><strong>Cache常见用法</strong></p> <p>基本用法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>HttpRuntime<span class="token punctuation">.</span>Cache<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span>
HttpRuntime<span class="token punctuation">.</span>Cache<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span>缓存依赖<span class="token punctuation">,</span>绝对过期，滑动过期时间<span class="token punctuation">)</span>    
</code></pre></div><p><strong>参数解析</strong></p> <p><em>key</em></p> <p>用于引用该项的缓存键。</p> <p><em>value</em></p> <p>要添加到缓存的项。</p> <p><em>dependencies</em></p> <p>该项的文件依赖项或缓存键依赖项。当任何依赖项更改时，该对象即无效，并从缓存中移除。如果没有依赖项，则此参数包含空引用（Visual Basic 中为 <strong>Nothing</strong>）。</p> <p><em>absoluteExpiration</em></p> <p>所添加对象将过期并被从缓存中移除的时间。</p> <p><em>slidingExpiration</em></p> <p>最后一次访问所添加对象时和该对象过期时之间的时间间隔。如果该值等效于 20 分钟，则对象在最后一次被访问 20 分钟之后将过期并从缓存中移除。</p> <p><em>priority</em></p> <p>对象的相对成本，由 CacheItemPriority 枚举表示。缓存在退出对象时使用该值；具有较低成本的对象在具有较高成本的对象之前被从缓存移除。</p> <p><em>onRemoveCallback</em></p> <p>在从缓存中移除对象时所调用的委托（如果提供）。当从缓存中删除应用程序的对象时，可使用它来通知应用程序。</p> <p><strong>缓存项过期时间</strong></p> <p>ASP.NET支持二种缓存项的过期策略：绝对过期和滑动过期。</p> <p>一、绝对过期，这个容易理解：就是在缓存放入Cache时，指定一个具体的时间。当时间到达指定的时间的时，缓存项自动从Cache中移除。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//绝对过期设置</span>
 HttpRuntime<span class="token punctuation">.</span>Cache<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">.</span><span class="token function">AddMinutes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TimeSpan<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>二、滑动过期：某些缓存项，我们可能只希望在有用户在访问时，就尽量保留在缓存中，只有当一段时间内用户不再访问该缓存项时，才移除它， 这样可以优化内存的使用，因为这种策略可以保证缓存的内容都是【很热门】的。 操作系统的内存以及磁盘的缓存不都是这样设计的吗？而这一非常有用的特性，Cache也为我们准备好了，只要在将缓存项放入缓存时， 指定一个滑动过期时间就可以实现了。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//滑动过期设置</span>
HttpRuntime<span class="token punctuation">.</span>Cache<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>MaxValue<span class="token punctuation">,</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>缓存依赖Dependency</strong></p> <p>ASP.NET Cache有个很强大的功能，那就是缓存依赖。一个缓存项可以依赖于另一个缓存项。 即当依赖的值改变是缓存也改变。</p> <p>一、文件依赖</p> <p>当我们创建CacheDependency依赖类关联一个文件时，当文件内容发生改变，则缓存消失。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">CacheDependency</span> cacheDependency<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CacheDependency</span><span class="token punctuation">(</span><span class="token string">@&quot;C:\Users\Administrator\source\repos\KeDa2018\hello.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
HttpRuntime<span class="token punctuation">.</span>Cache<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> cacheDependency<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>二、数据库依赖SqlCacheDependency</p> <p>我们的服务器性能损耗主要是发生在查询数据库的时候，所以对数据库的缓存还是显得特别重要，数据如果不变化，用户就一直从缓存中取数据，一旦数据变化，系统能自动更新缓存中的数据，从而让用户得到更好的用户体验。</p> <p>第一步：修改web.config，让项目启用SqlCacheDependency</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token comment">&lt;!--
  有关如何配置 ASP.NET 应用程序的详细信息，请访问
  http://go.microsoft.com/fwlink/?LinkId=169433
  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caching</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlCacheDependency</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pollTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>6000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databases</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>codematic<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionStringName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>strcodematic<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databases</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sqlCacheDependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caching</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span>  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>strcodematic<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server=.;database=test;uid=sa;pwd=123<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>第二步：执行下述命令，为 数据库启用缓存依赖。</p> <p>aspnet_regsql.exe工具位于Windows\Microsoft.NET\Framework\[版本]文件夹中。</p> <p>如：(C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319)</p> <p>aspnet_regsql -C &quot;data source=DESKTOP-EA5IP0C\SQLEXPRESS;initial catalog=KeDa2023;user id=sa;password=sa&quot; -ed -et -t &quot;dbo.StudentInfo&quot;</p> <p>参数-C后面的字符串是连接字符串（请替换成自己所需要的值），</p> <p>参数-t后面的字符串是数据表的名字。</p> <p>生产成功后，在对应的数据库，会多一个表dbo.AspNet_SqlCacheTablesForChangeNotification</p> <p><strong>注意：</strong></p> <p>要使得7.0或者2000版本以上的SQLServer支持SqlCacheDependency特性，需要对数据库服务器执行相关的配置。</p> <p>有两种方法配置SQLServer：</p> <p>一使用aspnet_regsql命令行工具，</p> <p>二使用SqlCacheDependencyAdmin类。</p> <p>例如：</p> <p>aspnet_regsql -S &quot;server&quot;-E -d &quot;database&quot;–ed  或者</p> <p>aspnet_regsql -S &quot;server&quot;-E -d &quot;database&quot;-et -t &quot;table&quot;
　　如果是Sql验证的话要把-E换成，-U (用户名),-P (密码)</p> <p>第三步：在代码中使用缓存，并为其设置SqlCacheDependency依赖</p> <h3 id="i-o读写"><a href="#i-o读写" class="header-anchor">#</a> I/O读写</h3> <p>I/O指输入输出，通俗的讲就是使用.Net Framework类库对计算机本地的文件进行读写操作。</p> <p>C#读取文件需要五个步骤：</p> <p>1创建文件流</p> <p>2创建阅读器或写入器</p> <p>3执行读写操作</p> <p>4关闭阅读器或写入器</p> <p>5关闭文件流</p> <p><strong>创建文件流</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token class-name">FileStream</span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;c:\\a.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//打开方式</span>
<span class="token comment">//1:Create  用指定的名称创建一个新文件,如果文件已经存在则改写旧文件</span>
<span class="token comment">//2:CreateNew 创建一个文件,如果文件存在会发生异常,提示文件已经存在</span>
<span class="token comment">//3:Open 打开一个文件 指定的文件必须存在,否则会发生异常</span>
<span class="token comment">//4:OpenOrCreate 打开一个文件,如果文件不存在则用指定的名称新建一个文件并打开它.</span>
<span class="token comment">//5:Append 打开现有文件,并在文件尾部追加内容.</span>
</code></pre></div><p><strong>创建写入器/读取器</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">StreamWriter</span> mySw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span>
<span class="token class-name">StreamReader</span> streamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>读示例：</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">FileStream</span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;c:\\a.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StreamReader</span> streamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> str <span class="token operator">=</span> streamReader<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
     <span class="token keyword">break</span><span class="token punctuation">;</span>
     Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
streamReader<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileStream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>写示例:</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">FileStream</span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;c:\\&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileStream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>.NET框架库中提供了一个File类和Directory类这两个类是<strong>静态的</strong>，使用时直接使用类名调用。</p> <p><strong>File类常用方法</strong></p> <table><thead><tr><th>返回类型</th> <th>方法名称</th> <th>说明</th></tr></thead> <tbody><tr><td>bool</td> <td>Exists(&quot;路径&quot;)</td> <td>用于检查指定文件是否存在</td></tr> <tr><td>void</td> <td>copy(&quot;原路径&quot;,&quot;新路径&quot;)</td> <td>将指定的文件复制到目标地址,如果原文件不存在 则创建一个新的后再复制</td></tr> <tr><td>void</td> <td>Move(&quot;原路径&quot;,&quot;新路径&quot;)</td> <td>将原文件移到新路径</td></tr> <tr><td>void</td> <td>Delete(&quot;路径&quot;)</td> <td>删除指定的文件如果源文件不存在,则发生异常</td></tr></tbody></table> <p><strong>Directory类</strong></p> <table><thead><tr><th>返回值类型</th> <th>方法名称</th> <th>说明</th></tr></thead> <tbody><tr><td>bool</td> <td>Exists(&quot;路径&quot;)</td> <td>检查指定文件夹是否存在</td></tr> <tr><td>void</td> <td>Move(&quot;原路径&quot;,&quot;新路径&quot;)</td> <td>将文件或者目录移动到新的位置</td></tr> <tr><td>void</td> <td>Delete(&quot;路径&quot;,true/false)</td> <td>删除指定的目录,如果第二个参数为true则目录里面的所有目录内容</td></tr></tbody></table> <p>CreateDirectory    创建文件夹</p> <p>练习：</p> <p>1去数据库中随便找一个表，将表中的数据写入一个文本文档，写入文档根据当前的日期创建一个文件夹。</p> <p>S_Province   province.txt    20230327</p> <p>1）先查询数据库S_Province</p> <p>2）创建一个日期文件夹</p> <p>3）DataSet中的数据逐行写入到一个.txt文件中 FileModel.Create</p> <p>2将文本文档中的数据，写到到数据库中添加这些数据。</p> <p>Student表 Name</p> <p>1)读取.txt文件，然后将读取到的数据</p> <p>2）insert到数据库中</p> <h3 id="fileupload"><a href="#fileupload" class="header-anchor">#</a> <strong>FileUpload</strong></h3> <p>文件上传控件</p> <p>FileUpload</p> <p>使用控件进行图片上传</p> <p>使用原生form表单进行文件上传</p> <p>1.所谓相对路径就是在同一个网站下，不同文件之前的位置，我们都知道图片在<a href="https://so.csdn.net/so/search?q=%E6%A0%B9%E7%9B%AE%E5%BD%95&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">根目录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下面的images文件夹里面，在images文件夹里面假如有一个1.jpg图片，如果我们想在网站中引用图片的话，我们该怎么写呢，相信很多人都会<code>&lt;img src=&quot;./笔记文档/a.jpg&quot; alt=&quot;a&quot;/&gt;</code>这样写。</p> <p>2.所谓绝对路径，就是指完整的路径，我们要做到图标的相对位置，也就是从c盘开始找就是绝对位置。我们可以用这个图标进行图片显示，别人如果想看到就要用绝对路径，就要从html中的所在目录中招，例如：<code>&lt;``img</code> <code>src``=``&quot;c:/www/images/a.jpg&quot;</code> <code>alt``=``&quot;a&quot;``/&gt;</code></p> <h3 id="json"><a href="#json" class="header-anchor">#</a> JSON</h3> <p>JSON(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。它基于 <a href="https://baike.baidu.com/item/ECMAScript" target="_blank" rel="noopener noreferrer">ECMAScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (欧洲计算机协会制定的js规范)的一个子集，采用完全独立于编程语言的文本格式来存储和表示数据。简洁和清晰的层次结构使得 JSON 成为理想的数据交换语言。 易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率。</p> <p>作用：用户跨平台进行数据传输。</p> <p>格式：</p> <p>对象形式</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;河南&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p>集合形式</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;河南&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;河北&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>复杂形式-对象形式</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;booklist&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;bookname&quot;</span><span class="token operator">:</span><span class="token string">&quot;c#&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;bookname&quot;</span><span class="token operator">:</span><span class="token string">&quot;javascript&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre></div><p>复杂形式-集合形式</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;booklist&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">&quot;bookname&quot;</span><span class="token operator">:</span><span class="token string">&quot;c#&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;bookname&quot;</span><span class="token operator">:</span><span class="token string">&quot;javascript&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;booklist&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
 <span class="token punctuation">{</span><span class="token property">&quot;bookname&quot;</span><span class="token operator">:</span><span class="token string">&quot;c#&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token property">&quot;bookname&quot;</span><span class="token operator">:</span><span class="token string">&quot;javascript&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="nuget"><a href="#nuget" class="header-anchor">#</a> Nuget</h3> <p>Nuget是一个.NET平台下的开源的项目，它是Visual Studio的扩展。在使用[Visual Studio](https://baike.baidu.com/item/Visual Studio/539453) 或.NET CLI开发基于.NET 或.NET Framework的应用时，Nuget能把在项目中添加、移除和更新引用的工作变得更加快捷方便。</p> <p>作用：可以通过nuget命令直接在联网的状态下安装程序包,这样就不需要自己下载导入。</p> <p><strong>类似:nodejs中的npm    java中的maven</strong></p> <p>包源地址：<a href="https://www.nuget.org/" target="_blank" rel="noopener noreferrer">https://www.nuget.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>使用时注意：</p> <p>vs中需要配置nuget.org的仓库地址</p> <div class="language-bash extra-class"><pre class="language-bash"><code>https://www.nuget.org/
</code></pre></div><p>安装命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code>install-package 包名 <span class="token parameter variable">-version</span> 版本号（可选参数）
</code></pre></div><h3 id="序列化与反序列化"><a href="#序列化与反序列化" class="header-anchor">#</a> 序列化与反序列化</h3> <p>序列化：指将对象转化为可供传输的数据格式。</p> <p>反序列化：指将传输的数据格式转化为对象。</p> <p>数据传输格式一般指的是可跨平台的数据格式，例如：JSON、XML</p> <p><strong>.NET序列化组件</strong></p> <p>方式一：使用FW内置类库<strong>JavaScriptSerializer</strong></p> <p>使用JavaScriptSerializer方式需要引入的命名空间，这个在程序集System.Web.Extensions.dll.中。</p> <p>using System.Web.Script.Serialization;</p> <p>注意：可用[ScriptIgnore] 标记不序列化的属性</p> <p>方式二：使用<strong>Newtonsoft.JSON</strong>类库进行</p> <p>Newtonsoft.JSON是一个第三方的序列化反序列化库</p> <h3 id="xml"><a href="#xml" class="header-anchor">#</a> XML</h3> <p>可扩展标记语言，标准通用标记语言的子集，简称XML。</p> <p>在软件编程中，XML主要用于进行数据的<strong>跨平台传输</strong>和用于项目的<strong>配置文件</strong>。</p> <p>HTML：超文本标记语言 显示页面</p> <p>XML：可扩展标记语言    描述数据</p> <p>{&quot;Name&quot;:&quot;张三&quot;,&quot;Age&quot;:20}</p> <p>Student student=new Student();</p> <p>student.Name=张三</p> <p>student.Age=20</p> <p>格式</p> <p>1需要有标注</p> <p>2有且只有一个根标记</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>student</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>student</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>DTD</strong></p> <p>文档类型定义:对xml元素进行约束。</p> <p><code>&lt;article&gt;&lt;/article&gt;</code></p> <p><strong>XML Schema</strong></p> <p>下面这个例子是一个名为 &quot;note.xsd&quot; 的 XML Schema 文件，它定义了上面那个 XML 文档的元素：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">targetNamespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3school.com.cn<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3school.com.cn<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">elementFormDefault</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qualified<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>note<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>complexType</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>sequence</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>to<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>from<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heading<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>sequence</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>complexType</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>element</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>使用.NET读XML文件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>  <span class="token comment">//创建一个xml文档对象</span>
            <span class="token class-name">XmlDocument</span> xmlDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">XmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> fileUrl <span class="token operator">=</span> Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;S_Province.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//加载一个xml文件</span>
            xmlDoc<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//分析文档结构</span>
            <span class="token comment">//xmlDoc.SelectNodes(&quot;root&quot;);</span>
            <span class="token class-name">XmlNode</span> root <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//所有省份节点</span>
            <span class="token class-name">XmlNodeList</span> provinceList <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">&quot;Province&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">XmlNode</span> province <span class="token keyword">in</span> provinceList<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>province<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">&quot;ProvinceName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>province<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token comment">//读取表中的数据</span>
            <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> KangHui<span class="token punctuation">.</span>BaseClass<span class="token punctuation">.</span>DbHelperSQL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM S_Province&quot;</span><span class="token punctuation">,</span>KangHui<span class="token punctuation">.</span>Common<span class="token punctuation">.</span>ConfigHelper<span class="token punctuation">.</span>GetConnectionString
                <span class="token punctuation">(</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//写xml  </span>
            <span class="token class-name">XmlDocument</span> xmlDoc<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">XmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//描述头</span>
            <span class="token class-name">XmlDeclaration</span> xmlDeclaration <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateXmlDeclaration</span><span class="token punctuation">(</span><span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//把我们声明的描述头添加到xml文件中</span>
            xmlDoc<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>xmlDeclaration<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//创建一个根元素</span>
            <span class="token class-name">XmlNode</span> root <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xmlDoc<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//写内容</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> dr <span class="token keyword">in</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//创建一个省份元素节点</span>
                <span class="token class-name">XmlNode</span> provinceNode <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;Province&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//两个子节点</span>
                <span class="token class-name">XmlNode</span> idNode<span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建了一个id节点</span>
                idNode<span class="token punctuation">.</span>InnerText <span class="token operator">=</span> dr<span class="token punctuation">[</span><span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">XmlNode</span> nameNode <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                nameNode<span class="token punctuation">.</span>InnerText <span class="token operator">=</span> dr<span class="token punctuation">[</span><span class="token string">&quot;ProvinceName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                provinceNode<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>idNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                provinceNode<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>nameNode<span class="token punctuation">)</span><span class="token punctuation">;</span>

                root<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>provinceNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\&quot;</span><span class="token operator">+</span><span class="token string">&quot;test.xml&quot;</span><span class="token punctuation">;</span>
            xmlDoc<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="xpath表达式"><a href="#xpath表达式" class="header-anchor">#</a> XPath表达式</h3> <p><strong>XPath 使用路径表达式来选取 XML 文档中的节点或节点集。节点是通过沿着路径 (path) 或者步 (steps) 来选取的。</strong></p> <p>常用路径表达式参考：</p> <table><thead><tr><th style="text-align:left;">表达式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">nodename</td> <td style="text-align:left;">选取此节点的所有子节点。</td></tr> <tr><td style="text-align:left;">/</td> <td style="text-align:left;">从根节点选取。</td></tr> <tr><td style="text-align:left;">//</td> <td style="text-align:left;">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td></tr> <tr><td style="text-align:left;">.</td> <td style="text-align:left;">选取当前节点。</td></tr> <tr><td style="text-align:left;">..</td> <td style="text-align:left;">选取当前节点的父节点。</td></tr> <tr><td style="text-align:left;">@</td> <td style="text-align:left;">选取属性。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">bookstore</td> <td style="text-align:left;">选取 bookstore 元素的所有子节点。</td></tr> <tr><td style="text-align:left;">/bookstore</td> <td style="text-align:left;">选取根元素 bookstore。注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</td></tr> <tr><td style="text-align:left;">bookstore/book</td> <td style="text-align:left;">选取属于 bookstore 的子元素的所有 book 元素。</td></tr> <tr><td style="text-align:left;">//book</td> <td style="text-align:left;">选取所有 book 子元素，而不管它们在文档中的位置。</td></tr> <tr><td style="text-align:left;">bookstore//book</td> <td style="text-align:left;">选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</td></tr> <tr><td style="text-align:left;">//@lang</td> <td style="text-align:left;">选取名为 lang 的所有属性。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">/bookstore/book[1]</td> <td style="text-align:left;">选取属于 bookstore 子元素的第一个 book 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book[last()]</td> <td style="text-align:left;">选取属于 bookstore 子元素的最后一个 book 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book[last()-1]</td> <td style="text-align:left;">选取属于 bookstore 子元素的倒数第二个 book 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book[position()❤️]</td> <td style="text-align:left;">选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td></tr> <tr><td style="text-align:left;">//title[@lang]</td> <td style="text-align:left;">选取所有拥有名为 lang 的属性的 title 元素。</td></tr> <tr><td style="text-align:left;">//title[@lang='eng']</td> <td style="text-align:left;">选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</td></tr> <tr><td style="text-align:left;">/bookstore/book[price&gt;35.00]</td> <td style="text-align:left;">选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td></tr> <tr><td style="text-align:left;">/bookstore/book[price&gt;35.00]/title</td> <td style="text-align:left;">选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">通配符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">*</td> <td style="text-align:left;">匹配任何元素节点。</td></tr> <tr><td style="text-align:left;">@*</td> <td style="text-align:left;">匹配任何属性节点。</td></tr> <tr><td style="text-align:left;">node()</td> <td style="text-align:left;">匹配任何类型的节点。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">/bookstore/*</td> <td style="text-align:left;">选取 bookstore 元素的所有子元素。</td></tr> <tr><td style="text-align:left;">//*</td> <td style="text-align:left;">选取文档中的所有元素。</td></tr> <tr><td style="text-align:left;">//title[@*]</td> <td style="text-align:left;">选取所有带有属性的 title 元素。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">//book/title | //book/price</td> <td style="text-align:left;">选取 book 元素的所有 title 和 price 元素。</td></tr> <tr><td style="text-align:left;">//title | //price</td> <td style="text-align:left;">选取文档中的所有 title 和 price 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book/title  //price</td> <td style="text-align:left;">选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。</td></tr></tbody></table> <p>总结：JSON和XML的优缺点是什么？</p> <p>xml优点：xml可以对数据内容进行DTD校验，约束内容；json不可以。严格性上，xml更规范。</p> <p>xml缺点：繁琐，虽然有xpath表达式，但是还是不如json方便。</p> <p>主流：JSON</p> <h3 id="远程访问类"><a href="#远程访问类" class="header-anchor">#</a> 远程访问类</h3> <p>调用应用程序接口：</p> <p>.NET提供了很多的类进行远程访问，选择一个你用的顺的就可以。</p> <p>WebClient：进行远程访问</p> <p>HttpClient</p> <p>HttpWebRequest</p> <h3 id="html解析库htmlagilitypack"><a href="#html解析库htmlagilitypack" class="header-anchor">#</a> HTML解析库HtmlAgilityPack</h3> <p>HtmlAgilityPack用来进行html数据筛选的。</p> <p>昵图网</p> <p><a href="https://www.nipic.com/" target="_blank" rel="noopener noreferrer">https://www.nipic.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>作业：</p> <p>编写一个爬虫，将城市表S_City表的前10个城市，每一个城市抓取3张图片，保存在image文件夹中，要求文件夹名以城市名称命名。</p> <p>实现思路：</p> <p>1.S_City  北京市访问北京网址</p> <p>2.通过webClient访问北京的网址，得到一堆html源码</p> <p>3.对源码进行解析HtmlAgilityPack</p> <p>4.通过HtmlAgilityPack找到昵图网的UL找到LI找到Img得到图片所处在的地址。</p> <p>5.将图片进行下载。</p> <p>6.把北京的图片 都放在北京的文件夹中</p> <h3 id="类库"><a href="#类库" class="header-anchor">#</a> 类库</h3> <p>随着开发时间越来越长，我们自己写的帮助类就越来越多，帮助类在其他项目中使用麻烦（复制）,源代码会暴露。</p> <p>需求：即希望不同的项目都能用，还希望他源代码不要暴露。</p> <p>就是一个.NET项目文件，在这类库中存放的都是类。</p> <p>类库可以编译生成为.dll程序集文件,程序集文件相当于一个程序包，可以让任何项目调用类库中的方法。</p> <p>康辉类库</p> <p><strong>BaseClass</strong>：对数据库进行读写</p> <p>1)DbHelperSQL:Query 、ExecuteSql</p> <p>2)PagerBase:分页控件绑定类</p> <p><strong>Common</strong>:公共帮助类</p> <p>ConfigHelper</p> <p>ConverHelper</p> <p>EncryptionHelper:小心康辉类库中的MD5加密是有错的，个别情况下会生成31位字符串。</p> <p><strong>WebControls</strong></p> <p>AspNetPager分页控件</p> <p>1）需要在页面上注册分页组件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span><span class="token operator">%</span>@ <span class="token class-name">Register</span> Assembly<span class="token operator">=</span><span class="token string">&quot;KangHui.WebControls&quot;</span> Namespace<span class="token operator">=</span><span class="token string">&quot;KangHui.WebControls&quot;</span> TagPrefix<span class="token operator">=</span><span class="token string">&quot;uc&quot;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div><p>2）在页面上创建组件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span>uc<span class="token punctuation">:</span><span class="token class-name">AspNetPager</span> runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span> ID<span class="token operator">=</span><span class="token string">&quot;pager&quot;</span> PageSize<span class="token operator">=</span><span class="token string">&quot;10&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>uc<span class="token punctuation">:</span>AspNetPager<span class="token operator">&gt;</span>
</code></pre></div><p>3）将你的显示组件和分页进行捆绑，调用PagerBase类中的BindData方法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> PagerBase<span class="token punctuation">.</span><span class="token function">BindData</span><span class="token punctuation">(</span>rptProvince<span class="token punctuation">,</span> pager<span class="token punctuation">,</span> <span class="token string">&quot;SELECT * FROM S_Province&quot;</span><span class="token punctuation">,</span> connString<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>4）设置分页的跳页事件</p> <h3 id="linq"><a href="#linq" class="header-anchor">#</a> LINQ</h3> <p><strong>语言集成查询</strong>（英语：Language Integrated Query，<a href="https://baike.baidu.com/item/%E7%BC%A9%E5%86%99" target="_blank" rel="noopener noreferrer">缩写<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：LINQ），发音&quot;link&quot;，是<a href="https://baike.baidu.com/item/%E5%BE%AE%E8%BD%AF" target="_blank" rel="noopener noreferrer">微软<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的一项技术，新增一种自然查询的SQL语法到.NET Framework的编程语言中，当前可支持<a href="https://baike.baidu.com/item/C%23" target="_blank" rel="noopener noreferrer">C#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>以及[Visual Basic .NET](https://baike.baidu.com/item/Visual Basic .NET)语言。2007年11月19日随[.NET Framework](https://baike.baidu.com/item/.NET Framework) 3.5发布了LINQ技术。</p> <p>从数据库获取数据       ADO.NET ORM</p> <p>从XML文件获取的       XDocment  XPath</p> <p>从数组/集合中（Object）  foreach</p> <p>统一获取数据的方式：LINQ</p> <p>linq to sql</p> <p>linq to xml</p> <p>linq to object</p> <p>语法：</p> <p>linq to sql</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span><span class="token keyword">from</span> p <span class="token keyword">in</span> db<span class="token punctuation">.</span>Student  <span class="token keyword">select</span> p<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span><span class="token keyword">from</span> p <span class="token keyword">in</span> db<span class="token punctuation">.</span>Student <span class="token keyword">where</span> <span class="token class-name">p</span><span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">select</span> p<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span><span class="token keyword">from</span> c <span class="token keyword">in</span> db<span class="token punctuation">.</span>Student <span class="token keyword">join</span> db<span class="token punctuation">.</span>Classes 
</code></pre></div><p>linq to xml</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">XMLDocment</span>  doc <span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">XMLDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;c:\Test.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Student</span>
<span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span><span class="token keyword">from</span> p <span class="token keyword">in</span> doc <span class="token keyword">select</span> p<span class="token punctuation">.</span><span class="token function">Element</span><span class="token punctuation">(</span><span class="token string">&quot;Student&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p>linq to object</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span>  list<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> l<span class="token operator">=</span><span class="token keyword">from</span> li <span class="token keyword">in</span> list <span class="token keyword">where</span> <span class="token class-name">li</span><span class="token operator">&gt;</span><span class="token number">4</span> <span class="token keyword">select</span> li<span class="token punctuation">;</span>

</code></pre></div><h3 id="orm对象关系映射"><a href="#orm对象关系映射" class="header-anchor">#</a> ORM对象关系映射</h3> <p>什么是ORM
ORM(Object-relational mapping)，中文翻译为对象关系映射，是一种为了解决面向对象与关系数据库存在的互不匹配的现象的技术。简单的说，ORM是通过使用描述对象和数据库之间映射的元数据，将程序中的<strong>对象</strong>自动持久化到关系数据库中。</p> <p>为什么用ORM
在程序开发中，数据库保存的表，字段与程序中的实体类之间是没有关联的，在实现持久化时就比较不方便。那么，到底如何实现持久化呢？一种简单的方案是采用硬编码方式，为每一种可能的数据库访问操作提供单独的方法。这种方案存在以下不足：</p> <p>1.持久化层缺乏弹性。一旦出现业务需求的变更，就必须修改持久化层的接口
2.持久化层同时与域模型与关系数据库模型绑定，不管域模型还是关系数据库模型发生变化，都要修改持久化曾的相关程序代码，增加了软件的维护难度
ORM提供了实现持久化层的另一种模式，它采用<strong>映射元数据</strong>来描述<strong>对象关系的映射</strong>，使得ORM中间件能在任何一个应用的业务逻辑层和数据库层之间充当桥梁</p> <p>ORM的方法论基于三个核心原则：</p> <p>简单：以最基本的形式建模数据
传达性：数据库结构被任何人都能理解的语言文档化
精确性：基于数据模型创建正确标准化了的结构</p> <p>ORM作用：<strong>实现了数据库的映射</strong>  通俗讲就是2件事：1创建数据模型（EntityFramework）     2实现底层的增删改查等数据库常规操作</p> <p>常用的ORM</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">.</span><span class="token function">NET</span><span class="token punctuation">(</span>C#<span class="token punctuation">)</span>主流ORM总揽

<span class="token operator">*</span>SqlSugar <span class="token punctuation">(</span>国内<span class="token punctuation">)</span> 轻量化，执行速度快

Dos<span class="token punctuation">.</span>ORM <span class="token punctuation">(</span>国内<span class="token punctuation">)</span>

Chloe <span class="token punctuation">(</span>国内<span class="token punctuation">)</span>

<span class="token operator">*</span>StackExchange<span class="token operator">/</span>Dapper <span class="token punctuation">(</span>国外<span class="token punctuation">)</span> 轻量化，执行速度   

<span class="token operator">*</span><span class="token return-type class-name">Entity</span> Framework <span class="token punctuation">(</span>EF<span class="token punctuation">)</span> <span class="token punctuation">(</span>国外<span class="token punctuation">)</span> 全能型  懒加载 

<span class="token operator">*</span>NHibernate <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

ServiceStack<span class="token operator">/</span>ServiceStack<span class="token punctuation">.</span>OrmLite <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

linq2db <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

Massive <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

PetaPoco <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>
Dapper（国内） 执行速度最快

Java

<span class="token operator">*</span>Mybatis

<span class="token operator">*</span>Hibernate

</code></pre></div><h3 id="ef的创建方式"><a href="#ef的创建方式" class="header-anchor">#</a> EF的创建方式</h3> <p>CodeFirst:代码优先，先有代码后又数据库。</p> <p>CodeBehind：代码后置，先设计数据库再编写代码。</p> <p>注意：没有绝对好的，各自都有自己的优点和缺点。</p> <p>EF中的两个类</p> <p>DbContext:若干表的一个集合。</p> <p>DbSet：对表映射，提供对表的常规操作方法。</p> <p>方式一：</p> <p>通过VS中的向导工具创建</p> <p>方式二：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">1</span>创建一个DbContext集合类 
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentsContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">StudentsContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">&quot;StudentsEntities&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Users<span class="token punctuation">&gt;</span></span> Users <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  
    <span class="token punctuation">}</span>
<span class="token number">2</span>根据表编写类 
   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> UserId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Nullable<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> IsDelete <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ImageUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Pwd <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token number">3</span>将类注册在数据库上下文对象中
 <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Users<span class="token punctuation">&gt;</span></span> Users <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>CodeFirst代码优先</p> <p>程序设计时，优先编写代码，通过相关工具生成数据库。</p> <p>CodeBehind</p> <p>程序设计时，先设计数据库，然后编写代码。</p> <p>注意：本身两种模式互有优缺点。</p> <p>作业：使用Dapper实现MVC下的绑定</p> <p>思考：1CodeBehind和CodeFirst</p> <p>​           2EF和Dapper SqlSuger三款ORM的区别各自的特点</p> <p>​           3Razor语法</p> <p><strong>特点</strong></p> <p>懒加载（惰性加载/延时加载）：</p> <p>目的：提高效率，</p> <p>EF是一个虚拟的数据库，</p> <p>1.在查询时，EF给的数据在渲染页面的时候才能看见；</p> <p>2.EF在操作数据时，如果不进行db.SaveChanges()那么将一直保存惰性加载机制</p> <p>注意：调试过程中可以使用.ToLis()结束懒加载</p> <h3 id="ienumerable、iqueryable、list"><a href="#ienumerable、iqueryable、list" class="header-anchor">#</a> IEnumerable、IQueryable、List</h3> <p>数据结构上：链表</p> <p>IEnumerable：C#基础的迭代类型基类。如果一个对象可以迭代，那么他必须继承IEnumerable</p> <p>IQueryable:迭代类型，他继承自IEnumerable，他的功能会更加丰富。</p> <p>List：迭代类型，他继承自IEnumerable,他的功能更加丰富。</p> <p>注意：在开发中我们一般可以使用IQueryable和List，但是区别在于</p> <p><strong>List会结束EF惰性加载，而IQueryable不会结束惰性加载</strong></p> <h3 id="entityframework常用方法"><a href="#entityframework常用方法" class="header-anchor">#</a> EntityFramework常用方法</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">1</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>结束懒加<span class="token comment">//懒加载</span>
<span class="token number">2</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>通过主键获取一个对象
<span class="token number">3</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">4</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">5</span><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">6</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>   top  <span class="token number">5</span>
<span class="token number">7</span><span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>   跳过前<span class="token number">5</span>条
<span class="token number">8</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="递归算法"><a href="#递归算法" class="header-anchor">#</a> 递归算法</h3> <p>递归是一种算法，指的是函数自身调用自己。</p> <p>常见使用：斐波那契数列、阶乘</p> <p>实际应用：树、递归表</p> <p>递归阶乘流程图</p> <p><img src="https://img-blog.csdnimg.cn/20200607172717792.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xsdHF5bA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <h3 id="automapper"><a href="#automapper" class="header-anchor">#</a> AutoMapper</h3> <p>AutoMapper是一个对象到对象的转换映射工具(object-object mapper).它能把一个输入对象转换成一个不同类型的对象输出.AutoMapper更有趣的地方是它提供了一些有趣的惯例规则来帮助我们转换对象.可以这样理解:只要按照AutoMapper 建立的规则来(构造实体),就不需要进行任何多余的设置.</p> <p><strong>作用</strong></p> <p>AutoMapper库可以帮助我们在Model和VO对象之间进行转化，从而省去繁琐的字段匹配问题。</p> <p><strong>使用步骤</strong></p> <p>一、安装</p> <p>注意：最新版本是针对与ASP.NET Core的，所以要安装早期版本。</p> <p>二、创建Profile类</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">AutoMapper</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">KeDa2018MVC</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoMapperProfile</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">Profile</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">AutoMapperProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StudentVM<span class="token punctuation">,</span> Student<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>三、编写配置类</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoMapperConfig</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Mapper<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>config <span class="token operator">=&gt;</span>
                          <span class="token punctuation">{</span>
                              config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProfile</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AutoMapperProfile<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>四、在全局配置Global.asax中引用配置方法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>HttpApplication</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        AutoMapper<span class="token punctuation">.</span><span class="token function">Congig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FilterConfig<span class="token punctuation">.</span><span class="token function">RegisterGlobalFilters</span><span class="token punctuation">(</span>GlobalFilters<span class="token punctuation">.</span>Filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
        RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        BundleConfig<span class="token punctuation">.</span><span class="token function">RegisterBundles</span><span class="token punctuation">(</span>BundleTable<span class="token punctuation">.</span>Bundles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>四、具体使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StudentVM</span> studentVM <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StudentVM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>ClassName <span class="token operator">=</span> <span class="token string">&quot;1班&quot;</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>Date<span class="token operator">=</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>ClassId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token class-name">Student</span> student <span class="token operator">=</span> AutoMapper<span class="token punctuation">.</span>Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>studentVM<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="automapper实践"><a href="#automapper实践" class="header-anchor">#</a> AutoMapper实践</h3> <p>这段内容将讨论AutoMapper的规则写在什么地方的问题。</p> <p>在上一段中，我们已经知道了如何使用AutoMapper进行简单的对象映射，但是，在实际的项目中，我们会有很多类进行映射（从Entity转换为Dto，或者从Entity转换为ViewModel等），这么多的映射如何组织将成为一个问题。</p> <p>首先我们需要定义一个Configuration.cs的类，该类提供AutoMapper规则配置的入口，它只提供一个静态的方法，在程序第一次运行的时候调用该方法完成配置。</p> <p>当有多个Profile的时候，我们可以这样添加：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Configuration</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Mapper<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProfile</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Profiles<span class="token punctuation">.</span>SourceProfile<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProfile</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Profiles<span class="token punctuation">.</span>OrderProfile<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProfile</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Profiles<span class="token punctuation">.</span>CalendarEventProfile<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在程序运行的时候，只需要调用Configure方法即可。</p> <p>了解了这些实现以后，我们可以再项目中添加AutoMapper文件夹，文件夹结构如下：</p> <p><img src="https://images0.cnblogs.com/blog/44814/201408/181014254878095.png" alt="image"></p> <p>Configuration为我们的静态配置入口类；Profiles文件夹为我们所有Profile类的文件夹。如果是MVC，我们需要在Global中调用：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>AutoMapper<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>扁平化映射（Flattening）</p> <p>默认情况下，我们的Source类和Destination类是根据属性名称进行匹配映射的。除此之外，默认的映射规则还有下面两种情况，我们称之为扁平化映射，即当Source类中不包含Destination类中的属性的时候，AutoMapper会将Destination类中的属性进行分割，或匹配“Get”开头的方法，例如：</p> <p>Order类：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Customer</span> Customer <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> <span class="token function">GetTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">100M</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Order类中包含了一个customer对象和一个GetTotal方法，为了方便演示，我直接将GetTotal方法返回100；</p> <p>Customer类的定义如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>OrderDto类的定义如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderDto</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CustomerName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Total <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们在进行映射的时候，不需要进行特殊的配置，既可以完成从Order到OrderDto的映射。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Entity<span class="token punctuation">.</span>Order<span class="token punctuation">,</span> Dto<span class="token punctuation">.</span>OrderDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Entity<span class="token punctuation">.</span>Customer</span> customer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Entity<span class="token punctuation">.</span>Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Tom&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Entity<span class="token punctuation">.</span>Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Entity<span class="token punctuation">.</span>Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Customer <span class="token operator">=</span> customer <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Dto<span class="token punctuation">.</span>OrderDto</span> orderDto <span class="token operator">=</span> Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Dto<span class="token punctuation">.</span>OrderDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
ObjectDumper<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ObjectDumper<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>orderDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>测试结果：</p> <p><img src="https://images0.cnblogs.com/blog/44814/201408/181014259876181.png" alt="image"></p> <p>指定映射字段（Projection）</p> <p>在实际的业务环境中，我们的Source类和Destination类的字段不可能一对一的匹配，这个时候我们就需要来指定他们的实际映射关系，例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalendarEvent</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Date <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalendarEventForm</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> EventDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> EventHour <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> EventMinute <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> DisplayTitle <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这两个类中，CalendarEvent的Date将被拆分为CalendarEventForm的日期、时、分三个字段，Title也将对应DisplayTitle字段，那么相应的Profile定义如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalendarEventProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Entity<span class="token punctuation">.</span>CalendarEvent<span class="token punctuation">,</span> Entity<span class="token punctuation">.</span>CalendarEventForm<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>EventDate<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">MapFrom</span><span class="token punctuation">(</span>src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>EventHour<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">MapFrom</span><span class="token punctuation">(</span>src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>EventMinute<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">MapFrom</span><span class="token punctuation">(</span>src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>Minute<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>DisplayTitle<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">MapFrom</span><span class="token punctuation">(</span>src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Title<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Entity<span class="token punctuation">.</span>CalendarEvent</span> calendarEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Entity<span class="token punctuation">.</span>CalendarEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Date <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span>
    Title <span class="token operator">=</span> <span class="token string">&quot;Demo Event&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Entity<span class="token punctuation">.</span>CalendarEventForm</span> calendarEventForm <span class="token operator">=</span> Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Entity<span class="token punctuation">.</span>CalendarEventForm<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>calendarEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
ObjectDumper<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>calendarEventForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>测试结果：</p> <p><img src="https://images0.cnblogs.com/blog/44814/201408/181014265964768.png" alt="image"></p> <p>验证配置项（Configuration Validation）</p> <p>AutoMapper提供了一种验证机制，用来判断Destination类中的所有属性是否都被映射，如果存在未被映射的属性，则抛出异常。</p> <p>验证的用法：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Mapper<span class="token punctuation">.</span><span class="token function">AssertConfigurationIsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Source</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> SomeValue <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> AnotherValue <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Destination代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Destination</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> SomeValuefff <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Entity<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> Entity<span class="token punctuation">.</span>Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Mapper<span class="token punctuation">.</span><span class="token function">AssertConfigurationIsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行程序将会出现AutoMapperConfigurationException异常：</p> <p><img src="https://images0.cnblogs.com/blog/44814/201408/181014273314925.png" alt="image"></p> <p>这是因为SomeValuefff在Source类中没有对应的字段造成的。</p> <p>解决这种异常的方法有：</p> <p>指定映射字段，例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Entity<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> Entity<span class="token punctuation">.</span>Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>SomeValuefff<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        opt<span class="token punctuation">.</span><span class="token function">MapFrom</span><span class="token punctuation">(</span>src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>SomeValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者使用Ignore方法：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Entity<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> Entity<span class="token punctuation">.</span>Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>SomeValuefff<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        opt<span class="token punctuation">.</span><span class="token function">Ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者使用自定义解析器，自定义解析器在下面讲到。</p> <p>自定义解析器（Custom value resolvers）</p> <p>AutoMapper允许我们自定义解析器来完成Source到Destination的值的转换。例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Source</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Value1 <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Value2 <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Destination</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Total <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Total属性在Source中不存在，如果现在创建映射规则，在映射的时候必然会抛出异常。这个时候我们就需要使用自定义解析器来完成映射。</p> <p>自定义解析器需要实现 IValueResolver 接口，接口的定义如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IValueResolver</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">ResolutionResult</span> <span class="token function">Resolve</span><span class="token punctuation">(</span><span class="token class-name">ResolutionResult</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们来自定义一个Resolver：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomResolver</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ValueResolver<span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">ResolveCore</span><span class="token punctuation">(</span><span class="token class-name">Source</span> source<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> source<span class="token punctuation">.</span>Value1 <span class="token operator">+</span> source<span class="token punctuation">.</span>Value2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在映射规则中使用这个解析器：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SourceProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Source-&gt;Destination</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>Total<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                opt<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ResolveUsing</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomResolver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Source</span> src <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Source</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Value1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    Value2 <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Destination</span> dest <span class="token operator">=</span> Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
ObjectDumper<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>测试结果：</p> <p><img src="https://images0.cnblogs.com/blog/44814/201408/181014277682226.png" alt="image"></p> <p>在使用自定义Resolver中，我们还可以指定Resolver的构造函数，例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//Source-&gt;Destination</span>
<span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>Total<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        opt<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ResolveUsing</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomResolver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConstructedBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>自定义类型转换器（Custom type converters）</p> <p>AutoMapper通过ConvertUsing来使用自定义类型转换器。ConvertUsing有三种用法：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConvertUsing</span><span class="token punctuation">(</span><span class="token class-name">Func<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TDestination<span class="token punctuation">&gt;</span></span> mappingFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConvertUsing</span><span class="token punctuation">(</span><span class="token class-name">ITypeConverter<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TDestination<span class="token punctuation">&gt;</span></span> converter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">ConvertUsing</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TTypeConverter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">TTypeConverter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ITypeConverter<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TDestination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">;</span>
</code></pre></div><p>当我们有如下的Source类和Destination类：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Source</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Value1 <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Destination</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Value1 <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以使用如下配置：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SourceProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//string-&gt;int</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConvertUsing</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span>ToInt32<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Source-&gt;Destination</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的配置中，我们首先创建了从string到int的类型转换，这里使用了系统自带的Convert.ToInt32转换方法。</p> <p>除了这种方法之外，我们还可以自定义类型转换器：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomConverter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ITypeConverter<span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> Destination<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Destination</span> <span class="token function">Convert</span><span class="token punctuation">(</span><span class="token class-name">ResolutionContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Source</span> src <span class="token operator">=</span> context<span class="token punctuation">.</span>SourceValue <span class="token keyword">as</span> <span class="token class-name">Source</span><span class="token punctuation">;</span>
        <span class="token class-name">Destination</span> dest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Destination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dest<span class="token punctuation">.</span>Value1 <span class="token operator">=</span> System<span class="token punctuation">.</span>Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span>Value1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> dest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过这个转换器，我们可以绕过string到int的转换，直接将Source类的对象转换为Destination类的对象。</p> <p>对应的配置如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SourceProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Source-&gt;Destination</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConvertUsing</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomConverter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者，我们也可以使用下面的配置：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SourceProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Source-&gt;Destination</span>
        <span class="token class-name">CustomConverter</span> converter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConvertUsing</span><span class="token punctuation">(</span>converter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>空值替换（Null substitution）</p> <p>空值替换允许我们将Source对象中的空值在转换为Destination的值的时候，使用指定的值来替换空值。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Source</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Destination</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SourceProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Source-&gt;Destination</span>
        <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Source<span class="token punctuation">,</span> Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                opt<span class="token punctuation">.</span><span class="token function">NullSubstitute</span><span class="token punctuation">(</span><span class="token string">&quot;原始值为NULL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Source</span> src <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Destination</span> dest <span class="token operator">=</span> Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Destination<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
ObjectDumper<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>测试结果：</p> <p><img src="https://images0.cnblogs.com/blog/44814/201408/181014283785111.png" alt="image"></p> <p>条件映射（Conditional mapping）</p> <p>条件映射只当Source类中的属性值满足一定条件的时候才进行映射。例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> baz<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bar</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> baz<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应的配置代码如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Foo<span class="token punctuation">,</span> Bar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>baz<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        opt<span class="token punctuation">.</span><span class="token function">Condition</span><span class="token punctuation">(</span>src <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>src<span class="token punctuation">.</span>baz <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="autofac"><a href="#autofac" class="header-anchor">#</a> AutoFac</h3> <p>定义：AutoFac是一个IOC容器</p> <p>autofac能够帮助你在应用程序运行起来后，在容器中创建出各种服务对象，当我们需要时可以直接将容器中的类注入到相应的构造函数中。</p> <p><strong>ASP.NET MVC 中AutoFac基本使用</strong></p> <p>一、下载AutoFac包</p> <p>二、全局配置容器</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContainerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>三、AutoFac中的常用方法</p> <p>Global.asax</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//1.单个依赖注入</span>
builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BMW<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.依赖注入当前应用程序下的所有Controller</span>
builder<span class="token punctuation">.</span><span class="token function">RegisterControllers</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MvcApplication</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//指定注入方式为属性注入</span>
<span class="token comment">//3.依赖注入按程序集注入</span>
<span class="token class-name">Assembly</span> asm <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;IBll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//注入所有非抽象成员</span>
builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>asm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 


<span class="token comment">//容器构建</span>
<span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>四、解析器替换</p> <p>说明：由于ASP.NET MVC本身提供了自带的解析器，此时我们需要使用Autofac替换原有MVC解析器。</p> <p>Global.asax</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//解析器替换</span>
DependencyResolver<span class="token punctuation">.</span><span class="token function">SetResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutofacDependencyResolver</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>五、控制器中使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICar</span> _icar<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">HomeController</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> icar<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _icar <span class="token operator">=</span> icar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// GET: Home</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _icar<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>补充：在非控制器中使用autofac</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tools</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">ICar</span> _car <span class="token operator">=</span> DependencyResolver<span class="token punctuation">.</span>Current<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _car<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>AutoFac项目创建使用步骤</strong></p> <p>一、按照依赖倒置思想构建你的应用</p> <p>二、添加Autofac引用</p> <p>三、在Global中创建ContainerBuilder容器</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContainerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
 <span class="token comment">//单一注入</span>
 <span class="token comment">//builder.RegisterType&lt;BMW&gt;().As&lt;ICar&gt;();</span>
<span class="token punctuation">}</span>
</code></pre></div><p>四、注册组件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContainerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//注册MVC控制器（注册所有到控制器，控制器注入，就是需要在控制器的构造函数中接收对象）</span>
    <span class="token comment">//PropertiesAutowired：允许属性注入</span>
    builder<span class="token punctuation">.</span><span class="token function">RegisterControllers</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MvcApplication</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//一次性注册所有实现了IDependency接口的类</span>
    <span class="token class-name">Type</span> baseType <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">IDependency</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assembly<span class="token punctuation">[</span><span class="token punctuation">]</span></span> assemblies <span class="token operator">=</span>
        Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>RelativeSearchPath<span class="token punctuation">,</span> <span class="token string">&quot;*.dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>Assembly<span class="token punctuation">.</span>LoadFrom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>assemblies<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>type <span class="token operator">=&gt;</span> baseType<span class="token punctuation">.</span><span class="token function">IsAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>type<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">AsSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InstancePerLifetimeScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//设置依赖解析器</span>
    <span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DependencyResolver<span class="token punctuation">.</span><span class="token function">SetResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutofacDependencyResolver</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>五、注册容器</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            Mapper<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProfile</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AutoMapperProfile<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            FilterConfig<span class="token punctuation">.</span><span class="token function">RegisterGlobalFilters</span><span class="token punctuation">(</span>GlobalFilters<span class="token punctuation">.</span>Filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
            RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            BundleConfig<span class="token punctuation">.</span><span class="token function">RegisterBundles</span><span class="token punctuation">(</span>BundleTable<span class="token punctuation">.</span>Bundles<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//注册容器</span>
            <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>六、应用执行</p> <p>控制器的注入</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">StudentController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 

    <span class="token punctuation">}</span>
    <span class="token comment">//声明学生接口</span>
    <span class="token keyword">protected</span> <span class="token class-name">IStudentService</span> _studentService<span class="token punctuation">;</span>
    <span class="token comment">//注入学生服务接口</span>
    <span class="token keyword">public</span> <span class="token function">StudentController</span><span class="token punctuation">(</span><span class="token class-name">IStudentService</span> studentService<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_studentService <span class="token operator">=</span> studentService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// GET: Student</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>服务层的注入</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IStudentService</span><span class="token punctuation">,</span><span class="token class-name">IDependency</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 定义仓储层学生类对象</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">protected</span> <span class="token class-name">IStudentRepository</span> _studentRepository<span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 空构造函数</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token function">StudentService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 构造函数</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;studentRepository&quot;&gt;仓储层学生抽象类对象&lt;/param&gt;</span>
        <span class="token comment">/// 为服务层注入仓储层抽象类对象</span>
        <span class="token keyword">public</span> <span class="token function">StudentService</span><span class="token punctuation">(</span><span class="token class-name">IStudentRepository</span> studentRepository<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_studentRepository <span class="token operator">=</span> studentRepository<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Student</span> <span class="token function">GetStudent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> Id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> _studentRepository<span class="token punctuation">.</span><span class="token function">GetStudent</span><span class="token punctuation">(</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="手动创建entityframework6"><a href="#手动创建entityframework6" class="header-anchor">#</a> 手动创建EntityFramework6</h3> <p>步骤：</p> <p>1.创建表对象</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> CreateTime <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2.创建TestContext类</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">KeDa2018MVC<span class="token punctuation">.</span>Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestContext</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">DbContext</span><span class="token punctuation">,</span><span class="token class-name">ITestContext</span><span class="token punctuation">,</span> <span class="token class-name">IDependency</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">//TestContext为数据库连接名称</span>
        <span class="token keyword">public</span> <span class="token function">TestContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">&quot;TestContext&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          
        <span class="token punctuation">}</span>
       <span class="token comment">//注:此处的虚拟属性名称为表名发复数形式</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span> Students <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">//去除复数设置，即EF在最终执行SQL语句时将复数去除</span>
            <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">DbModelBuilder</span> modelBuilder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            modelBuilder<span class="token punctuation">.</span>Conventions<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Remove</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PluralizingTableNameConvention<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>3.配置连接字符串</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>StudentsEntity<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data source=DESKTOP-EA5IP0C\SQLEXPRESS;initial catalog=Demo;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework<span class="token punctuation">&quot;</span></span> <span class="token attr-name">providerName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Data.SqlClient<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="autocomplete"><a href="#autocomplete" class="header-anchor">#</a> AutoComplete</h3> <p>一个前端输入框自动补全技术。</p> <p>功能：当用户在输入框中输入关键词时，则自动进行提示补全。</p> <p>该功能是由jQuery中的autocommplete.js提供的，常规的组件类型框架中有些自动集成了相关功能，具体如何使用需要查看组件库文档。</p> <p><strong>LayUI中使用AutoComplete</strong></p> <p>1.下载layui扩展插件</p> <p>2.在前端视图页面创建AutoComplete</p> <p>注：由于autocomplete是基于jquery的，所以我们需要在layui中使用jquery组件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token class-name"><span class="token keyword">var</span></span> autocomplete <span class="token operator">=</span> layui<span class="token punctuation">.</span>autocomplete<span class="token punctuation">,</span>
 $ <span class="token operator">=</span> layui<span class="token punctuation">.</span>jquery<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code> layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token string">'layedit'</span><span class="token punctuation">,</span> <span class="token string">'laydate'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/*  $ = layui.jquery*/</span>
       
        <span class="token keyword">var</span> autocomplete <span class="token operator">=</span> layui<span class="token punctuation">.</span>autocomplete<span class="token punctuation">,</span>
            $ <span class="token operator">=</span> layui<span class="token punctuation">.</span>jquery<span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#txtStudentName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">auto_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">auto_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/StudentInfo/SelectStudent?queryName=&quot;</span> <span class="token operator">+</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#txtStudentName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                autocomplete<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">elem</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[name=StudentName]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> res<span class="token punctuation">,</span>
                    <span class="token literal-property property">template_val</span><span class="token operator">:</span> <span class="token string">'{{d.StudentName}}'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">template_txt</span><span class="token operator">:</span> <span class="token string">' &lt;span class=\'layui-badge layui-bg-gray \' style=\'z-index:9;\' &gt;{{d.StudentName}}&lt;/span&gt;'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">ajaxParams</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">'jsonp'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">onselect</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="comet技术"><a href="#comet技术" class="header-anchor">#</a> Comet技术</h3> <p>Ajax轮询：每经过一段时间，就发起一次ajax请求。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>优点：保证数据的即使更新。</p> <p>缺点：造成无效的请求。</p> <p><strong>概念</strong>：Comet是一种用于web的技术，能使服务器能实时地将更新的信息传送到客户端，而无须客户端发出请求，目前有两种实现方式，长<a href="https://so.csdn.net/so/search?q=%E8%BD%AE%E8%AF%A2&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">轮询<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和iframe流。</p> <p>简单的说是一种基于现有Http协议基础上的长轮询技术，之所有会产生这种技术的主要原因是Http协议是无状态的所以客户端和服务端之间没办法建立起一套长时间的连接。比如我们要做一个聊天室，在Web环境下我们通常不能从服务端推送消息到浏览器里，而只能通过每个客户端不断的轮询服务器，以获取最新的消息，这样一来效率非常低，而且不断的向服务器发送请求对于访问量大的应用来说也会造成很大的资源占用。</p> <p>于是人们就发现了这种技术，向服务器发起一个请求，然后服务器一直不响应这个请求，这样客户端和服务端之间就形成了一个长连接，直到服务端响应这个请求后结束本次连接。借用一下IBM里的图片：</p> <p><img src="https://img-blog.csdn.net/20151213154207268" alt="这里写图片描述"></p> <p>通过Ajax技术可以实现长轮询的服务器推模型，客户端和服务端之间通过不断的发起长轮询即可以实现数据的交互，这个过程由于是Ajax实现的异步操作所以体验上会比较好，效率也很高。哎呀呀，说不清楚，找个网上的资料：</p> <p>Comet方式通俗的说就是一种长连接机制(long lived http)。同样是由Browser端主动发起请求，但是Server端以一种似乎非常慢的响应方式给出回答。这样在这个期间内，服务器端可以使用同一个connection把要更新的数据主动发送给Browser。因此请求可能等待较长的时间，期间没有任何数据返回，但是一旦有了新的数据，它将立即被发送到客户机。Comet又有很多种实现方式，但是总的来说对Server端的负载都会有增加.虽然对于单位操作来说，每次只需要建议一次connection,但是由于connection是保持较长时间的,对于 server端的资源的占用要有所增加。</p> <p>优点： 实时性好（消息延时小）；性能好（能支持大量用户）</p> <p>缺点： 长期占用连接，丧失了无状态高并发的特点。</p> <p>应用： 股票系统、实时通讯。</p> <h3 id="socket"><a href="#socket" class="header-anchor">#</a> Socket</h3> <p>基于C/S架构</p> <p>不能用网页形式实现socket</p> <p><strong>概念</strong></p> <p>socket的英文原义是“孔”或“插座”。作为进程通信机制，取后一种意思。通常也称作“套接字”，用于描述IP地址和端口，是一个通信链的句柄（其实就是两个程序通信用的）。
socket非常类似于电话插座。以一个电话网为例：电话的通话双方相当于相互通信的2个程序，电话号码就是ip地址。任何用户在通话之前，首先要占有一部电话机，相当于申请一个socket；同时要知道对方的号码，相当于对方有一个固定的socket。然后向对方拨号呼叫，相当于发出连接请求。对方假如在场并空闲，拿起电话话筒，双方就可以正式通话，相当于连接成功。双方通话的过程，是一方向电话机发出信号和对方从电话机接收信号的过程，相当于向socket发送数据和从socket接收数据。通话结束后，一方挂起电话机相当于关闭socket，撤销连接。</p> <p><strong>Socket使用步骤</strong></p> <p><img src="https://images2015.cnblogs.com/blog/1033738/201612/1033738-20161222105102807-1112314980.png" alt="img"></p> <p>服务器端：</p> <p>第一步：创建一个用于监听连接的Socket对像；</p> <p>第二步：用指定的端口号和服务器的ip建立一个EndPoint对像； 127.0.0.1:5000用于监听</p> <p>第三步：用socket对像的Bind()方法绑定EndPoint；</p> <p>第四步：用socket对像的Listen()方法开始监听；</p> <p>第五步：接收到客户端的连接，用socket对像的Accept()方法创建一个新的用于和客户端进行通信的socket对像;</p> <p>第六步：通信结束后一定记得关闭socket;</p> <p>客户端：</p> <p>第一步：建立一个Socket对像；</p> <p>第二步：用指定的端口号和服务器的ip建立一个EndPoint对像；</p> <p>第三步：用socket对像的Connect()方法以上面建立的EndPoint对像做为参数，向服务器发出连接请求；</p> <p>第四步：如果连接成功，就用socket对像的Send()方法向服务器发送信息；</p> <p>第五步：用socket对像的Receive()方法接受服务器发来的信息 ;</p> <p>第六步：通信结束后一定记得关闭socket；</p> <p>通讯程序socket</p> <p>服务端</p> <p>1写一个监听Socket</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Socket</span><span class="token punctuation">(</span>AddressFamily<span class="token punctuation">.</span>InterNetwork<span class="token punctuation">,</span> SocketType<span class="token punctuation">.</span>Stream<span class="token punctuation">,</span> ProtocolType<span class="token punctuation">.</span>Tcp<span class="token punctuation">)</span><span class="token punctuation">;</span>
 socket<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
 socket<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>1-1写一个线程进行连接的创建</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>AcceptInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span>IsBackground <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//异步线程</span>
thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//线程启动</span>
</code></pre></div><p>2接收recevie()</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> n <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> words <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3发送send()</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>textBox3<span class="token punctuation">.</span><span class="token function">AppendText</span><span class="token punctuation">(</span>txtMessage<span class="token punctuation">.</span>Text <span class="token operator">+</span> <span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>txtMessage<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//client客户端的socket</span>
</code></pre></div><p>客户端</p> <p>1连接服务端socket</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Socket</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Socket</span><span class="token punctuation">(</span>AddressFamily<span class="token punctuation">.</span>InterNetwork<span class="token punctuation">,</span> SocketType<span class="token punctuation">.</span>Stream<span class="token punctuation">,</span> ProtocolType<span class="token punctuation">.</span>Tcp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IPAddress</span> ip <span class="token operator">=</span> IPAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>txtip<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//连接到目标IP的哪个应用(端口号！)</span>
<span class="token class-name">IPEndPoint</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IPEndPoint</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>txtpoint<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2客户端send</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>textBox3<span class="token punctuation">.</span><span class="token function">AppendText</span><span class="token punctuation">(</span>txtMessage<span class="token punctuation">.</span>Text <span class="token operator">+</span> <span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>txtMessage<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3客户端revice</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> n <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> words <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h3> <p><strong>HTML5 WebSocket</strong></p> <p>WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。</p> <p>WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p> <p>在 WebSocket API 中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。</p> <p>现在，很多网站为了实现推送技术，所用的j技术都是 Ajax 轮询。轮询是在特定的的时间间隔（如每1秒），由浏览器对服务器发出HTTP请求，然后由服务器返回最新的数据给客户端的浏览器。这种传统的模式带来很明显的缺点，即浏览器需要不断的向服务器发出请求，然而HTTP请求可能包含较长的头部，其中真正有效的数据可能只是很小的一部分，显然这样会浪费很多的带宽等资源。</p> <p>HTML5 定义的 WebSocket 协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯。</p> <p><img src="https://www.runoob.com/wp-content/uploads/2016/03/ws.png" alt="img"></p> <p>浏览器通过 JavaScript 向服务器发出建立 WebSocket 连接的请求，连接建立以后，客户端和服务器端就可以通过 TCP 连接直接交换数据。</p> <p>当你获取 Web Socket 连接后，你可以通过 <strong>send()</strong> 方法来向服务器发送数据，并通过 <strong>onmessage</strong> 事件来接收服务器返回的数据。</p> <p>以下 API 用于创建 WebSocket 对象。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> Socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">protocol</span></span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以上代码中的第一个参数 url, 指定连接的 URL。第二个参数 protocol 是可选的，指定了可接受的子协议。</p> <hr> <p><strong>WebSocket 属性</strong></p> <p>以下是 WebSocket 对象的属性。假定我们使用了以上代码创建了 Socket 对象：</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">Socket.readyState</td> <td style="text-align:left;">只读属性 <strong>readyState</strong> 表示连接状态，可以是以下值：0 - 表示连接尚未建立。1 - 表示连接已建立，可以进行通信。2 - 表示连接正在进行关闭。3 - 表示连接已经关闭或者连接不能打开。</td></tr> <tr><td style="text-align:left;">Socket.bufferedAmount</td> <td style="text-align:left;">只读属性 <strong>bufferedAmount</strong> 已被 send() 放入正在队列中等待传输，但是还没有发出的 UTF-8 文本字节数。</td></tr></tbody></table> <hr> <p><strong>WebSocket 事件</strong></p> <p>以下是 WebSocket 对象的相关事件。假定我们使用了以上代码创建了 Socket 对象：</p> <table><thead><tr><th style="text-align:left;">事件</th> <th style="text-align:left;">事件处理程序</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">message</td> <td style="text-align:left;">Socket.onmessage</td> <td style="text-align:left;">客户端接收服务端数据时触发</td></tr> <tr><td style="text-align:left;">error</td> <td style="text-align:left;">Socket.onerror</td> <td style="text-align:left;">通信发生错误时触发</td></tr> <tr><td style="text-align:left;">open</td> <td style="text-align:left;">Socket.onopen</td> <td style="text-align:left;">连接建立时触发</td></tr> <tr><td style="text-align:left;">close</td> <td style="text-align:left;">Socket.onclose</td> <td style="text-align:left;">连接关闭时触发</td></tr></tbody></table> <hr> <p><strong>WebSocket 方法</strong></p> <p>以下是 WebSocket 对象的相关方法。假定我们使用了以上代码创建了 Socket 对象：</p> <table><thead><tr><th style="text-align:left;">方法</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">Socket.send()</td> <td style="text-align:left;">使用连接发送数据</td></tr> <tr><td style="text-align:left;">Socket.close()</td> <td style="text-align:left;">关闭连接</td></tr></tbody></table> <p><strong>ASP.NET下的socket实现</strong></p> <p>发送推送消息</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>        <span class="token class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//登录提醒（包括自己）</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> socket <span class="token keyword">in</span> _UserDictionary<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> socket<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> WebSocketMessageType<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>服务端接收指令</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>        <span class="token class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//接受指令</span>
        <span class="token class-name">WebSocketReceiveResult</span> result <span class="token operator">=</span> <span class="token keyword">await</span> socket<span class="token punctuation">.</span><span class="token function">ReceiveAsync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//表示是关闭指令</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>MessageType <span class="token operator">==</span> WebSocketMessageType<span class="token punctuation">.</span>Close<span class="token punctuation">)</span>
        <span class="token punctuation">{</span> <span class="token comment">//断开指令</span>
          <span class="token keyword">await</span> socket<span class="token punctuation">.</span><span class="token function">CloseAsync</span><span class="token punctuation">(</span>WebSocketCloseStatus<span class="token punctuation">.</span>NormalClosure<span class="token punctuation">,</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
          <span class="token comment">//获取客户端发送内容</span>
             <span class="token class-name"><span class="token keyword">string</span></span> userMsg <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>Array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        
</code></pre></div><h3 id="singalr"><a href="#singalr" class="header-anchor">#</a> SingalR</h3> <p><strong>简介</strong></p> <p>ASP .NET SignalR是一个ASP .NET 下的类库，可以在ASP .NET 的Web项目中实现实时通信.</p> <p><img src="https://images0.cnblogs.com/blog/15172/201412/061436271702087.png" alt="image"></p> <p>Asp.net SignalR 2 实现 服务端消息推送到Web端, 更加简单. 为了获取更好的可伸缩性, 我们引入消息队列, 看如下基本流程图:</p> <p><a href="https://images0.cnblogs.com/blog/15172/201412/061436278897701.png" target="_blank" rel="noopener noreferrer"><img src="https://images0.cnblogs.com/blog/15172/201412/061436285762559.png" alt="image"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>消息队列MQ监听, 在Web site 服务端一收到消息,马上通过Signalr 推送广播到客户端.</p> <p><strong>使用步骤</strong></p> <p>具体操作步骤：</p> <p>以实现消息推送为示例</p> <p>步骤一：</p> <p>安装</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Install<span class="token operator">-</span>Package Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>SignalR
</code></pre></div><p>步骤二：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>UPDATE<span class="token operator">-</span>Package Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>SignalR <span class="token operator">-</span>Version <span class="token number">2.4</span><span class="token number">.0</span>
UPDATE<span class="token operator">-</span>Package jQuery <span class="token operator">-</span>Version <span class="token number">1.8</span><span class="token number">.2</span>
</code></pre></div><p>步骤三：</p> <p>创建一个集线器</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>
<span class="token comment">//先在Nuget上搜索Microsoft.AspNet.SignalR安装</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>SignalR</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>SignalR<span class="token punctuation">.</span>Hubs</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">SignalRDEMO</span>
<span class="token punctuation">{</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 自定义SignalR集线器代理类名称</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token punctuation">[</span><span class="token function">HubName</span><span class="token punctuation">(</span><span class="token string">&quot;myChatHub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyChatHub</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Hub</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 推送至所有客户端</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;message&quot;&gt;消息&lt;/param&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Send</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//调用所有客户端的SendMessage方法</span>
            Clients<span class="token punctuation">.</span>All<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤四：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html; charset=utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>SignalR实时消息推送到客户端<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery-1.8.2.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引用SignalR库--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery.signalR-2.1.2.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引用自动生成的SignalR集线器(Hub)脚本.在运行的时候在浏览器的Source下可看到--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/signalr/hubs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//引用服务端的集线器代理类       </span>
            <span class="token keyword">var</span> chat <span class="token operator">=</span> $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>myChatHub<span class="token punctuation">;</span>
            <span class="token comment">//定义服务器端调用的客户端SendMessage方法来显示新消息</span>
            chat<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function-variable function">SendMessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">ShowMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//$.extend(chat.client, {</span>
            <span class="token comment">//    SendMessage: function (message) {</span>
            <span class="token comment">//        ShowMessage(message);</span>
            <span class="token comment">//    }</span>
            <span class="token comment">//});</span>

            <span class="token comment">//设置焦点到输入框</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//开始连接服务器</span>
            $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#SendMessage'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//调用服务器端定义的Send方法</span>
                    chat<span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//清空输入框信息并获取焦点</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//向页面添加消息</span>
        <span class="token keyword">function</span> <span class="token function">ShowMessage</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'&lt;li&gt;'</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">'&lt;/li&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>      
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SendMessage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>发送<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>步骤五：</p> <p>添加启动类StartUp</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Owin</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Owin</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">OwinStartup</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SignalRChat<span class="token punctuation">.</span>Startup</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">namespace</span> <span class="token namespace">SignalRChat</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configuration</span><span class="token punctuation">(</span><span class="token class-name">IAppBuilder</span> app<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Any connection or hub wire up and configuration should go here</span>
            app<span class="token punctuation">.</span><span class="token function">MapSignalR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <p>每一个使用的OWin组件的Web框架都需要一个StartUp入口类，用来声明OWin组件：</p> <ol><li><p>项目会自动扫描程序集根下的名为StartUp的类作为入口类</p></li> <li><p>通过添加 [assembly: OwinStartup(typeof(SignalRDEMO.Startup))] 标签标记入口类</p></li></ol> <p><strong>官方文档</strong></p> <p><a href="https://docs.microsoft.com/zh-cn/aspnet/signalr/" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/aspnet/signalr/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>常用的推送方式</strong></p> <p>以下列出其他推送方式：</p> <ul><li><p>所有连接的客户端　　
Clients.All.show(content);</p></li> <li><p>仅调用的客户端
Clients.Caller.show(content);</p></li> <li><p>除调用客户端之外的所有客户端
Clients.Others.show(content);</p></li> <li><p>特定的客户端标识的连接 id
Clients.Client(Context.ConnectionId).show(content);</p></li> <li><p>所有连接的客户端除外指定客户端，由连接 ID 标识
Clients.AllExcept(connectionId1, connectionId2).show(content);</p></li> <li><p>指定组中的所有连接的客户端
Clients.Group(groupName).show(content);</p></li> <li><p>指定组中的所有连接的客户端除外指定客户端，由连接 ID 标识。
Clients.Group(groupName, connectionId1, connectionId2).show(content);</p></li> <li><p>所有连接的客户端指定组中除调用客户端
Clients.OthersInGroup(groupName).show(content);</p></li> <li><p>所有客户端和组列表中的连接 Id
Clients.Clients(ConnectionIds).show(content);</p></li> <li><p>组的列表。
Clients.Groups(GroupIds).show(content);</p></li> <li><p>按名称的用户
Clients.Client(username).show(content); //这里的username我还没理解是怎么创建的</p></li> <li><p>（在 SignalR 2.1 中引入） 的用户名称的列表。
Clients.Users(new string[] { &quot;myUser&quot;, &quot;myUser2&quot; }).show(content)</p></li></ul> <p><strong>关于ConnectionId</strong></p> <p>每个连接的页面都会产生不同的连接id，并且这个连接id是随机产生，不能自定义的</p> <p>集线器中为我们提供了Context对象可以获取到这个连接id</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 返回每个连接的id</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReturnConnectionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Clients<span class="token punctuation">.</span>Caller<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>ConnectionId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code>　　<span class="token comment">//定义推送,返回各个客户端连接</span>
        $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                $<span class="token punctuation">(</span><span class="token string">&quot;#btn_sendConnectionId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    chat<span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">returnConnectionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将客户端的content内容发送到服务端</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>看个例子：</p> <p>zhangsan.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html; charset=utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery-3.4.1.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery.signalR-2.2.2.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/signalr/hub/hubs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">body</span> <span class="token punctuation">{</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">.input</span> <span class="token punctuation">{</span>
            <span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>我是张三<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>发送给李四<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm btn-info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn_send<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>接收到的信息：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataContainer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> chat <span class="token operator">=</span> $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>myChatHub<span class="token punctuation">;</span> <span class="token comment">//连接服务端集线器，demoHub为服务端集线器名称，js上首字母须改为小写（系统默认）</span>
        <span class="token comment">//定义客户端方法，此客户端方法必须与服务端集线器中的方法名称、参数均一致。</span>
        <span class="token comment">//实际上是服务端调用了前端的js方法（订阅）</span>

        $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span>qs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string-property property">'userName'</span><span class="token operator">:</span> <span class="token string">'张三'</span> <span class="token punctuation">}</span>
        chat<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function-variable function">show</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;li&gt;'</span> <span class="token operator">+</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/li&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#dataContainer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//定义推送</span>
        $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn_send&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    chat<span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">callOne</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将客户端的content内容发送到服务端</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//编码</span>
    <span class="token keyword">function</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> encodedValue <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div /&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> encodedValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>lisi.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html; charset=utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery-3.4.1.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery.signalR-2.2.2.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/signalr/hub/hubs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">body</span> <span class="token punctuation">{</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">.input</span> <span class="token punctuation">{</span>
            <span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>我是李四<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>发送给张三<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm btn-info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn_send<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>接收到的信息：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataContainer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> chat <span class="token operator">=</span> $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>myChatHub<span class="token punctuation">;</span> <span class="token comment">//连接服务端集线器，demoHub为服务端集线器名称，js上首字母须改为小写（系统默认）</span>
        <span class="token comment">//定义客户端方法，此客户端方法必须与服务端集线器中的方法名称、参数均一致。</span>
        <span class="token comment">//实际上是服务端调用了前端的js方法（订阅）</span>
        $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span>qs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string-property property">'userName'</span><span class="token operator">:</span> <span class="token string">'李四'</span> <span class="token punctuation">}</span>
        chat<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function-variable function">show</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;li&gt;'</span> <span class="token operator">+</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/li&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#dataContainer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//定义推送</span>
        $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn_send&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    chat<span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">callOne</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将客户端的content内容发送到服务端</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//编码</span>
    <span class="token keyword">function</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> encodedValue <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div /&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> encodedValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>服务端</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 发送给指定连接</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;toName&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;content&quot;&gt;&lt;/param&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CallOne</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> toName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> content<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//根据username获取对应的ConnectionId</span>
            <span class="token class-name"><span class="token keyword">var</span></span> connectionId <span class="token operator">=</span> HttpContext<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Application<span class="token punctuation">[</span>toName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Clients<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span>connectionId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 初次连接</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">string</span></span> username <span class="token operator">=</span> Context<span class="token punctuation">.</span>QueryString<span class="token punctuation">[</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//获取客户端发送过来的用户名</span>
            <span class="token class-name"><span class="token keyword">string</span></span> connectionId <span class="token operator">=</span> Context<span class="token punctuation">.</span>ConnectionId<span class="token punctuation">;</span>
            HttpContext<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Application<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> connectionId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//存储关系</span>
            <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><h3 id="sqldependency-signalr实现数据即时更新"><a href="#sqldependency-signalr实现数据即时更新" class="header-anchor">#</a> SqlDependency+SignalR实现数据即时更新</h3> <p><strong>SqlDependency</strong> 对象表示应用程序和 SQL Server 实例间的查询通知<strong>依赖关系</strong>。应用程序可以创建一个 SqlDependency 对象并进行注册以通过<a href="https://msdn.microsoft.com/zh-cn/library/system.data.sqlclient.onchangeeventhandler.aspx" target="_blank" rel="noopener noreferrer">OnChangeEventHandler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 事件处理程序接收通知。</p> <p>它提供了这样一种能力：当被监测的数据库中的数据发生变化时,SqlDependency会自动触发OnChange事件来通知应用程序,从而达到让系统自动更新数据(或缓存)的目的。</p> <p>应用：数据实时性较高的场景、新闻、监控数据等。</p> <p>可以结合SignalR来实现web的实时数据更新。</p> <p><strong>使用方法</strong></p> <p>sql server设置：ALTER DATABASE <code>&lt;DatabaseName&gt;</code> SET ENABLE_BROKER;语句让相应的数据库启用监听服务，以便支持SqlDependency特性。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> is_broker_enabled <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span><span class="token keyword">databases</span> <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'KeDa2022'</span>

<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> KeDa2022 <span class="token keyword">SET</span> NEW_BROKER <span class="token keyword">WITH</span> <span class="token keyword">ROLLBACK</span> IMMEDIATE<span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> KeDa2022 <span class="token keyword">SET</span> ENABLE_BROKER<span class="token punctuation">;</span>
</code></pre></div><p><strong>配合SignalR实现实时刷新</strong></p> <p>一、App_Start中注册管道,相当于将signalr注册到全局运行对象中</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Owin</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Owin</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">OwinStartup</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SignalRDemo<span class="token punctuation">.</span>App_Start<span class="token punctuation">.</span>Startup</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>

<span class="token keyword">namespace</span> <span class="token namespace">SignalRDemo<span class="token punctuation">.</span>App_Start</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configuration</span><span class="token punctuation">(</span><span class="token class-name">IAppBuilder</span> app<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//注册管道，使用默认虚拟地址，根目录下的signalr</span>
            <span class="token comment">// 有关如何配置应用程序的详细信息，请访问 http://go.microsoft.com/fwlink/?LinkID=316888</span>
            app<span class="token punctuation">.</span><span class="token function">MapSignalR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>二、创建集线器hub</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token comment">//服务端websocket</span>
    <span class="token punctuation">[</span><span class="token function">HubName</span><span class="token punctuation">(</span><span class="token string">&quot;studentService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">studentVMHub</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">Hub</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">//客户端通过proxy object可以直接调用server端的这个方法</span>
        <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Show</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> number<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//获取全局管道中的集线器</span>
            <span class="token class-name">IHubContext</span> content <span class="token operator">=</span> GlobalHost<span class="token punctuation">.</span>ConnectionManager<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetHubContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>studentVMHub<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//调用所有客户注册的本地js方法(displayDatas)</span>
            content<span class="token punctuation">.</span>Clients<span class="token punctuation">.</span>All<span class="token punctuation">.</span><span class="token function">displayDatas</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//client属性：代表所有使用studentVMHub的页面</span>
            <span class="token comment">// content.Clients.All.displayDatas 代表server端调用客户端上的displayDatas方法 也就是javascript方法的名称</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>三、监听SQLDependency</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">studentEntity</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>studentsVM<span class="token punctuation">&gt;</span></span> <span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> sqlconnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;connString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>

                sqlconnection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT Id,StudentName FROM dbo.StudentInfo&quot;</span><span class="token punctuation">,</span> sqlconnection<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    cmd<span class="token punctuation">.</span>Notification <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">SqlDependency</span> dependency <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDependency</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    dependency<span class="token punctuation">.</span>OnChange <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OnChangeEventHandler</span><span class="token punctuation">(</span>dependency_Onchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlconnection<span class="token punctuation">.</span>State <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>Closed<span class="token punctuation">)</span>
                        sqlconnection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">SqlDataReader</span> reader <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">List<span class="token punctuation">&lt;</span>studentsVM<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>studentsVM<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name">studentsVM</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">studentsVM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        m<span class="token punctuation">.</span>Id <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        m<span class="token punctuation">.</span>StudentName <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;StudentName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dependency_Onchange</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">SqlNotificationEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Type <span class="token operator">==</span> SqlNotificationType<span class="token punctuation">.</span>Change<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                studentVMHub<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          
        <span class="token punctuation">}</span>
</code></pre></div><p>四、需在global中注册SQLDependency启动项</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>HttpApplication</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            SqlDependency<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;connString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_End</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//当被监测的数据库中的数据发生变化时,SqlDependency会自动触发OnChange事件来通知应用程序,从而达到让系统自动更新数据(或缓存)的目的。</span>
            SqlDependency<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;connString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>四、客户端调用加载</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>     <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> proxy <span class="token operator">=</span> $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>studentService<span class="token punctuation">;</span>
            <span class="token comment">//定义客户端的javascript </span>
            proxy<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function-variable function">displayDatas</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>大坑：</strong></p> <p>SqlDependency监视表时，监视的字段，必须一一指定，且不能用*,也不能用group by。</p> <h3 id="支付接口调用"><a href="#支付接口调用" class="header-anchor">#</a> 支付接口调用</h3> <p>银联、支付宝支付、微信支付</p> <p>SDK:jar包/dll文件</p> <p>API:接口，http请求访问，得到是json/xml</p> <h4 id="支付宝沙箱"><a href="#支付宝沙箱" class="header-anchor">#</a> 支付宝沙箱</h4> <p><strong>1.注册成为支付宝开发者</strong></p> <p>登录：<a href="https://openhome.alipay.com/develop/sandbox/app%E8%BF%9B%E5%85%A5%E6%B2%99%E7%AE%B1%E8%B4%A6%E5%8F%B7%E3%80%82" target="_blank" rel="noopener noreferrer">https://openhome.alipay.com/develop/sandbox/app进入沙箱账号。<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>2.支付宝沙箱环境</strong></p> <p>申请密钥</p> <p>下载软件：生成应用公钥、应用私钥。</p> <p>应用公钥上传到支付宝，得到支付宝公钥。</p> <p>结论：<strong>应用私钥</strong>和<strong>支付宝公钥</strong></p> <p><strong>3.在.net SDK包</strong></p> <p>配置文件中加入支付宝账号配置：</p> <p>1）配置appid</p> <p>2）配置网关   网关要用沙箱网关<a href="https://openapi.alipaydev.com/gateway.do" target="_blank" rel="noopener noreferrer">https://openapi.alipaydev.com/gateway.do<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>3）上传私钥</p> <p>4）上传支付宝公钥</p> <p>4.<strong>组装阿里请求</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token class-name">DefaultAopClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DefaultAopClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>gatewayUrl<span class="token punctuation">,</span> config<span class="token punctuation">.</span>app_id<span class="token punctuation">,</span> config<span class="token punctuation">.</span>private_key<span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>sign_type<span class="token punctuation">,</span> config<span class="token punctuation">.</span>alipay_public_key<span class="token punctuation">,</span> config<span class="token punctuation">.</span>charset<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 组装业务参数model</span>
            <span class="token class-name">AlipayTradePagePayModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AlipayTradePagePayModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>Body <span class="token operator">=</span> <span class="token string">&quot;苹果14 128G&quot;</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>Subject <span class="token operator">=</span> <span class="token string">&quot;测试123123&quot;</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>TotalAmount <span class="token operator">=</span> <span class="token string">&quot;6499&quot;</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>OutTradeNo <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">&quot;yyyyMMddHHmmss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>ProductCode <span class="token operator">=</span> <span class="token string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span><span class="token punctuation">;</span>

            <span class="token class-name">AlipayTradePagePayRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AlipayTradePagePayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置同步回调地址</span>
        request<span class="token punctuation">.</span><span class="token function">SetReturnUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://localhost:44374/success.aspx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置异步通知接收地址</span>
            request<span class="token punctuation">.</span><span class="token function">SetNotifyUrl</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 将业务model载入到request</span>
            request<span class="token punctuation">.</span><span class="token function">SetBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">AlipayTradePagePayResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exp<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> exp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre></div><h3 id="富文本编辑器"><a href="#富文本编辑器" class="header-anchor">#</a> 富文本编辑器</h3> <p>kindeditor：<a href="http://kindeditor.net/demo.php" target="_blank" rel="noopener noreferrer">http://kindeditor.net/demo.php<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>github地址：<a href="https://github.com/kindsoft/kindeditor" target="_blank" rel="noopener noreferrer">https://github.com/kindsoft/kindeditor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="日志组件"><a href="#日志组件" class="header-anchor">#</a> 日志组件</h3> <p>作用：在项目上线后，对程序中的异常进行收集。</p> <p>上线后，BUG修改起来就很困难。</p> <p>Nlog、log4net</p> <p>作用：进行异常收集、系统日志。</p> <p>步骤：</p> <p>一、下载dll文件 nuget安装</p> <p>二、对插件进行配置</p> <p>三、进行异常收集</p> <h3 id="npoi专业的excel导出组件"><a href="#npoi专业的excel导出组件" class="header-anchor">#</a> NPOI专业的excel导出组件</h3> <h3 id="swaggerui组件"><a href="#swaggerui组件" class="header-anchor">#</a> SwaggerUI组件</h3> <p>管理接口，自动生成接口文档和接口地址，并且提供了接口测试的功能。</p> <h3 id="webuploader控件使用"><a href="#webuploader控件使用" class="header-anchor">#</a> WebUploader控件使用</h3> <p>第一步：下载js包</p> <p>第二步：引入js和css文件注意：需要先引入jQuery</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--引入CSS--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webuploader文件夹/webuploader.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--引入JS--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webuploader文件夹/webuploader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>第三步：初始化组件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>picker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>选择文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imgUrl<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hfImgUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img_url<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> uploader <span class="token operator">=</span> WebUploader<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">auto</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// swf文件路径 </span>
        <span class="token literal-property property">swf</span><span class="token operator">:</span> <span class="token string">'/Scripts/webuploader/Uploader.swf'</span><span class="token punctuation">,</span>
        <span class="token comment">// 文件接收服务端。</span>
        <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token string">'/Uploader/Upload'</span><span class="token punctuation">,</span>
        <span class="token comment">// 选择文件的按钮。可选。</span>
        <span class="token comment">// 内部根据当前运行是创建，可能是input元素，也可能是flash.</span>
        <span class="token literal-property property">pick</span><span class="token operator">:</span> <span class="token string">'#picker'</span><span class="token punctuation">,</span>
        <span class="token comment">// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！</span>
        <span class="token literal-property property">resize</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uploadSuccess'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#imgUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#hfImgUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>第四步：后台写接口接收文件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploaderController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// GET: Uploader</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//formdata</span>
        <span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> Request<span class="token punctuation">.</span>Form<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> file <span class="token operator">=</span> Request<span class="token punctuation">.</span>Files<span class="token punctuation">[</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">SaveAs</span><span class="token punctuation">(</span>Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;/img/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Hashtable</span> ht <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ht<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
        ht<span class="token punctuation">[</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/img/&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span>ht<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="c-框架"><a href="#c-框架" class="header-anchor">#</a> C#框架</h2> <h3 id="asp-net-mvc-介绍"><a href="#asp-net-mvc-介绍" class="header-anchor">#</a> ASP.NET MVC 介绍</h3> <p><strong>ASP.NET MVC和ASP.NET WebForms</strong></p> <ol><li>ASP.NET MVC和WebForm都是.NET中开发Web程序的一种方式，两者是一种并列的关系。</li> <li>WebForm的特点：
<ol><li>所见即所得，开发傻瓜式：服务器端控件、事件模型、状态管理。</li> <li>借鉴了Winform的成功特色。</li> <li>偏离了Web请求处理的原理（请求-&gt;处理-&gt;响应）。</li></ol></li> <li>ASP.NET MVC的特点：
<ol><li>关注分离：
<ol><li>WebForm只是把一个页面分成了前置页面和后置代码，分离的不够彻底。</li> <li>MVC可以把一个页面分成Controller、View、Model三部分，分离的更彻底。</li></ol></li> <li>测试性强。可以针对Controller、View、Model单独进行测试。</li> <li>更加接近Web请求处理的本质。</li></ol></li></ol> <h4 id="asp-net-mvc执行流程"><a href="#asp-net-mvc执行流程" class="header-anchor">#</a> ASP.NET MVC执行流程</h4> <blockquote><p>了解 MVC ASP.NET 如何分步处理浏览器请求。</p></blockquote> <p>对基于 MVC ASP.NET Web 应用程序的请求首先通过 <strong>UrlRoutingModule</strong> 对象（HTTP 模块）。 此模块将分析请求并执行路由选择。 <strong>UrlRoutingModule</strong> 对象选择与当前请求匹配的第一个路由对象。 (路由对象是实现 <strong>RouteBase</strong> 的类，通常是 <strong>Route</strong> class.) 如果没有路由匹配，<strong>则 UrlRoutingModule</strong> 对象不执行任何操作，并允许请求回退到常规 ASP.NET IIS 请求处理。</p> <p>从所选的 <strong>Route</strong> 对象中，<strong>UrlRoutingModule</strong> 对象获取与 <strong>Route</strong> 对象关联的 <strong>IRouteHandler</strong> 对象。 通常，在 MVC 应用程序中，这将是 <strong>MvcRouteHandler 的实例</strong>。 <strong>IRouteHandler</strong> 实例创建 <strong>IHttpHandler</strong> 对象，并传递 <strong>IHttpContext</strong> 对象。 默认情况下， <strong>MVC 的 IHttpHandler</strong> 实例是 <strong>MvcHandler</strong> 对象。 然后 <strong>，MvcHandler</strong> 对象将选择最终处理请求的控制器。</p> <p>MVC Web 项目的执行阶段：</p> <ul><li>接收对应用程序的第一个请求
<ul><li>在 Global.asax 文件中， <strong>Route</strong> 对象将添加到 <strong>RouteTable</strong> 对象。</li></ul></li> <li>执行路由
<ul><li><strong>UrlRoutingModule</strong> 模块使用 <strong>RouteTable</strong> 集合中第一个匹配的 Route 对象来创建 <strong>RouteData</strong> 对象，然后使用该对象创建 <strong>RequestContext</strong> (<strong>IHttpContext</strong>) 对象。</li></ul></li> <li>创建 MVC 请求处理程序
<ul><li><strong>MvcRouteHandler</strong> 对象创建 <strong>MvcHandler</strong> 类的实例，并传递给<strong>它 RequestContext</strong> 实例。</li></ul></li> <li>创建控制器
<ul><li><strong>MvcHandler</strong> 对象使用 <strong>RequestContext</strong> 实例来标识 <strong>IControllerFactory</strong> 对象 (该对象通常是 <strong>DefaultControllerFactory</strong> 类实例) 用于创建控制器实例。</li></ul></li> <li>执行控制器 - <strong>MvcHandler</strong> 实例调用控制器的 <strong>Execute</strong> 方法。 |</li> <li>调用操作
<ul><li>大多数控制器继承自 <strong>Controller</strong> 基类。 对于这样做的控制器， <strong>与控制器关联的 ControllerActionInvoker</strong> 对象确定要调用的控制器类的操作方法，然后调用该方法。</li></ul></li> <li>执行结果
<ul><li>典型的操作方法可能会接收用户输入、准备相应的响应数据，然后通过返回结果类型来执行结果。 可执行的内置结果类型包括： <strong>ViewResult</strong> (它呈现视图，是最常用的结果类型) 、 <strong>RedirectToRouteResult</strong>、 <strong>RedirectResult</strong>、 <strong>ContentResult</strong>、 <strong>JsonResult</strong> 和 <strong>EmptyResult</strong>。</li></ul></li></ul> <h4 id="orm对象关系映射-2"><a href="#orm对象关系映射-2" class="header-anchor">#</a> ORM对象关系映射</h4> <p>什么是ORM
ORM(Object-relational mapping)，中文翻译为对象关系映射，是一种为了解决面向对象与关系数据库存在的互不匹配的现象的技术。简单的说，ORM是通过使用描述对象和数据库之间映射的元数据，将程序中的对象自动持久化到关系数据库中。</p> <p>为什么用ORM
在程序开发中，数据库保存的表，字段与程序中的实体类之间是没有关联的，在实现持久化时就比较不方便。那么，到底如何实现持久化呢？一种简单的方案是采用硬编码方式，为每一种可能的数据库访问操作提供单独的方法。这种方案存在以下不足：</p> <p>1.持久化层缺乏弹性。一旦出现业务需求的变更，就必须修改持久化层的接口
2.持久化层同时与域模型与关系数据库模型绑定，不管域模型还是关系数据库模型发生变化，都要修改持久化曾的相关程序代码，增加了软件的维护难度
ORM提供了实现持久化层的另一种模式，它采用<strong>映射元数据</strong>来描述<strong>对象关系的映射</strong>，使得ORM中间件能在任何一个应用的业务逻辑层和数据库层之间充当桥梁</p> <p>ORM的方法论基于三个核心原则：</p> <p>简单：以最基本的形式建模数据
传达性：数据库结构被任何人都能理解的语言文档化
精确性：基于数据模型创建正确标准化了的结构</p> <p>ORM作用：<strong>实现了数据库的映射</strong>  通俗讲就是2件事：1创建数据模型  2实现底层的增删改查等数据库常规操作</p> <p>常用的ORM</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">.</span><span class="token function">NET</span><span class="token punctuation">(</span>C#<span class="token punctuation">)</span>主流ORM总揽

SqlSugar <span class="token punctuation">(</span>国内<span class="token punctuation">)</span> 轻量化，执行速度快

Dos<span class="token punctuation">.</span>ORM <span class="token punctuation">(</span>国内<span class="token punctuation">)</span>

Chloe <span class="token punctuation">(</span>国内<span class="token punctuation">)</span>

StackExchange<span class="token operator">/</span>Dapper <span class="token punctuation">(</span>国外<span class="token punctuation">)</span> 轻量化，执行速度   

<span class="token return-type class-name">Entity</span> Framework <span class="token punctuation">(</span>EF<span class="token punctuation">)</span> <span class="token punctuation">(</span>国外<span class="token punctuation">)</span> 全能型  懒加载 

NHibernate <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

ServiceStack<span class="token operator">/</span>ServiceStack<span class="token punctuation">.</span>OrmLite <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

linq2db <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

Massive <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

PetaPoco <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

Dapper 公认效率最高
</code></pre></div><p>EF特点：</p> <p>1.自动的为我们创建实体</p> <p>2.提供了丰富的增删改查方法</p> <h4 id="ef的创建"><a href="#ef的创建" class="header-anchor">#</a> EF的创建</h4> <p>CodeFirst:代码优先，先有代码后又数据库。</p> <p>CodeBehind：代码后置，先设计数据库再编写代码。（ 传统）</p> <p>注意：没有绝对好的，各自都有自己的优点和缺点。</p> <p>EF中的两个类</p> <p>DbContext:若干表的一个集合。</p> <p>DbSet：对表映射，提供对表的常规操作方法。</p> <p>方式一：</p> <p>通过VS中的向导工具创建</p> <p>方式二：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">1</span>创建一个DbContext集合类 
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentsContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">StudentsContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">&quot;StudentsEntities&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Users<span class="token punctuation">&gt;</span></span> Users <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  
    <span class="token punctuation">}</span>
<span class="token number">2</span>根据表编写类 
   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> UserId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Nullable<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> IsDelete <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ImageUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Pwd <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token number">3</span>将类注册在数据库上下文对象中
 <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Users<span class="token punctuation">&gt;</span></span> Users <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>CodeFirst      代码优先</p> <p>程序设计时，优先编写代码，通过相关工具生成数据库。</p> <p>CodeBehind 代码后置</p> <p>程序设计时，先设计数据库，然后编写代码。</p> <p>注意：本身两种模式互有优缺点。</p> <p>作业：使用Dapper实现MVC下的绑定</p> <p>思考：1CodeBehind和CodeFirst</p> <p>​           2EF和Dapper SqlSuger三款ORM的区别各自的特点</p> <p>​           3Razor语法</p> <p>懒加载（惰性加载）：</p> <p>目的：提高效率，</p> <p>EF是一个虚拟的数据库，</p> <p>1.在查询时，EF给的数据在渲染页面的时候才能看见；</p> <p>2.EF在操作数据时，如果不进行db.SaveChanges()那么将一直保存惰性加载机制</p> <p>注意：调试过程中可以使用.ToLis()结束懒加载</p> <h4 id="ienumerable、iqueryable、list-2"><a href="#ienumerable、iqueryable、list-2" class="header-anchor">#</a> IEnumerable、IQueryable、List</h4> <p>IEnumerable：C#基础的迭代类型基类。如果一个对象可以迭代，那么他必须继承IEnumerable</p> <p>IQueryable:迭代类型，他继承自IEnumerable，他的功能会更加丰富。</p> <p>List：迭代类型，他继承自IQueryable,他的功能更加丰富。</p> <p>注意：在开发中我们一般可以使用IQueryable和List，但是区别在于</p> <p><strong>List会结束EF惰性加载，而IQueryable不会结束惰性加载</strong></p> <h4 id="entityframework查询"><a href="#entityframework查询" class="header-anchor">#</a> EntityFramework查询</h4> <p>目标：本节主要为演示不同操作方式下的基本查询和联合查询。</p> <p><strong>LINQ</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span><span class="token keyword">from</span> p <span class="token keyword">in</span> dbcontext<span class="token punctuation">.</span>student <span class="token keyword">select</span> p
</code></pre></div><p><strong>SQL</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//1使用SqlQuery进行单表查询</span>
dbcontext<span class="token punctuation">.</span>Student<span class="token punctuation">.</span><span class="token function">SqlQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2使用SqlQuery进行复杂语句查询</span>
dbcontext<span class="token punctuation">.</span>DataBaSE<span class="token punctuation">.</span><span class="token function">SqlQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Lambda</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span>dbcontext<span class="token punctuation">.</span>Student<span class="token punctuation">;</span>
</code></pre></div><p><strong>视图</strong></p> <p><strong>EF操作存储过程</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//查询</span>
<span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> sqlparms<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            sqlparms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">&quot;@ID&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sqlparms<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">&quot;@name&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SqlQuery</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;exec selectTable @ID,@name&quot;</span><span class="token punctuation">,</span> sqlparms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//操作</span>
<span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">NHibernateContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NHibernateContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SqlParameter</span> name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">&quot;@Name&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlParameter</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">&quot;@Phone&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> count <span class="token operator">=</span> context<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token function">ExecuteSqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;exec [proc_AddSysUser01] @Name,@Phone&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="actionresult的常用返回类型"><a href="#actionresult的常用返回类型" class="header-anchor">#</a> ActionResult的常用返回类型</h4> <p>View创建一个强类型页面</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//1返回相应路径下强类型页面</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2返回相应路径下强类型页面并传递数据</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token comment">//3返回到特定页面</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token string">&quot;Index&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//4返回特定页面并传递数据</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span>obj<span class="token punctuation">)</span>

</code></pre></div><p>Content返回字符串</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">return</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;script&gt;javascript&lt;/script&gt;&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>Json返回JSON</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">return</span> <span class="token function">JSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>返回对象，需要设置参数JsonRequestBehavior.AllowGet，允许GET请求。</p> <p>RedirctToAction请求重定向</p> <h4 id="viewdata和viewbag"><a href="#viewdata和viewbag" class="header-anchor">#</a> ViewData和ViewBag</h4> <p>Action向视图传递数据可以使用return View()</p> <p>只能传递一个对象过去。</p> <p>如果想传递多个对象到视图页面，使用ViewData和ViewBag</p> <p>ViewData不会保存数据类型，效率略微高</p> <p>ViewBag会保存数据类型，效率略微低（可以忽略不计）</p> <h4 id="razor"><a href="#razor" class="header-anchor">#</a> Razor</h4> <p>Razor 支持 C#，并使用 <code>@</code> 符号从 HTML 转换为 C#。 Razor 计算 C# 表达式，并将它们呈现在 HTML 输出中。</p> <p>当符号 <code>@</code> 后跟保留 <a href="https://docs.microsoft.com/zh-cn/aspnet/core/mvc/views/razor?view=aspnetcore-6.0#razor-reserved-keywords" target="_blank" rel="noopener noreferrer">Razor 关键字<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>时，它将转换为 Razor特定于 的标记。 否则会转换为纯 HTML。</p> <p>若要对 Razor 标记中的 <code>@</code> 符号进行转义，请使用另一个 <code>@</code> 符号：</p> <div class="language-cshtml extra-class"><pre class="language-cshtml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>@@Username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>隐式 Razor 表达式</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>@DateTime<span class="token punctuation">.</span>Now<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre></div><p><strong>显式 Razor 表达式</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Last week <span class="token keyword">this</span> time<span class="token punctuation">:</span> @<span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now <span class="token operator">-</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromDays</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre></div><p><strong>Razor 代码块</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token class-name"><span class="token keyword">var</span></span> quote <span class="token operator">=</span> <span class="token string">&quot;The future depends on what you do today. - Mahatma Gandhi&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>@quote<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

@<span class="token punctuation">{</span>
    quote <span class="token operator">=</span> <span class="token string">&quot;Hate cannot drive out hate, only love can do that. - Martin Luther King, Jr.&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>@quote<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre></div><p><strong>复合语句 <code>@using</code></strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@<span class="token keyword">using</span> <span class="token punctuation">(</span>Html<span class="token punctuation">.</span><span class="token function">BeginForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        Email<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token class-name">input</span> type<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;Email&quot;</span> <span class="token keyword">value</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>Register<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>@inject</code></strong></p> <p><code>@inject</code> 指令允许 Razor 页面将服务从<a href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-6.0" target="_blank" rel="noopener noreferrer">服务容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>注入到视图。</p> <p><strong><code>@layout</code></strong></p> <p><em>此方案仅适用于 Razor 组件 (<code>.razor</code>)。</em></p> <p><code>@layout</code> 指令为具有 <a href="https://docs.microsoft.com/zh-cn/aspnet/core/mvc/views/razor?view=aspnetcore-6.0#page" target="_blank" rel="noopener noreferrer"><code>@page</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指令的可路由 Razor 组件指定布局。 布局组件用于避免代码重复和不一致。 有关详细信息，请参阅 ASP.NET Core<a href="https://docs.microsoft.com/zh-cn/aspnet/core/blazor/components/layouts?view=aspnetcore-6.0" target="_blank" rel="noopener noreferrer">Blazor布局<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong><code>@model</code></strong></p> <p><em>此方案仅适用于 MVC 视图和 Razor Pages (<code>.cshtml</code>)。</em></p> <p><code>@model</code> 指令指定传递到视图或页面的模型类型：</p> <div class="language-cshtml extra-class"><pre class="language-cshtml"><code><span class="token directive"><span class="token keyword">@model</span> <span class="token csharp language-csharp">TypeNameOfModel</span></span>
</code></pre></div><p>官方文档：<a href="https://docs.microsoft.com/zh-cn/aspnet/core/mvc/views/razor?view=aspnetcore-6.0" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/aspnet/core/mvc/views/razor?view=aspnetcore-6.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="viewstart"><a href="#viewstart" class="header-anchor">#</a> ViewStart</h4> <p>_Viewstart.cshtml是一个在呈现View文件的时候的启动文件，会在所有View（.cshtml）被执行之前执行，主要用于一些不方便或不能在母版（_Layout.cshtml）中进行的统一操作，譬如你有很多个没有继承关系的母版或不使用母版的单页。</p> <h4 id="分组视图"><a href="#分组视图" class="header-anchor">#</a> 分组视图</h4> <p>ASP.NET MVC中提供了分组视图的概念，分别为以下几种：</p> <p>@HTML.Partial(&quot;&quot;):在视图中引入其他HTML。</p> <p>@HTML.RenderPartial(&quot;&quot;):和partial作用相同，区别为该方法会将分布视图写入输出流，性能略好。但是只能放入代码块中。</p> <p>@HTML.RenderAction(&quot;&quot;):在视图中引入其他视图，其为一次独立请求，所以会经过Action。</p> <p>@RenderBody:私有区域占位，类似于母版页的ContentPlaceHolder</p> <p>@RenderSection(&quot;scripts&quot;,required:true/false):用于修饰页面差异化效果，当required设置为true时，继承的页面必须实现@section  xx{}独立区域。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token return-type class-name">@section</span> scripts<span class="token punctuation">{</span>
   你好
<span class="token punctuation">}</span>
</code></pre></div><h4 id="前后端分离和非前后端分离"><a href="#前后端分离和非前后端分离" class="header-anchor">#</a> 前后端分离和非前后端分离</h4> <p>非完全前后端分离：</p> <p>1.所有功能在一个项目中（ASP.NET WebForm、ASP.NET MVC、Servlet+JSP、SpringMVC+JSP）   VS/IJ</p> <p>2.不纯正的前后端分离，调用一些前端组件，前端组件写在View里</p> <p>3.只是通过ajax来进行请求和提交</p> <p>完全的前后端分离：</p> <p>后端：不写页面，只写接口</p> <p>前端：只写页面，不管数据</p> <p>前后端分离的数据交互是靠ajax，需要配置跨域</p> <p>非完全前后端分离 ASP.NET MVC+LAYUI</p> <p>完全前后端分离    ASP.NET Core+Vue+ElementUI</p> <h4 id="前端框架"><a href="#前端框架" class="header-anchor">#</a> 前端框架</h4> <p>组件框架：</p> <p>1）UI类型框架：提供了丰富的页面组件，美化界面，减少css代码编写，bootstrap。 实现布局样式效果。</p> <p>2）组件类型框架：adminui、layui、elementui、vantui、kendoui、easyui...。1拥有他的布局样式效果。2提供组件（javascript）</p> <p>前端超集(类库)：</p> <p>jQuery框架:简化javascritp中的DOM操作</p> <p>vue：简化dom操作  基于MVVM</p> <p>react：基于MVVM</p> <p>angular：基于MVVM</p> <h4 id="区域"><a href="#区域" class="header-anchor">#</a> 区域</h4> <p>一个ASP.NET MVC Web项目的一个子站。</p> <p>区域拥有独立的路由组件。</p> <p>独立的M、V、C部分。</p> <h4 id="bundler打包"><a href="#bundler打包" class="header-anchor">#</a> Bundler打包</h4> <p>使用Bundle技术可以避免造成很多资源浪费与性能的牺牲。</p> <p>通俗的说bundler就是将资源文件进行打包</p> <p>bundle的配置</p> <p>ScriptBundle类：设置脚本引用名称</p> <p>StyleBundle类：设置样式名称</p> <p>Include方法：设置引入文件位置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BundleConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterBundles</span><span class="token punctuation">(</span><span class="token class-name">BundleCollection</span> bundles<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundles/jquery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                  <span class="token comment">//动态参数</span>
                        <span class="token string">&quot;~/Scripts/jquery-{version}.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundles/jqueryval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;~/Scripts/jquery.validate*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundles/modernizr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;~/Scripts/modernizr-*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundles/bootstrap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                      <span class="token string">&quot;~/Scripts/bootstrap.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">StyleBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/Content/css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                      <span class="token string">&quot;~/Content/bootstrap.css&quot;</span><span class="token punctuation">,</span>
                      <span class="token string">&quot;~/Content/site.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundler/customer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                <span class="token string">&quot;~/Scripts/a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span><span class="token string">&quot;~/Scripts/b.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>在Global中添加打包器的设置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//global.asax</span>
<span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FilterConfig<span class="token punctuation">.</span><span class="token function">RegisterGlobalFilters</span><span class="token punctuation">(</span>GlobalFilters<span class="token punctuation">.</span>Filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加打包配置</span>
    BundleConfig<span class="token punctuation">.</span><span class="token function">RegisterBundles</span><span class="token punctuation">(</span>BundleTable<span class="token punctuation">.</span>Bundles<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>页面上引入</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//_Layout.cshtml</span>
@Styles<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span><span class="token string">&quot;~/Content/css&quot;</span><span class="token punctuation">)</span><span class="token comment">//样式引入</span>
@Scripts<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundles/modernizr&quot;</span><span class="token punctuation">)</span><span class="token comment">//脚本引入</span>
</code></pre></div><p>Bundle相对于原始资源的引用，主要好处体现在了资源的获取效率上，其加载的文件以304进行修改，节约了带宽，浏览器加载速度更快。</p> <h4 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h4> <p>ASP.NET MVC 使用的路由进行URI资源定向的。</p> <p>框架中允许我们对路径进行配置</p> <p>规则一：静态路由配置</p> <p>说明：静态路由配置实际上就是写死</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">url</span><span class="token punctuation">:</span> <span class="token string">&quot;Home/Index&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>规则二：动态路由配置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">url</span><span class="token punctuation">:</span> <span class="token string">&quot;{controller}/{action}/{id}&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;AAA&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>规则三：比较常用配置(动态路由)</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">url</span><span class="token punctuation">:</span> <span class="token string">&quot;{controller}/{action}/{brand}-{cate}-{color}&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>规则四：可变长路由</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;MyRoute&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;{controller}/{action}/{id}/{*catchall}&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>规则五：跨命名空间路由</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
    <span class="token string">&quot;MyRoute&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;{controller}/{action}/{id}/{*catchall}&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;URLsAndRoutes.AdditionalControllers&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;UrlsAndRoutes.Controllers&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>规则六：正则表达式匹配路由</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;MyRoute&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;{controller}/{action}/{id}/{*catchall}&quot;</span><span class="token punctuation">,</span>

 <span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span><span class="token punctuation">,</span>

 <span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;^H.*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;URLsAndRoutes.Controllers&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>规则七：制定请求方法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;MyRoute&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;{controller}/{action}/{id}/{*catchall}&quot;</span><span class="token punctuation">,</span>

<span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;^H.*&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index|About&quot;</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token function">newHttpMethodConstraint</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;URLsAndRoutes.Controllers&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>特性路由</strong></p> <p>特性==注解 AOP</p> <p>MVC5提供了RouteAttribute</p> <p>使用时需要先在路由注册方法中标识</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapMvcAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>常用配置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Login&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{id:int}&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{name}&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RoutePrefix</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>路由前缀，加在控制器上
</code></pre></div><h4 id="filter拦截器-过滤器"><a href="#filter拦截器-过滤器" class="header-anchor">#</a> Filter拦截器（过滤器）</h4> <p>AOP：面向切面编程</p> <p>OOP：面向对象编程</p> <p>拦截比较适合做：登录状态验证、权限、场景限制</p> <p><strong>概念</strong></p> <p>特性（Attribute）是用于在运行时传递程序中各种元素（比如类、方法、结构、枚举、组件等）的行为信息的声明性标签。您可以通过使用特性向程序添加声明性信息。一个声明性标签是通过放置在它所应用的元素前面的方括号（[ ]）来描述的。</p> <p>特性（Attribute）用于添加元数据，如编译器指令和注释、描述、方法、类等其他信息。.Net 框架提供了两种类型的特性：预定义特性和自定义特性</p> <p>[HttpPost]</p> <p>[LoginFilter]</p> <p><strong>过滤器的类型与作用</strong></p> <p>MVC给我们提供了四种过滤器，基本满足了我们实际业务中常用的需求，包括以下：</p> <table><thead><tr><th>过滤器类型名称</th> <th>实现的接口</th> <th>默认的实现类</th> <th>作用</th> <th>执行的顺序与节点</th></tr></thead> <tbody><tr><td>授权过滤器</td> <td>IAuthorizationFilter</td> <td>AuthorizeAttribute</td> <td>用于限制进入控制器或控制器的某个行为方法</td> <td>在控制器方法调用前执行，所有过滤器中最先执行的</td></tr> <tr><td>动作过滤器</td> <td>IActionFilter</td> <td>ActionFilterAttribute</td> <td>用于进入动作方法之前或之后的处理</td> <td>在控制器方法调用前/后执行</td></tr> <tr><td>结果过滤器</td> <td>IResultFilter</td> <td>ActionFilterAttribute</td> <td>用于动作方法返回结果之前或之后的处理</td> <td>在控制器方法调用完，跳转至view页面前/后执行</td></tr> <tr><td>异常处理过滤器</td> <td>IExceptionFilter</td> <td>HandleErrorAttribute</td> <td>用于处理某个动作方法或某个控制器里面抛出的异常</td> <td>在控制器方法抛出异常时执行</td></tr></tbody></table> <p>这四种类型的接口是MVC对过滤器的一个接口规范，同时MVC默认通过<strong>AuthorizeAttribute</strong>(授权)、<strong>HandleErrorAttribute</strong>(异常处理)、<strong>ActionFilterAttribute</strong>(动作和结果)三个类实现了这四个接口。</p> <p>需要注意的是ActionFilterAttribute类既实现了IActionFilter接口，也实现了IResultFilter接口。这是个抽象类，要求必须提供一个实现，AuthorizeAttribute和HandleErrorAttribute类则包含了一些有用的特性，可以不必创建派生类进行使用。所以我们一般都会通过继承ActionFilterAttribute类，实现自定义的过滤器。</p> <p>除以上接口之外，我们还要用到FilterAttribute类，这个类将我们的过滤器包装成了特性，使我们的过滤器可以方便的在Action方法上方使用。</p> <p><strong>ActionFilterAttribute</strong></p> <p>OnActionExecuting</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//该方法会在action方法执行之前调用  </span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnActionExecuting</span><span class="token punctuation">(</span><span class="token class-name">ActionExecutingContext</span> filterContext<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuting，我在action方法调用钱执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnActionExecuting</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
</code></pre></div><p>OnActionExecuted</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//该方法会在action方法执行之后调用  </span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnActionExecuted</span><span class="token punctuation">(</span><span class="token class-name">ActionExecutedContext</span> filterContext<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuted，我在action方法调用后执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnActionExecuted</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span> 
</code></pre></div><p><strong>ResultFilter</strong></p> <p>OnResultExecuting</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//在action方法返回结果之前执行  </span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResultExecuting</span><span class="token punctuation">(</span><span class="token class-name">ResultExecutingContext</span> filterContext<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuting，我action方法返回结果之前执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnResultExecuting</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span> 
</code></pre></div><p>OnResultExecuting</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//在action方法返回结果之后执行</span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResultExecuting</span><span class="token punctuation">(</span><span class="token class-name">ResultExecutingContext</span> filterContext<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuting，我action方法返回结果之前执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnResultExecuting</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span> 
</code></pre></div><p>注意：上述两种过滤器中的方法都是一样的，只是执行位置不一样。</p> <p>用途：当我们需要跳过一些验证规则时，可以在此处获取Action或者Controller信息</p> <p><strong>AuthorizeAttribute</strong></p> <p>该过滤器在所有action方法过滤器之前执行，也就是说，提供了一个可以超前验证的方法。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//在所有action方法过滤器之前执行  </span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnAuthorization</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationContext</span> filterContext<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnAuthorization，在所有action方法过滤器之前执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">//base.OnAuthorization(filterContext);  </span>
<span class="token punctuation">}</span>  
</code></pre></div><p><strong>HandleErrorAttribute</strong></p> <p>异常拦截器接口</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionContext</span> filterContext<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> controller <span class="token operator">=</span> filterContext<span class="token punctuation">.</span>RouteData<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token string">&quot;controller&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name"><span class="token keyword">string</span></span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">string</span></span> action <span class="token operator">=</span> filterContext<span class="token punctuation">.</span>RouteData<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token string">&quot;action&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name"><span class="token keyword">string</span></span><span class="token punctuation">;</span>

    filterContext<span class="token punctuation">.</span>RequestContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Write
        <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;{0}:{1}发生异常!{2}&quot;</span><span class="token punctuation">,</span> controller<span class="token punctuation">,</span> action<span class="token punctuation">,</span> filterContext<span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//表示是否已处理异常</span>
    filterContext<span class="token punctuation">.</span>ExceptionHandled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    filterContext<span class="token punctuation">.</span>Result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedirectResult</span><span class="token punctuation">(</span><span class="token string">&quot;/404.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//base.OnException(filterContext);</span>
<span class="token punctuation">}</span>
</code></pre></div><p>拦截器使用三种方式：</p> <p>1直接在Action上进行拦截</p> <p>2将特性加在控制器上进行拦截</p> <p>3对整个站点进行拦截</p> <h4 id="模型注解"><a href="#模型注解" class="header-anchor">#</a> 模型注解</h4> <p>前端：提示用户输入有效的信息</p> <p>后端：验证数据的有效性</p> <p><strong>什么是验证，数据注解</strong></p> <p>验证 从全局来看，发现逻辑仅是整个验证的很小的一部分。验证首先需要管理用户友好(本地化)的与验证逻辑相关的错误提示消息；当验证失败时，在把这些错误提示消息呈现给用户界面上，当然还要向用户提供从验证失败中恢复的机制。</p> <p>数据注解 注解是一种通用机制，可以用来向框架注入元数据，同时，框架不只驱动元数据的验证，还可以在生成显示和编辑模型的HTML标记时使用元数据。通俗的说就是模型上面的特定标识符(具有一定意义和作用)。</p> <p><strong>验证注解的使用</strong></p> <p>数据注解定义在一般在命名空间”System.ComponentModel.DataAnnotations”提供了服务器端验证的功能，在模型属性上使用时，框架也支持客户端验证。注解后面都是可以添加错误提示语的,ErrorMessage是每个验证特性中用来设置错误提示消息的参数，比如:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;不能为空&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><ul><li><p>Required 强调属性是必须的，不可为空。当属性中有一个是null或空时，会引发一个验证错误。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>StringLength 要求必须输入名字的长度。参数可以限制最小的。如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StringLength</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span>MinimumLength <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>RegularExpression 正则表达式验证，比如邮箱等需要验证正则的地方。很是方便，这样就减少了服务端的验证。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">[RegularExpression(@&quot;^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+&quot;,ErrorMessage = &quot;邮箱输入有误，重新输入。&quot;)]        
public string Email</span> <span class="token punctuation">{</span> get<span class="token punctuation">;</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Range 用来指定数值类型值得最小值和最大值。主要为int类型服务。其余的也可以，需要使用构造函数的重载版本。Type参数来做。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Range</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
</code></pre></div></li></ul> <p>[Range(20,30,ErrorMessage = &quot;年龄不符合要求&quot;)] public int Age { get; set; }</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Range</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">decimal</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;0.00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;59.99&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Price <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><hr> <ul><li><p>Compare 确定两个模型属性拥有一样的值。密码的验证(输入两次，看二者是否一样。)，参数为前面模型的值。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;密码不能为空&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Compare</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Password&quot;</span><span class="token punctuation">,</span>ErrorMessage<span class="token operator">=</span><span class="token string">&quot;两次密码输入不正确&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PasswordPalt <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Remote 此特性利用服务器端的回调函数执行客户端的验证逻辑。通俗的说就是这个特性可以直接找到某个控制器的action并且执行其中的方法。</p></li></ul> <p><img src="https://upload-images.jianshu.io/upload_images/1403717-1eed793b7f59f57d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/691/format/webp" alt="img"></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 验证模型中输入的姓名是否和数据库中重复</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">JsonResult</span> <span class="token function">CheckUserName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>            <span class="token comment">//数据库中的相关验证</span>
        <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>JsonRequestBehavior<span class="token punctuation">.</span>AllowGet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><hr> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Remote</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;CheckUserName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Admin&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>上面控制器操作会利用与UserName属性同名的参数进行验证，同时返回一个javascript object Notaion(json)对象中的布尔类型值(0/1)</p> <ul><li><p>自定义回复消息占位符 使用{0}占位符，来显示用户的输入，并且形成友好提示。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Range</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span>ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;年龄{0}不符合要求&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
</code></pre></div></li> <li><p>服务端的一些处理(验证与绑定) ASP.NET MVC的验证特性是由模型绑定器，模型元数据，模型验证器和模型状态组成。</p></li></ul> <p><strong>注解的验证</strong></p> <p>一：前端的验证</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//1需要使用@Html.TextBoxFor(x=&gt;x.name)标签   注意：不是必须使用，不用比较麻烦</span>
<span class="token comment">//2需要配合@Html.ValidationMessageFor(x=&gt;x.name)</span>
<span class="token comment">//3需要引入三个前端脚本 jquery.js  validate.js  validate.unobtrusive.js</span>
</code></pre></div><p>二：后端验证</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>ModelState<span class="token punctuation">.</span>IsValid进行验证，当验证成功时次属性为<span class="token boolean">true</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ModelState<span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     <span class="token comment">//调用EF进行添加</span>
     <span class="token comment">//db.Students.Add(model);</span>
     db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entry</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Students<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Added<span class="token punctuation">;</span>
     db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>显示和编辑注解</strong></p> <ul><li><p>Display 显示模型属性设置友好的“显示名称”</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Display</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">&quot;姓名&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StringLength</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span>MinimumLength <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>ScaffoldColumn 可以隐藏HTML的辅助方法</p></li></ul> <p><img src="https://upload-images.jianshu.io/upload_images/1403717-c3a33425b235e950.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/691/format/webp" alt="img"></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ScaffoldColumn</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Address <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><ul><li><p>DisplayFormat 处理属性各种格式化选项，当属性包含空值，可以提供可选的显示文本。也可以为包含标记的属性关闭HTML编码。还可以运行时指定一个应用于属性值的格式化字符串。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DisplayFormat</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ApplyFormatInEditMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>DataFormatString <span class="token operator">=</span> <span class="token string">&quot;{0:c}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Total <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>ReadOnly 可以确保默认的模型绑定器不使用请求中的新值来更新属性。</p></li> <li><p>DataType 运行时提供关于属性的特定用途信息。String类型的属性可应用于很多场合--可以保存e-mail地址，URL或密码。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;密码不能为空&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DataType</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DataType<span class="token punctuation">.</span>Password<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p>UIHint 给运行时提供一个模版名称，以备调用模版辅助方法渲染输出时使用。</p> <p><strong>自定义验证逻辑</strong></p> <p>1:将验证逻辑封装在自定义的数据注解中。 2:将验证逻辑封装在模型对象中。 把验证逻辑封装在自定义的数据注解中可以轻松地实现在多个模型中重用逻辑。需要在特性内部编写代码以应对不同类型的模型中。</p> <ul><li>自定义注解 所有的验证注解特性最终都派生自基类ValidationAttribute,它是个抽象类，在System.ComponentMode.DataAnnotation中定义。同样自定义的验证逻辑必须派生自ValidationAttribute的类。且重写IsValid方法(方法里面实现我们相应的逻辑)。</li></ul> <p>需求：限制用户输入地址中单词数量，设定一个最大值。</p></li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 自定义模型验证</span>
<span class="token comment">/// 输入数字的单词最大数量</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxWordsAttribute</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">ValidationAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> _maxWord<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MaxWordsAttribute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> maxWord<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _maxWord <span class="token operator">=</span> maxWord<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">ValidationResult</span> <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span><span class="token class-name">ValidationContext</span> validationContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//将输入转换为string类型</span>
            <span class="token class-name"><span class="token keyword">var</span></span> valueAsString <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//使用split(' ')空格来分隔输入值，统计生成字符串的数量。对数目比较验证。</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>valueAsString<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length<span class="token operator">&gt;</span>_maxWord<span class="token punctuation">)</span>      
            <span class="token punctuation">{</span>
                 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationResult</span><span class="token punctuation">(</span><span class="token string">&quot;单词超过长度&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//string类型</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ValidationResult<span class="token punctuation">.</span>Success<span class="token punctuation">;</span>         <span class="token comment">//bool类型</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第一个参数要验证对象中的值。后面进行逻辑的判断。这样做这里的错误提示不能显示到前台。我们需要修改下，使用ValidationAttrubute的ErrorMessage属性来自定义提示错误消息。</p> <ul><li>修改之后</li></ul> <hr> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxWordsAttribute</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">ValidationAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> _maxWord<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MaxWordsAttribute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> maxWord<span class="token punctuation">)</span>
        <span class="token punctuation">:</span><span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">&quot;{0} has too many words&quot;</span><span class="token punctuation">)</span>     
    <span class="token punctuation">{</span>
        _maxWord <span class="token operator">=</span> maxWord<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">ValidationResult</span> <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span><span class="token class-name">ValidationContext</span> validationContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//将输入转换为string类型</span>
            <span class="token class-name"><span class="token keyword">var</span></span> valueAsString <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//使用split(' ')空格来分隔输入值，统计生成字符串的数量。对数目比较验证。                </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>valueAsString<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length<span class="token operator">&gt;</span>_maxWord<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> errorMessage <span class="token operator">=</span> <span class="token function">FormatErrorMessage</span><span class="token punctuation">(</span>validationContext<span class="token punctuation">.</span>DisplayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationResult</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ValidationResult<span class="token punctuation">.</span>Success<span class="token punctuation">;</span>         <span class="token comment">//bool类型</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="asp-net-mvc-项目创建"><a href="#asp-net-mvc-项目创建" class="header-anchor">#</a> ASP.NET MVC 项目创建</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--数字转换成汉字--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token punctuation">{</span><span class="token punctuation">{</span>#<span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>sex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>男<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span># <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>sex <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>女<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span># <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--时间戳转换成时间--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-createTime<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token punctuation">{</span><span class="token punctuation">{</span>layui<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">toDateString</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>createTime<span class="token punctuation">,</span> <span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--数据表格头部按钮--&gt;</span>    这个使用时是在table.render中的toolbar属性后写:&quot;#user-toolbar&quot;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-toolbar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;pear-btn pear-btn-primary pear-btn-md&quot;</span> lay<span class="token operator">-</span>event<span class="token operator">=</span><span class="token string">&quot;add&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;layui-icon layui-icon-add-1&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>
        新增
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--单行数据后的按钮--&gt;</span>    这个使用时是在table.render中的cols属性中的对象的toolbar属性后写:&quot;#user-toolbar&quot;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>barDemo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;layui-btn layui-btn-warm layui-btn-xs&quot;</span> lay<span class="token operator">-</span>event<span class="token operator">=</span><span class="token string">&quot;edit&quot;</span><span class="token operator">&gt;</span>编辑<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;layui-btn layui-btn-danger layui-btn-xs&quot;</span> lay<span class="token operator">-</span>event<span class="token operator">=</span><span class="token string">&quot;del&quot;</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="项目创建"><a href="#项目创建" class="header-anchor">#</a> 项目创建</h4> <p>1、创建新项目；</p> <p>2、选择使用**ASP.NET Web应用程序（.NET Framework）**模板；</p> <p>3、更改项目名称及存储位置；</p> <p>4、选择空，右侧勾选MVC，最后点击创建。</p> <p>5、右键解决方案-&gt;添加-&gt;新建项目-&gt;选择<strong>类库（.NET Framework）</strong>。重复四次操作，创建四个类库。分别为Entity、Repository、Service、ViewModel。（后续还会再添加）</p> <p>6、添加一个我们常用的工具集类库，该工具集主要是一些常用的操作类。</p> <p>Gitee地址：<a href="https://gitee.com/kuiyu/dotnetcodes" target="_blank" rel="noopener noreferrer">https://gitee.com/kuiyu/dotnetcodes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>项目下载下来，把文件复制到自己的项目中，安装对应的包重新生成无报错即可（不需要的功能可暂时从项目中排除）。</p> <h4 id="model层"><a href="#model层" class="header-anchor">#</a> Model层</h4> <p>右键添加，选择<strong>ADO.NET实体数据模型</strong>。（命名一般为数据库名+DbContext；例如：MFDbContext）</p> <ol><li>来自数据库的EF设计器：</li> <li>来自数据库的Code First：</li></ol> <p>两种方式都行，第一种会卡住一段时间，反应较慢且不便于修改。笔者目前推荐使用第二种，一直点击下一步，连接上数据库即可。</p> <p>添加完成后，将App.config中的字符串复制到UI层的Web.config文件中。</p> <p>复制的字符串应该是如下样子，内容应该不同：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MFDbContext<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data source=127.0.0.1,1433;initial catalog=MF;user id=sa;password=sa;MultipleActiveResultSets=True;App=EntityFramework<span class="token punctuation">&quot;</span></span> <span class="token attr-name">providerName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Data.SqlClient<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="ui层"><a href="#ui层" class="header-anchor">#</a> UI层</h4> <h5 id="_1、global-asax-cs文件"><a href="#_1、global-asax-cs文件" class="header-anchor">#</a> 1、Global.asax.cs文件</h5> <p>1、安装Autofac和Autofac.Mvc5</p> <p>2、Global.asax编写配置文件，使用Autofac实现依赖注入。</p> <p>编写一个AutofacRegister方法。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 1、创建 Autofac 容器</span>
            <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContainerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 2、注册MVC控制器（注册所有到控制器，控制器注入，就是需要在控制器的构造函数中接收对象）PropertiesAutowired：允许属性注入</span>
            builder<span class="token punctuation">.</span><span class="token function">RegisterControllers</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MvcApplication</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 3、注册服务类和接口</span>

            <span class="token preprocessor property">#<span class="token directive keyword">region</span> 按程序集注入</span>
            <span class="token class-name">Assembly</span> repository <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;MF.Repository&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//注入所有非抽象成员</span>
            builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Assembly</span> service <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;MF.Service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//注入所有非抽象成员</span>
            builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

            <span class="token comment">// 4、构建容器</span>
            <span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 5、设置依赖解析器（Autofac.Mvc5）</span>
            DependencyResolver<span class="token punctuation">.</span><span class="token function">SetResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutofacDependencyResolver</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>在Global.asax.cs文件中的Application_Start方法中调用该方法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>HttpApplication</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//注册容器</span>
        <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 1、创建 Autofac 容器</span>
            <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContainerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 2、注册MVC控制器（注册所有到控制器，控制器注入，就是需要在控制器的构造函数中接收对象）PropertiesAutowired：允许属性注入</span>
            builder<span class="token punctuation">.</span><span class="token function">RegisterControllers</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MvcApplication</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 3、注册服务类和接口</span>

            <span class="token preprocessor property">#<span class="token directive keyword">region</span> 按程序集注入</span>
            <span class="token class-name">Assembly</span> repository <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;MF.Repository&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//注入所有非抽象成员</span>
            builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Assembly</span> service <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;MF.Service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//注入所有非抽象成员</span>
            builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

            <span class="token comment">// 4、构建容器</span>
            <span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 5、设置依赖解析器（Autofac.Mvc5）</span>
            DependencyResolver<span class="token punctuation">.</span><span class="token function">SetResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutofacDependencyResolver</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_2、web-config文件"><a href="#_2、web-config文件" class="header-anchor">#</a> 2、Web.config文件</h5> <blockquote><p>**注意：**项目根路径下的Web.config文件，而不是其他文件夹下的。</p></blockquote> <p>该文件要修改数据库的连接字符串。字符串的内容：复制类库</p> <h4 id="repository层"><a href="#repository层" class="header-anchor">#</a> Repository层</h4> <p>增删改查：Insert、Delete、Update、Select</p> <h5 id="接口"><a href="#接口" class="header-anchor">#</a> 接口</h5> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IDepartmentRepository</span>
    <span class="token punctuation">{</span>
        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 基础方法 Insert、Delete、Update、Select、GetModelById</span>
        <span class="token return-type class-name">Department</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Department<span class="token punctuation">&gt;</span></span> <span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Department</span> <span class="token function">GetModelById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 扩展方法</span>
  <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Department<span class="token punctuation">&gt;</span></span> <span class="token function">SqlQuery</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token punctuation">}</span>
</code></pre></div><h5 id="接口实现类"><a href="#接口实现类" class="header-anchor">#</a> 接口实现类</h5> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DepartmentRepository</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDepartmentRepository</span></span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MFDbContext</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MFDbContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 基础方法 Insert、Delete、Update、Select、GetModelById</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Department</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            db<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>department<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Added<span class="token punctuation">;</span>
            db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> department<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            db<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>department<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Deleted<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> flag <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> flag <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            db<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>department<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">|=</span> EntityState<span class="token punctuation">.</span>Modified<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> flag <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> flag <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Department<span class="token punctuation">&gt;</span></span> <span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> db<span class="token punctuation">.</span>Department<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Department</span> <span class="token function">GetModelById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> db<span class="token punctuation">.</span>Department<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 扩展方法</span>
  <span class="token comment">// 通过sql语句进行查询</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Department<span class="token punctuation">&gt;</span></span> <span class="token function">SqlQuery</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sql<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> db<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SqlQuery</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Department<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="service层"><a href="#service层" class="header-anchor">#</a> Service层</h4> <h5 id="接口-2"><a href="#接口-2" class="header-anchor">#</a> 接口</h5> <p>增删改查：Add、Remove、Edit、Query</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IDepartmentService</span>
    <span class="token punctuation">{</span>
        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 基础方法 Add、Remove、Edit、Query、GetModelById</span>
        <span class="token return-type class-name">ResMessage</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">ResMessage</span> <span class="token function">Remove</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">ResMessage</span> <span class="token function">Edit</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">ResMessage</span> <span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Department</span> <span class="token function">GetModelById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 扩展方法</span>
        
        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token punctuation">}</span>
</code></pre></div><h5 id="接口实现类-2"><a href="#接口实现类-2" class="header-anchor">#</a> 接口实现类</h5> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DepartmentService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDepartmentService</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 依赖注入：构造函数注入</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IDepartmentRepository</span> _departmentRepository<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">DepartmentService</span><span class="token punctuation">(</span><span class="token class-name">IDepartmentRepository</span> departmentRepository<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _departmentRepository <span class="token operator">=</span> departmentRepository<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 基础方法 Add、Remove、Edit、Query、GetModelById</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            department<span class="token punctuation">.</span>create_time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> model <span class="token operator">=</span> _departmentRepository<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>department<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ResMessage<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Remove</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> model <span class="token operator">=</span> _departmentRepository<span class="token punctuation">.</span><span class="token function">GetModelById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>model <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> ResMessage<span class="token punctuation">.</span><span class="token function">Fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name"><span class="token keyword">bool</span></span> result <span class="token operator">=</span> _departmentRepository<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token return-type class-name">result <span class="token punctuation">?</span></span> ResMessage<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> ResMessage<span class="token punctuation">.</span><span class="token function">Fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Edit</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Department</span> model <span class="token operator">=</span> _departmentRepository<span class="token punctuation">.</span><span class="token function">GetModelById</span><span class="token punctuation">(</span>department<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>department_name <span class="token operator">=</span> department<span class="token punctuation">.</span>department_name<span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>parent_id <span class="token operator">=</span> department<span class="token punctuation">.</span>parent_id<span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>is_root <span class="token operator">=</span> department<span class="token punctuation">.</span>is_root<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">bool</span></span> result <span class="token operator">=</span> _departmentRepository<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token return-type class-name">result <span class="token punctuation">?</span></span> ResMessage<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> ResMessage<span class="token punctuation">.</span><span class="token function">Fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> _departmentRepository<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ResMessage<span class="token punctuation">.</span><span class="token function">LaySuccess</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span>list<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Department</span> <span class="token function">GetModelById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> _departmentRepository<span class="token punctuation">.</span><span class="token function">GetModelById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

        <span class="token preprocessor property">#<span class="token directive keyword">region</span> 扩展方法</span>

        <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="dotnet-utilities"><a href="#dotnet-utilities" class="header-anchor">#</a> DotNet.Utilities</h4> <p>常用工具操作类</p> <h5 id="resmessage"><a href="#resmessage" class="header-anchor">#</a> ResMessage</h5> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">FX<span class="token punctuation">.</span>Utilities</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResMessage</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> success <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> code <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> msg <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> data <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> count <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 返回成功</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;data&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;count&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Success</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">dynamic</span></span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                code <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
                msg <span class="token operator">=</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
                count <span class="token operator">=</span> count<span class="token punctuation">,</span>
                data <span class="token operator">=</span> data
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">AutoCompleteSuccess</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">dynamic</span></span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResMessage</span>
            <span class="token punctuation">{</span>
                code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                msg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                data <span class="token operator">=</span> data
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 返回成功</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;data&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;count&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Success</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">dynamic</span></span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                code <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
                msg <span class="token operator">=</span> message<span class="token punctuation">,</span>
                count <span class="token operator">=</span> count<span class="token punctuation">,</span>
                data <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 返回失败</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Fail</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                code <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">,</span>
                msg <span class="token operator">=</span> message
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 返回失败</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">Fail</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> code<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                code <span class="token operator">=</span> code<span class="token punctuation">,</span>
                msg <span class="token operator">=</span> message
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 登陆失败</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">LoingFail</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                code <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span>
                msg <span class="token operator">=</span> message
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Layui返回成功</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;data&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;count&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ResMessage</span> <span class="token function">LaySuccess</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">dynamic</span></span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResMessage</span>
            <span class="token punctuation">{</span>
                success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                msg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                count <span class="token operator">=</span> count<span class="token punctuation">,</span>
                data <span class="token operator">=</span> data

            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="asp-net-webapi"><a href="#asp-net-webapi" class="header-anchor">#</a> ASP.NET WebAPI</h3> <p>基于接口框架，开发人员只需要进行接口的编写。</p> <p>适用：前后端分离的项目</p> <h4 id="restful协议规范"><a href="#restful协议规范" class="header-anchor">#</a> Restful协议规范</h4> <p>Restful风格是一种软件架构风格，而不是标准，只是提供了一种设计原则和约束条件。主要适用于客户端和服务器端交互的软件。是基于http协议实现。目的是为了提高系统的可伸缩性，降低应用之间的耦合度，方便框架分布式处理程序。基于这个风格的软件可更加的简单、更有层次，更易于实现缓存的机制。
在resultful风格中，用户请求的url使用同一个URL而用请求方式：get/post/delete/put等方式对请求的处理方法进行区分。这样可以在前后台分离的开发中让前端开发人员不会对请求的资源地址产生混淆，形成一个统一的接口。</p> <p>（1）每种url代表了一种资源。
（2）客户端和服务器之间，传递这个资源的某种表现层。
（3）客户端通过四个http动词，对服务器资源进行操作。实现表现层状态的转化。</p> <p>示例：以默认的Http四种请求方式进行的访问</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token string">&quot;put&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：webapi中，返回可以是任何数据类型，不再局限于return Content,JSON,View这些了，因为无论我们返回什么，他都是json/xml。</p> <h4 id="特性标签"><a href="#特性标签" class="header-anchor">#</a> 特性标签</h4> <p>上述实例中，如果我们的函数名称不是get、post、delete、delete又如何访问呢？</p> <p>使用特性标签</p> <h4 id="特性路由"><a href="#特性路由" class="header-anchor">#</a> 特性路由</h4> <p>webapi中默认使用的是RESTful风格的URI,但是当业务变的复杂后，可能会导致映射无法满足需求，此时我们可以使用特性路由。</p> <p><strong>开启特性路由</strong></p> <p>启用特性路由需要在配置过程中调用System.Web.HttpConfigurationExtensions类的MapHttpAttributeRoutes方法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">WebApplication</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Web API routes</span>
            config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>global中配置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    GlobalConfiguration<span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>WebApiConfig<span class="token punctuation">.</span>Register<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>HttpMethod</strong></p> <p>默认情况，WebApi会根据action的方法名前缀查找action(不区分大小写)，比如GetUsers，会匹配Get。通过在action上添加HttpMethod特性，可以覆盖action需要映射的Http Method。</p> <p>可使用的特性包括：[HttpDelete],[HttpPost],[HttpHead],[HttpOptions],[HttpPatch],[HttpGet],[HttpPut]</p> <p>通过AcceptVerbs特性，我们还可以指定非标准方法以及多个方法，如 [AcceptVerbs(&quot;MKCOL&quot;,&quot;GET&quot;,&quot;POST&quot;)]</p> <p><strong>路由前缀</strong></p> <p>通常情况下，一个Controller下的action会使用相似的路由模板，如</p> <ul><li>[Route(&quot;api/books&quot;)]</li> <li>[Route(&quot;api/books/{id:int}&quot;)]</li> <li>[Route(&quot;api/books/{bookid}/authors&quot;)]</li></ul> <p>这时候可以为整个controller指定[RoutePrefix]特性，以使用共同的前缀，把[RoutePrefix(&quot;/api/books&quot;)]加到controller上，action的路由特性就变成这样：</p> <ul><li>[Route(&quot;&quot;)]</li> <li>[Route(&quot;{id:int}&quot;)]</li> <li>[Route(&quot;{bookid}/authors&quot;)]</li></ul> <p>此外，路由前缀中也可以包含参数，如[RoutePrefix(&quot;api/{userid}/books&quot;)]</p> <p><strong>路由约束</strong></p> <p>路由约束让我们可以限制模板参数的匹配方式。一般的语法是 &quot;{参数：约束类型}&quot;：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{id:int}&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">GetUserById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{name}&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">GetUserByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>如果参数int，则选中第一个GetUserById，否则是GetUserByName。(跟方法定义的顺序无关)</p> <p>下面的表格列出了支持的约束</p> <table><thead><tr><th style="text-align:left;">约束</th> <th style="text-align:left;">介绍</th> <th style="text-align:left;">示例</th></tr></thead> <tbody><tr><td style="text-align:left;">alpha</td> <td style="text-align:left;">匹配大写或小写字母 (a-z, A-Z)</td> <td style="text-align:left;">{x:alpha}</td></tr> <tr><td style="text-align:left;">bool</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:bool}</td></tr> <tr><td style="text-align:left;">datetime</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:datetime}</td></tr> <tr><td style="text-align:left;">decimal</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:decimal}</td></tr> <tr><td style="text-align:left;">double</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:double}</td></tr> <tr><td style="text-align:left;">float</td> <td style="text-align:left;">匹配一个 32位浮点数</td> <td style="text-align:left;">{x:float}</td></tr> <tr><td style="text-align:left;">guid</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:guid}</td></tr> <tr><td style="text-align:left;">int</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:int}</td></tr> <tr><td style="text-align:left;">length</td> <td style="text-align:left;">匹配一个长度在指定范围内的字符串</td> <td style="text-align:left;"><em>{x:length(6)} *{x:length(1,20)}</em>*</td></tr> <tr><td style="text-align:left;">long</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:long}</td></tr> <tr><td style="text-align:left;">max</td> <td style="text-align:left;">匹配指定了最大值的整数</td> <td style="text-align:left;">{x:max(10)}</td></tr> <tr><td style="text-align:left;">maxlength</td> <td style="text-align:left;">匹配指定了最大长度字符串</td> <td style="text-align:left;">{x:maxlength(10)}</td></tr> <tr><td style="text-align:left;">min</td> <td style="text-align:left;">匹配指定了最小值的整数</td> <td style="text-align:left;">{x:min(10)}</td></tr> <tr><td style="text-align:left;">minlength</td> <td style="text-align:left;">匹配指定了最小长度字符串</td> <td style="text-align:left;">{x:minlength(10)}</td></tr> <tr><td style="text-align:left;">range</td> <td style="text-align:left;">匹配指定了大小区间的整数</td> <td style="text-align:left;">{x:range(10,50)}</td></tr> <tr><td style="text-align:left;">regex</td> <td style="text-align:left;">匹配一个正则表达式</td> <td style="text-align:left;">{x:regex(^\d{3}-\d{3}-\d{4}$)}</td></tr></tbody></table> <p><strong>可选URI参数，默认值</strong></p> <p>通过在参数约束后面添加一个问号，可以设定URI参数是可选的；也可以像普通方法那样指定默认值：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/books/locale/{cid:int?}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Book<span class="token punctuation">&gt;</span></span> <span class="token function">GetBooksByLocale</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> cid <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> 
<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;api/books/locale/{cid:int=1033}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Book<span class="token punctuation">&gt;</span></span> <span class="token function">GetBooksByLocale</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> cid<span class="token punctuation">)</span>
</code></pre></div><h4 id="配置默认返回类型"><a href="#配置默认返回类型" class="header-anchor">#</a> 配置默认返回类型</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code>GlobalConfiguration<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>Formatters<span class="token punctuation">.</span>XmlFormatter<span class="token punctuation">.</span>SupportedMediaTypes<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="跨域访问"><a href="#跨域访问" class="header-anchor">#</a> <strong>跨域访问</strong></h4> <p><img src="https://img-blog.csdnimg.cn/694a6f330d17431cbcb3723653701395.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdU1zb25fbg==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p> <h4 id="webapi中接口的调用"><a href="#webapi中接口的调用" class="header-anchor">#</a> WebAPI中接口的调用</h4> <p>安装跨域程序包</p> <p><img src="https://img-blog.csdnimg.cn/c2012b0f9314494d962b9ac5fc8d5fb0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdU1zb25fbg==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p> <p><strong>启用配置</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> 启用配置
在WebApiConfig中启用Cors。

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Web API 配置和服务</span>
            config<span class="token punctuation">.</span><span class="token function">EnableCors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Web API 路由</span>
            config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            config<span class="token punctuation">.</span>Routes<span class="token punctuation">.</span><span class="token function">MapHttpRoute</span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;DefaultApi&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">routeTemplate</span><span class="token punctuation">:</span> <span class="token string">&quot;api/{controller}/{id}&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> RouteParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>全局配置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Web API 配置和服务</span>
            config<span class="token punctuation">.</span><span class="token function">EnableCors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">EnableCorsAttribute</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">origins</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">headers</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">methods</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Web API 路由</span>
            config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            config<span class="token punctuation">.</span>Routes<span class="token punctuation">.</span><span class="token function">MapHttpRoute</span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;DefaultApi&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">routeTemplate</span><span class="token punctuation">:</span> <span class="token string">&quot;api/{controller}/{id}&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> RouteParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong>单独配置</strong>
需要引入命名空间:
using System.Web.Http.Cors;</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnableCors</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token named-parameter punctuation">origins</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span><span class="token named-parameter punctuation">headers</span><span class="token punctuation">:</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span><span class="token named-parameter punctuation">methods</span><span class="token punctuation">:</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValuesController1</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Get</strong></p> <p>1.单参数传递 QueryString</p> <p>2.多参数传递 QueryString</p> <p>3.对象参数传递</p> <p>前端:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://localhost:44343/api/student'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span>obj
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>后端：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetStudnet</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromUri</span></span><span class="token punctuation">]</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Post、Put、Delete</strong></p> <p>1.单参数传递</p> <p>前端：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'123'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token literal-property property">create_time</span><span class="token operator">:</span><span class="token string">'2023-08-08'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://localhost:44343/api/student'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>
         <span class="token string-property property">''</span><span class="token operator">:</span><span class="token string">'张三'</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>后端：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2.多参数，多参数传递时需要使用对象，不能使用多个[FromBody]</p> <p>前端：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://localhost:44343/api/student'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span>obj<span class="token comment">//对象</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>后端：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">Student</span> model<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>PostMan和后端</strong></p> <p>1)传递一个参数:</p> <p>在body中使用raw</p> <p>解释：raw传参方式指的是使用json进行传递，并且在headers中需要指定Content-Type为application/json</p> <p>2传递一个对象:</p> <p><img src="https://img-blog.csdnimg.cn/61915554ea1249bf97c1f67da346017c.png" alt="在这里插入图片描述"></p> <p>注意需要添加application/json</p> <h4 id="swaggerui"><a href="#swaggerui" class="header-anchor">#</a> SwaggerUI</h4> <p>一个基于webapi框架的接口生成UI库，能够自动生成接口网页。</p> <p>1.安装</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Install<span class="token operator">-</span>Package Swashbuckle
</code></pre></div><p>2.配置swagger的xml映射文件</p> <p>右键项目&gt;属性&gt;生成&gt;将XML文档文件改为&quot;bin\SwaggerF.xml&quot;</p> <p>3.找到App_Start文件夹下的SwaggerConfig.cs</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WebActivatorEx</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WebAPIApp</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Swashbuckle<span class="token punctuation">.</span>Application</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">PreApplicationStartMethod</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SwaggerConfig</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Register&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>

<span class="token keyword">namespace</span> <span class="token namespace">WebAPIApp</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> thisAssembly <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SwaggerConfig</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">;</span>
            GlobalConfiguration<span class="token punctuation">.</span>Configuration
                <span class="token punctuation">.</span><span class="token function">EnableSwagger</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    c<span class="token punctuation">.</span><span class="token function">SingleApiVersion</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SwaggerF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//版本号+项目名称</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> webApiXmlPath <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;{0}/bin/SwaggerF.xml&quot;</span><span class="token punctuation">,</span> System<span class="token punctuation">.</span>AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置生成路径</span>
                    c<span class="token punctuation">.</span><span class="token function">IncludeXmlComments</span><span class="token punctuation">(</span>webApiXmlPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">EnableSwaggerUi</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
     c<span class="token punctuation">.</span><span class="token function">InjectJavaScript</span><span class="token punctuation">(</span>thisAssembly<span class="token punctuation">,</span> <span class="token string">&quot;EHelper.Scripts.Swagger.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//汉化</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4.创建js文件（<strong>注意：一定设置该js文件得属性，生成操作为“嵌入的资源”</strong>）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Translator for documentation pages.
 *
 * To enable translation you should include one of language-files in your index.html
 * after &lt;script src='lang/translator.js' type='text/javascript'&gt;&lt;/script&gt;.
 * For example - &lt;script src='lang/ru.js' type='text/javascript'&gt;&lt;/script&gt;
 *
 * If you wish to translate some new texsts you should do two things:
 * 1. Add a new phrase pair (&quot;New Phrase&quot;: &quot;New Translation&quot;) into your language file (for example lang/ru.js). It will be great if you add it in other language files too.
 * 2. Mark that text it templates this way &lt;anyHtmlTag data-sw-translate&gt;New Phrase&lt;/anyHtmlTag&gt; or &lt;anyHtmlTag data-sw-translate value='New Phrase'/&gt;.
 * The main thing here is attribute data-sw-translate. Only inner html, title-attribute and value-attribute are going to translate.
 *
 */</span>
window<span class="token punctuation">.</span>SwaggerTranslator <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">_words</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token function-variable function">translate</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> $<span class="token keyword">this</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'[data-sw-translate]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_tryTranslate</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_tryTranslate</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> $<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_tryTranslate</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">_tryTranslate</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_words<span class="token punctuation">[</span>$<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_words<span class="token punctuation">[</span>$<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">:</span> word<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">learn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">wordsMap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_words <span class="token operator">=</span> wordsMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">/* jshint quotmark: double */</span>
window<span class="token punctuation">.</span>SwaggerTranslator<span class="token punctuation">.</span><span class="token function">learn</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;Warning: Deprecated&quot;</span><span class="token operator">:</span> <span class="token string">&quot;警告：已过时&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Implementation Notes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;实现备注&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Response Class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;响应类&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;状态&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Parameters&quot;</span><span class="token operator">:</span> <span class="token string">&quot;参数&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Parameter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;参数&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;值&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;描述&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Parameter Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;参数类型&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Data Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;数据类型&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Response Messages&quot;</span><span class="token operator">:</span> <span class="token string">&quot;响应消息&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;HTTP Status Code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HTTP状态码&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Reason&quot;</span><span class="token operator">:</span> <span class="token string">&quot;原因&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Response Model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;响应模型&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Request URL&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求URL&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Response Body&quot;</span><span class="token operator">:</span> <span class="token string">&quot;响应体&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Response Code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;响应码&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Response Headers&quot;</span><span class="token operator">:</span> <span class="token string">&quot;响应头&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Hide Response&quot;</span><span class="token operator">:</span> <span class="token string">&quot;隐藏响应&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Headers&quot;</span><span class="token operator">:</span> <span class="token string">&quot;头&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Try it out!&quot;</span><span class="token operator">:</span> <span class="token string">&quot;试一下！&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Show/Hide&quot;</span><span class="token operator">:</span> <span class="token string">&quot;显示/隐藏&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;List Operations&quot;</span><span class="token operator">:</span> <span class="token string">&quot;显示操作&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Expand Operations&quot;</span><span class="token operator">:</span> <span class="token string">&quot;展开操作&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Raw&quot;</span><span class="token operator">:</span> <span class="token string">&quot;原始&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;can't parse JSON.  Raw result&quot;</span><span class="token operator">:</span> <span class="token string">&quot;无法解析JSON. 原始结果&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Model Schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;模型架构&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;模型&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;apply&quot;</span><span class="token operator">:</span> <span class="token string">&quot;应用&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;密码&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Terms of service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;服务条款&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Created by&quot;</span><span class="token operator">:</span> <span class="token string">&quot;创建者&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;See more at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;查看更多：&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Contact the developer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;联系开发者&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;api version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api版本&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Response Content Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;响应Content Type&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;fetching resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;正在获取资源&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;fetching resource list&quot;</span><span class="token operator">:</span> <span class="token string">&quot;正在获取资源列表&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Explore&quot;</span><span class="token operator">:</span> <span class="token string">&quot;浏览&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Show Swagger Petstore Example Apis&quot;</span><span class="token operator">:</span> <span class="token string">&quot;显示 Swagger Petstore 示例 Apis&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Can't read from server.  It may not have the appropriate access-control-origin settings.&quot;</span><span class="token operator">:</span> <span class="token string">&quot;无法从服务器读取。可能没有正确设置access-control-origin。&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Please specify the protocol for&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请指定协议：&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Can't read swagger JSON from&quot;</span><span class="token operator">:</span> <span class="token string">&quot;无法读取swagger JSON于&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Finished Loading Resource Information. Rendering Swagger UI&quot;</span><span class="token operator">:</span> <span class="token string">&quot;已加载资源信息。正在渲染Swagger UI&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;Unable to read api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;无法读取api&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;from path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;从路径&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;server returned&quot;</span><span class="token operator">:</span> <span class="token string">&quot;服务器返回&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>SwaggerTranslator<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>SwaggerTranslator<span class="token punctuation">.</span><span class="token function">setControllerSummary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>5.启动项目</p> <h3 id="asp-net-core"><a href="#asp-net-core" class="header-anchor">#</a> ASP.NET Core</h3> <h4 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h4> <p>1、项目创建</p> <p>2、Program.cs 项目主程序类（主要包括两部分）</p> <p>配置服务</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span>Services。。。
</code></pre></div><p>配置中间件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>Use。。。
</code></pre></div><p>3、appsettings.json 配置文件，可以在这部分配置用户机密，配置数据库连接字符串</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;Logging&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;LogLevel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;Default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Microsoft.AspNetCore&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;AllowedHosts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;myKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MyKey&quot;</span><span class="token punctuation">,</span> <span class="token comment">//用户机密文件节点 注意：这个myKey是关键词</span>
  <span class="token property">&quot;ConnectionStrings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;MySql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Server=127.0.0.1,3306;Database=dotnetcore;Uid=root;Pwd=123456;Charset=utf8mb4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;SqlServer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;server=127.0.0.1;uid=sa;pwd=sa;database=dotnetcore;Encrypt=True;TrustServerCertificate=True;&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>5、用户机密：右键项目=&gt;管理用户机密，在secrets.json中编写机密信息</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;MyKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;this is sercrets&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>6、在Program.cs 中使用configuration配置服务捕获取出appsettings.json中的值</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">//在Program.cs中注入Configuration服务</span>
var _configuration=builder.Configuration;

<span class="token comment">//获取configuration中内部的节点值</span>
_configuration<span class="token punctuation">[</span><span class="token string">&quot;test:name&quot;</span><span class="token punctuation">]</span> <span class="token comment">//输出zhangsan</span>

<span class="token comment">//获取Configuration内的属性</span>
_configuration<span class="token punctuation">[</span><span class="token string">&quot;mykey&quot;</span><span class="token punctuation">]</span> <span class="token comment">//输出this is sercrets 注意：这个myKey是关键词</span>

<span class="token comment">// 获取数据库连接字符串</span>
_configuration.GetConnectionString(<span class="token string">&quot;MySql&quot;</span>);
_configuration.GetConnectionString(<span class="token string">&quot;SqlServer&quot;</span>);
</code></pre></div><h4 id="数据库连接字符串"><a href="#数据库连接字符串" class="header-anchor">#</a> 数据库连接字符串</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;MySql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Server=127.0.0.1;Database=dotnetcore;Uid=root;Pwd=123456;Charset=utf8mb4&quot;</span>

<span class="token property">&quot;SqlServer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;server=127.0.0.1;uid=sa;pwd=sa;database=dotnetcore;Encrypt=True;TrustServerCertificate=True;&quot;</span>
</code></pre></div><h4 id="获取数据库连接字符串"><a href="#获取数据库连接字符串" class="header-anchor">#</a> 获取数据库连接字符串</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;MySql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;SqlServer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>遇到的一个错误：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>The ConnectionString property has <span class="token keyword">not</span> been initialized<span class="token punctuation">.</span>
</code></pre></div><p>原因：连接字符串配置错误。请仔细查看连接字符串的配置。</p> <h4 id="net-core中使用ef"><a href="#net-core中使用ef" class="header-anchor">#</a> .net Core中使用EF</h4> <p>安装包：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Microsoft<span class="token punctuation">.</span>EntityFrameworkCore<span class="token punctuation">.</span>SqlServer <span class="token comment">// 使用SqlServer</span>
Pomelo<span class="token punctuation">.</span>EntityFrameworkCore<span class="token punctuation">.</span>MySql <span class="token comment">//使用MySql</span>
Microsoft<span class="token punctuation">.</span>EntityFrameworkCore<span class="token punctuation">.</span>Tools <span class="token comment">// 包版本必须与asp.net core版本相同，否则安装失败</span>
Microsoft<span class="token punctuation">.</span>EntityFrameworkCore<span class="token punctuation">.</span>SqlServer<span class="token punctuation">.</span>Design
</code></pre></div><p>Nuget控制台输入：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Scaffold-DbContext <span class="token string">&quot;server=127.0.0.1;uid=sa;pwd=sa;database=dotnetcore;Encrypt=True;TrustServerCertificate=True;&quot;</span> Microsoft.EntityFrameworkCore.SqlServer <span class="token parameter variable">-OutputDir</span> Models <span class="token parameter variable">-Force</span> <span class="token parameter variable">-UseDatabaseNames</span>
</code></pre></div><p>生成Models对应的实体和DBContext上下文对象</p> <p><strong>Scaffold-DbContext命令</strong></p> <div class="language-text extra-class"><pre class="language-text"><code>Scaffold-DbContext [-Connection] [-Provider] [-OutputDir] [-Context] [-Schemas&gt;] [-Tables&gt;] 
                    [-DataAnnotations] [-Force] [-Project] [-StartupProject] [&amp;lt;CommonParameters&gt;]
</code></pre></div><p>参数说明：</p> <div class="language-text extra-class"><pre class="language-text"><code>-OutputDir *** 实体文件所存放的文件目录
-ContextDir *** DbContext文件存放的目录
-Context *** DbContext文件名
-Schemas *** 需要生成实体数据的数据表所在的模式
-Tables *** 需要生成实体数据的数据表的集合
-DataAnnotations
-UseDatabaseNames 直接使用数据库中的表名和列名（某些版本不支持）
-Force 强制执行，重写已经存在的实体文件
</code></pre></div><h4 id="webapi项目"><a href="#webapi项目" class="header-anchor">#</a> WebApi项目</h4> <h5 id="常见的-iactionresult-返回类型"><a href="#常见的-iactionresult-返回类型" class="header-anchor">#</a> 常见的 <code>IActionResult</code> 返回类型</h5> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 方法返回 HTTP 状态码 200 OK。表示请求已成功处理，并且不需要返回任何数据。</span>
<span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 返回 HTTP 状态码 400 Bad Request。表示客户端发送的请求存在问题，通常与验证错误或无效的输入相关联。</span>
<span class="token function">Unauthorized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 该方法返回 HTTP 状态码 401 Unauthorized，表示未经授权的访问。</span>
<span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 该方法返回 HTTP 状态码 404 Not Found。</span>
<span class="token function">StatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 允许你返回自定义的 HTTP 状态码以及相应的数据。你可以指定状态码和要返回的数据对象，并将其作为 ObjectResult 对象返回。</span>
<span class="token function">Created</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> uri<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token comment">// 该方法返回 HTTP 状态码 201 Created，并设置 Location 响应头指向新资源的 URI。</span>
<span class="token function">NoContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 该方法表示请求成功处理，但响应没有包含任何内容。它通常用于表示删除或更新操作成功完成。</span>
</code></pre></div><p>Program.cs中的常用配置</p> <h5 id="_1、jwt"><a href="#_1、jwt" class="header-anchor">#</a> 1、JWT</h5> <p>通过Nuget安装JWT包和JwtBearer</p> <p>准备一个类：JWTConst.cs</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTConst</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> SecurityKey <span class="token operator">=</span> <span class="token string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDSfLGu+kcFDcJUCV46J+SbgR0lNc2NqgCGzojQTWW9xqjuzPF3mpisvTggYZSGfBzN+88YLZYbBLrDTUMJ4nTieElbP6SHkBFu8F+7fFBi7w3UPsaAXDr2E2srQYU5ZlKAcFBoNajNWj3sfSVRoYRPdqDTj4WdJlUPSNGz0wgRrQIDAQAB&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> Domain <span class="token operator">=</span> <span class="token string">&quot;http://localhost:5000&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>方法上添加注解**[Authorize]**：表示要求该方法需要授权。每个类都要添加有点麻烦，可以全局设置验权。</p> <p>Program.cs中配置：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 全局验权</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddMvcOptions</span><span class="token punctuation">(</span>option <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    option<span class="token punctuation">.</span>Filters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthorizeFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>要求全局内的所有方法都需要进行授权。（其实本质是使用到了过滤器AuthorizeFilter）</p> <h5 id="_2、swagger"><a href="#_2、swagger" class="header-anchor">#</a> 2、Swagger</h5> <h6 id="方法一-直接配置"><a href="#方法一-直接配置" class="header-anchor">#</a> 方法一：直接配置</h6> <p>Program.cs文件中进行注册</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//Swagger服务注册</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span>option <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 1、配置Swagger文档的基本信息</span>
    option<span class="token punctuation">.</span><span class="token function">SwaggerDoc</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiInfo</span>
    <span class="token punctuation">{</span>
        Version <span class="token operator">=</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span><span class="token comment">// 版本号</span>
        Title <span class="token operator">=</span> <span class="token string">&quot;Vue WebApi&quot;</span><span class="token punctuation">,</span><span class="token comment">// 标题</span>
        Description <span class="token operator">=</span> <span class="token string">&quot;vue-admin-template WebApi项目文档&quot;</span><span class="token comment">// 描述</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    
    <span class="token comment">// 2、编写注释时无效，可进行一下配置（前提是在项目的属性-&gt;生成-&gt;输出中设置好开启.xml文档生成，并制定好位置和名称）</span>
    <span class="token class-name"><span class="token keyword">var</span></span> file <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>AppContext<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">,</span> <span class="token string">&quot;vue.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// xml文档绝对路径</span>
    <span class="token class-name"><span class="token keyword">var</span></span> path <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>AppContext<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// xml文档绝对路径</span>
    option<span class="token punctuation">.</span><span class="token function">IncludeXmlComments</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true : 显示控制器层注释</span>
    option<span class="token punctuation">.</span><span class="token function">OrderActionsBy</span><span class="token punctuation">(</span>o <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>RelativePath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对action的名称进行排序，如果有多个，就可以看见效果了。</span>
    
    
    <span class="token comment">// 3、配置Swagger可以发送带Token的请求</span>
    option<span class="token punctuation">.</span><span class="token function">AddSecurityDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;Bearer&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiSecurityScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Description <span class="token operator">=</span> <span class="token string">&quot;Please enter into field the word 'Bearer' followed by a space and the JWT value&quot;</span><span class="token punctuation">,</span>
        Name <span class="token operator">=</span> <span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span>
        In <span class="token operator">=</span> ParameterLocation<span class="token punctuation">.</span>Header<span class="token punctuation">,</span>
        Type <span class="token operator">=</span> SecuritySchemeType<span class="token punctuation">.</span>ApiKey<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    option<span class="token punctuation">.</span><span class="token function">AddSecurityRequirement</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiSecurityRequirement</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiSecurityScheme</span>
        <span class="token punctuation">{</span>
            Reference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Id <span class="token operator">=</span> <span class="token string">&quot;Bearer&quot;</span><span class="token punctuation">,</span>
                Type <span class="token operator">=</span> ReferenceType<span class="token punctuation">.</span>SecurityScheme
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h6 id="方式二-抽离成类"><a href="#方式二-抽离成类" class="header-anchor">#</a> 方式二：抽离成类</h6> <p>1、Program.cs文件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Swagger服务注册抽离成类</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> 
<span class="token punctuation">{</span>
    SwaggerConfig<span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2、创建类：SwaggerConfig.cs</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Swagger配置文件</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">SwaggerGenOptions</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 1、配置Swagger文档的基本信息</span>
        options<span class="token punctuation">.</span><span class="token function">SwaggerDoc</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiInfo</span>
        <span class="token punctuation">{</span>
            Version <span class="token operator">=</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>
            Title <span class="token operator">=</span> <span class="token string">&quot;Vue WebApi&quot;</span><span class="token punctuation">,</span>
            Description <span class="token operator">=</span> <span class="token string">&quot;vue-admin-template WebApi项目文档&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2、编写注释时无效，可进行一下配置（前提是在项目的属性-&gt;生成-&gt;输出中设置好开启.xml文档生成，并制定好位置和名称）</span>
        <span class="token class-name"><span class="token keyword">var</span></span> file <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>AppContext<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">,</span> <span class="token string">&quot;swagger.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// xml文档绝对路径</span>
        <span class="token class-name"><span class="token keyword">var</span></span> path <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>AppContext<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// xml文档绝对路径</span>
        options<span class="token punctuation">.</span><span class="token function">IncludeXmlComments</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true : 显示控制器层注释</span>
        options<span class="token punctuation">.</span><span class="token function">OrderActionsBy</span><span class="token punctuation">(</span>o <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>RelativePath<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 对action的名称进行排序，如果有多个，就可以看见效果了。</span>

        <span class="token comment">// 3、配置Swagger可以发送带Token的请求</span>
        options<span class="token punctuation">.</span><span class="token function">AddSecurityDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;Bearer&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiSecurityScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Description <span class="token operator">=</span> <span class="token string">&quot;Please enter into field the word 'Bearer' followed by a space and the JWT value&quot;</span><span class="token punctuation">,</span>
            Name <span class="token operator">=</span> <span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span>
            In <span class="token operator">=</span> ParameterLocation<span class="token punctuation">.</span>Header<span class="token punctuation">,</span>
            Type <span class="token operator">=</span> SecuritySchemeType<span class="token punctuation">.</span>ApiKey<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span><span class="token function">AddSecurityRequirement</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiSecurityRequirement</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiSecurityScheme</span>
                <span class="token punctuation">{</span>
                    Reference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        Id <span class="token operator">=</span> <span class="token string">&quot;Bearer&quot;</span><span class="token punctuation">,</span>
                        Type <span class="token operator">=</span> ReferenceType<span class="token punctuation">.</span>SecurityScheme
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于引入了Swagger导致VS多了CS1591警告，也可以不取消此警告</p> <h5 id="_3、sqlsurgar"><a href="#_3、sqlsurgar" class="header-anchor">#</a> 3、SqlSurgar</h5> <h6 id="方法一-直接配置-2"><a href="#方法一-直接配置-2" class="header-anchor">#</a> 方法一：直接配置</h6> <p>Program.cs文件中进行注册</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//注册SqlSugar用AddScoped</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISqlSugarClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Scoped用SqlSugarClient </span>
    <span class="token class-name">SqlSugarClient</span> sqlSugar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlSugarClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConnectionConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        DbType <span class="token operator">=</span> DbType<span class="token punctuation">.</span>MySql<span class="token punctuation">,</span>
        ConnectionString <span class="token operator">=</span> builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;MySql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        IsAutoCloseConnection <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   db <span class="token operator">=&gt;</span>
   <span class="token punctuation">{</span>
       <span class="token comment">//单例参数配置，所有上下文生效</span>
       db<span class="token punctuation">.</span>Aop<span class="token punctuation">.</span>OnLogExecuting <span class="token operator">=</span> <span class="token punctuation">(</span>sql<span class="token punctuation">,</span> pars<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
       <span class="token punctuation">{</span>
           Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sqlSugar<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="方式二-抽离成类-2"><a href="#方式二-抽离成类-2" class="header-anchor">#</a> 方式二：抽离成类</h6> <p>1、SqlSugarConfig.cs</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SqlSugarConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddSqlSugar</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> services<span class="token punctuation">,</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISqlSugarClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Scoped 用 SqlSugarClient </span>
                <span class="token class-name">SqlSugarClient</span> sqlSugar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlSugarClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConnectionConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    DbType <span class="token operator">=</span> DbType<span class="token punctuation">.</span>MySql<span class="token punctuation">,</span>
                    ConnectionString <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;MySql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    IsAutoCloseConnection <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                db <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// 单例参数配置，所有上下文生效</span>
                    db<span class="token punctuation">.</span>Aop<span class="token punctuation">.</span>OnLogExecuting <span class="token operator">=</span> <span class="token punctuation">(</span>sql<span class="token punctuation">,</span> pars<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    <span class="token punctuation">{</span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> sqlSugar<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>2、Program.cs文件</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//注册SqlSugar用AddScoped</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddSqlSugar</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_4、跨域"><a href="#_4、跨域" class="header-anchor">#</a> 4、跨域</h5> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//配置跨域</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddCors</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    options<span class="token punctuation">.</span><span class="token function">AddPolicy</span><span class="token punctuation">(</span><span class="token string">&quot;CorsPolicy&quot;</span><span class="token punctuation">,</span> builder <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">AllowAnyOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//允许所有Origin策略</span>

               <span class="token comment">//允许所有请求方法：Get,Post,Put,Delete</span>
               <span class="token punctuation">.</span><span class="token function">AllowAnyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

               <span class="token comment">//允许所有请求头:application/json</span>
               <span class="token punctuation">.</span><span class="token function">AllowAnyHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 允许所有跨域，cors是在ConfigureServices方法中配置的跨域策略名称</span>
app<span class="token punctuation">.</span><span class="token function">UseCors</span><span class="token punctuation">(</span><span class="token string">&quot;CorsPolicy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_5、定时调度"><a href="#_5、定时调度" class="header-anchor">#</a> 5、定时调度</h5> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 添加Quartz服务</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddQuartz</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    q<span class="token punctuation">.</span><span class="token function">UseMicrosoftDependencyInjectionJobFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建一个作业调度器</span>
    <span class="token class-name"><span class="token keyword">var</span></span> jobKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JobKey</span><span class="token punctuation">(</span><span class="token string">&quot;myJob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    q<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddJob</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyJob<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>j <span class="token operator">=&gt;</span> j<span class="token punctuation">.</span><span class="token function">WithIdentity</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建一个触发器</span>
    q<span class="token punctuation">.</span><span class="token function">AddTrigger</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t
        <span class="token punctuation">.</span><span class="token function">WithIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;myTrigger&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ForJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">StartNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithSimpleSchedule</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x
        <span class="token punctuation">.</span><span class="token function">WithIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">RepeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加Quartz后台服务</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddQuartzHostedService</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>WaitForJobsToComplete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Quartz</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">dotnetCore</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJob</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IJob</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name">IJobExecutionContext</span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 执行任务逻辑</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, Quartz!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="webservice"><a href="#webservice" class="header-anchor">#</a> WebService</h3> <p>网络服务，类似接口，通过网络访问方式获取webservice数据。</p> <p>webservice<strong>跨平台</strong>，基于xml和soap简单对象协议。</p> <p>java/.net 都是有webservice</p> <p>XML</p> <p>简单对象协议Soap</p> <p>例子：</p> <p><strong>调用webservice</strong></p> <p>1拿到webserice地址</p> <p>2需要让程序解析webbservice地址</p> <p>3解析完成后得到一个服务对象</p> <p>4通过调用服务对象的方法就可以获取相关接口的数据</p> <p><strong>写webservice</strong></p> <p>1创建一个webservice.asmx文件</p> <p>2在类中编写网络方法</p> <p>请问如何保证webserivce的安全性</p> <p>1提供密钥验证</p> <p>2限制用户的访问次数,通过监控访问用户的ip地址，对访问次数进行限制。</p> <h2 id="设计思想"><a href="#设计思想" class="header-anchor">#</a> 设计思想</h2> <h3 id="面向对象-oop"><a href="#面向对象-oop" class="header-anchor">#</a> 面向对象（OOP）</h3> <p>一种以对象为基本单位，通过封装、继承、多态构建程序的编程规范。</p> <ul><li>封装：将数据和操作打包，方便外部调用，无需考虑内部实现细节。</li> <li>继承：通过已有类派生出新类，继承原有类的属性和方法。并可添加新的属性和方法。</li> <li>多态：一种行为的多种表现形式。通过继承和重载实现。</li></ul> <h3 id="控制反转-ioc"><a href="#控制反转-ioc" class="header-anchor">#</a> 控制反转（IOC）</h3> <p>IoC全称为inversion  of control（控制反转），依赖注入是一种IOC的表现形式，主要表现为让第三方来管理自己的依赖。IOC容器的价值在于让依赖管理和使用更为便捷。简单地说，容器是一个申请依赖、保存依赖的对象。容器的声明性正式它强大的地方，这个特性可以让开发者无需去特别指定什么时间创建依赖的实例，申明后直接通过容器来获取相应的实例，容器内部来处理相关的逻辑。</p> <p>Ioc是把对象的控制权较给框架或容器，容器中存储了众多我们需要的对象，然后我们就无需再手动的在代码中创建对象。需要什么对象就直接告诉容器我们需要什么对象，容器会把对象根据一定的方式注入到我们的代码中。注入的过程被称为DI。</p> <p>IOC底层原理：xml解析、工厂模式、反射</p> <p><strong>控制反转和依赖注入的区别</strong></p> <p>控制反转：创建对象实例的控制权从代码控制剥离到IOC容器控制，实际就是你在xml文件控制，侧重于原理。
依赖注入：创建对象实例时，为这个对象注入属性值或其它对象实例，侧重于实现。</p> <p>IOC模式，系统中通过引入实现了IOC模式的IOC容器，即可由IOC容器来管理对象的生命周期、依赖关系等，从而使得应用程序的配置和依赖性规范与实际的应用程序代码分开。其中一个特点就是通过文本的配置文件进行应用程序组件间相互关系的配置，而不用重新修改并编译具体的代码。</p> <p>IoC中最基本的C#/Java技术就是“反射”编程。反射又是一个生涩的名词，通俗的说反射就是根据给出的类名（字符串）来生成对象。这种编程方式可以让对象在生成时才决定要生成哪一种对象。反射的应用是很广泛。</p> <p>常见的IOC容器框架：</p> <p>Spring+SpringMVC+Mybatis=SSM                 IOC容器+后端MVC框架+ORM</p> <p>Autofac+ASP.NET MVC+EntityFramewok     IOC容器+后端MVC框架+ORM</p> <h3 id="依赖注入-di"><a href="#依赖注入-di" class="header-anchor">#</a> 依赖注入（DI）</h3> <p>依赖注入（Dependency Injection），是这样一个过程：
由于某客户类只依赖于服务类的一个接口，而不依赖于具体服务类，所以客户类只定义一个<strong>注入点</strong>。在程序运行过程中，客户类不直接实例化具体服务类实例，而是客户类的运行上下文环境或专门组件负责实例化服务类，然后将其注入到客户类中，保证客户类的正常运行。</p> <p><strong>一、接口声明依赖对象</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//将司机模块抽象为一个接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IDriver</span> <span class="token punctuation">{</span>
     <span class="token comment">//是司机就应该会驾驶汽车</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span> ： IDriver<span class="token punctuation">{</span>
    <span class="token comment">//司机的主要职责就是驾驶汽车</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> car<span class="token punctuation">)</span><span class="token punctuation">{</span>
        car<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>二、构造函数传递依赖对象</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> 
<span class="token punctuation">{</span> 
    <span class="token keyword">private</span> <span class="token class-name">IMyInterFace</span> _myinterface<span class="token punctuation">;</span> 
    <span class="token keyword">public</span> MyClass <span class="token punctuation">(</span><span class="token class-name">IMyInterFace</span> myinterface<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>_myinterface <span class="token operator">=</span> myinterface<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre></div><p>三、<strong>Setter方法传递依赖对象</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token class-name">IMyInterFace</span> _myinterface<span class="token punctuation">;</span> 
<span class="token keyword">public</span> <span class="token return-type class-name">IMyInterFace</span> myinterface
<span class="token punctuation">{</span> 
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _myinterface<span class="token punctuation">;</span> <span class="token punctuation">}</span> 
    <span class="token keyword">set</span> <span class="token punctuation">{</span> _myinterface <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre></div><p>依赖注入是客户类被动的接收所依赖的服务类，所以，我们称客户类的控制权发生了改变。</p> <p>由原本的在功能区域实例化服务类，变为了使用接口接收注入的服务类。</p> <p>这种控制权的改变由主动变为了被动，我们称之为<strong>控制反转</strong>。</p> <p><strong>控制反转和依赖注入的区别</strong></p> <p>控制反转：创建对象实例的控制权从代码控制剥离到IOC容器控制，实际就是你在xml文件控制，侧重于原理。
依赖注入：创建对象实例时，为这个对象注入属性值或其它对象实例，侧重于实现。</p> <p>IOC模式，系统中通过引入实现了IOC模式的IOC容器，即可由IOC容器来管理对象的生命周期、依赖关系等，从而使得应用程序的配置和依赖性规范与实际的应用程序代码分开。其中一个特点就是通过文本的配置文件进行应用程序组件间相互关系的配置，而不用重新修改并编译具体的代码。</p> <p>IoC中最基本的C#/Java技术就是“反射”编程。反射又是一个生涩的名词，通俗的说反射就是根据给出的类名（字符串）来生成对象。这种编程方式可以让对象在生成时才决定要生成哪一种对象。反射的应用是很广泛。</p> <p>常见的IOC容器框架：</p> <p>Spring+SpringMVC+Mybatis=SSM                 IOC容器+后端MVC框架+ORM</p> <p>Autofac+ASP.NET MVC+EntityFramewok     IOC容器+后端MVC框架+ORM</p> <h3 id="面向切面-aop"><a href="#面向切面-aop" class="header-anchor">#</a> 面向切面（AOP）</h3> <p>面向切面编程（Aspect-Oriented Programming，简称AOP）是一种编程范式，用于解决软件系统中的横切关注点（Cross-cutting Concerns）问题。横切关注点指的是那些与核心业务逻辑无关但存在于多个模块或组件中的共享功能或行为。</p> <p>在传统的面向对象编程中，系统的核心功能被分散在各个模块中，而横切关注点（如日志记录、事务管理、安全控制等）则分散在各个模块之间，导致代码重复、难以维护和理解。而AOP的目标就是将这些横切关注点从核心业务逻辑中分离出来，使得系统的设计更加模块化，方便扩展和维护。</p> <p>AOP通过定义切面（Aspect）来实现对横切关注点的处理。切面可以看作是跨越多个类的一种模块化单元，它包含了横切关注点的逻辑和具体实现。切面通过切点（Pointcut）来定义和匹配那些需要被拦截和处理的连接点（Join Point）。然后，在切点处，AOP框架会执行相应的增强（Advice），即横切关注点的具体逻辑。</p> <p>AOP可以在不修改原有代码的情况下，通过将横切关注点与核心业务逻辑解耦，实现对系统行为的动态管理和控制。它能够提高代码的可重用性、可维护性和可扩展性，并且使得系统的关注点更加清晰和可理解。</p> <p>常见的AOP框架包括Java中的Spring AOP和ASP.NET中的PostSharp等，它们提供了方便的机制来实现切面的定义、拦截和增强。</p> <h3 id="领域驱动-ddd"><a href="#领域驱动-ddd" class="header-anchor">#</a> 领域驱动（DDD）</h3> <p>领域驱动设计（Domain-Driven Design，简称DDD）是一种软件开发方法论，旨在解决复杂领域的软件系统设计和开发问题。它将软件系统的设计和实现过程聚焦于问题领域本身，通过划分和建模领域模型来驱动软件开发。</p> <p>在DDD中，&quot;领域&quot;指的是软件系统开发的核心业务领域。该方法着重于理解和解决业务问题，而不仅仅是关注技术实现。DDD提倡开发团队与领域专家密切合作，通过深入了解业务需求和规则，准确建模领域模型，从而实现高度贴合业务的软件系统。</p> <p>DDD的核心概念包括：</p> <ol><li><p>领域模型（Domain Model）：领域模型是对业务领域的抽象和建模，它由实体（Entity）、值对象（Value Object）、聚合根（Aggregate Root）、领域服务（Domain Service）等构成。领域模型反映了业务逻辑和规则，并且是整个系统开发过程的核心。</p></li> <li><p>领域驱动（Domain-Driven）：DDD强调通过领域模型来驱动整个软件开发过程。开发人员使用领域模型来理解和解决业务问题，从而指导软件设计、代码编写和测试等工作。</p></li> <li><p>限界上下文（Bounded Context）：限界上下文是DDD中的一个概念，用于划分和隔离不同的业务子领域。一个限界上下文通常由特定的领域模型、业务规则和语言定义所组成，它为团队提供了一个清晰的边界，使得开发人员可以更好地理解和管理领域模型。</p></li> <li><p>领域驱动设计的战术模式：在DDD中，还存在一些战术模式（Tactical Patterns），如实体、值对象、聚合、工厂、仓储等，用于帮助开发人员更好地实现领域模型的设计和编码。</p></li></ol> <p>DDD的核心思想是通过深入理解业务领域，将专业领域知识融入到软件设计和实现中，从而构建出高质量、可维护和易扩展的软件系统。它适用于复杂领域、变化频繁的业务场景，能够提高开发效率、减少开发风险，并且有助于保持软件系统与业务的一致性。</p> <h2 id="设计模式六大原则"><a href="#设计模式六大原则" class="header-anchor">#</a> 设计模式六大原则</h2> <h3 id="单一职责-single-responsibility-principle"><a href="#单一职责-single-responsibility-principle" class="header-anchor">#</a> 单一职责（Single Responsibility Principle）</h3> <blockquote><p>一个类只负责一个功能领域中的相应职责，或者可以定义为：就一个类而言，应该只有一个引起它变化的原因。</p></blockquote> <p><strong>优点：</strong></p> <ul><li>可以降低类的复杂度；</li> <li>提高类的可读性；</li> <li>提高系统的可维护性；</li> <li>变更引起的风险降低。</li></ul> <h3 id="开闭原则-open-closed-principle"><a href="#开闭原则-open-closed-principle" class="header-anchor">#</a> 开闭原则（open closed principle）</h3> <blockquote><p>一个软件实体应当对扩展开放，对修改关闭。即软件实体应尽量在不修改原有代码的情况下进行扩展。</p></blockquote> <p>优点：</p> <ul><li><p>提高代码复用性；</p></li> <li><p>提高系统的可维护性；</p></li> <li><p>面向对象开发的要求。</p></li></ul> <p><strong>优点汇总</strong></p> <blockquote><ul><li>降低耦合性；</li> <li>提高复用性；</li> <li>提高可扩展性；</li> <li>减少代码冗余；</li> <li>提高可读性；</li> <li>提高可维护性；</li> <li>降低风险。</li></ul></blockquote> <h3 id="里氏替换"><a href="#里氏替换" class="header-anchor">#</a> 里氏替换</h3> <p>所有引用基类（父类）的地方必须能透明地使用其子类的对象。<strong>继承</strong>从整体上来看，利大于弊。</p> <p><strong>原则定义</strong></p> <ol><li>子类可以扩展父类的功能，但不能改变父类的原有功能</li></ol> <ul><li>子类可以继承父类，但是不能覆盖父类的非抽象方法</li></ul> <ol><li>程序中将任意一个基类对象替换成子类对象，程序不会产生任何异常。反过来则不成立。</li></ol> <ul><li>每一个使用基类的地方，都可以透明的使用子类对象</li></ul> <ol><li>里氏代换原则是实现开闭原则的重要方式之一，由于使用基类对象的地方都可以使用子类对象，因此在程序中尽量使用基类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象。</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;普通话:你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HubeiPeople</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">People</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//破坏父类的标准，覆盖了父类的方法</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;湖北话：你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SichuanPeople</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">People</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//破坏父类的标准，覆盖了父类的方法</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;四川话：你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">People</span> people <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    people<span class="token punctuation">.</span><span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token class-name">HubeiPeople</span> hbPeople <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HubeiPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    people<span class="token punctuation">.</span><span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//并非父类定义的标准，覆盖了父类的方法</span>
    <span class="token class-name">SichuanPeople</span> scPeople <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SichuanPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    people<span class="token punctuation">.</span><span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//并非父类定义的标准，覆盖了父类的方法</span>
</code></pre></div><p>上述代码，明显违反了里氏替换原则，子类覆盖了父类的非抽象方法，那么当程序所有使用基类的地方，换上子类的实例，也将改变原程序的结果。根据里氏替换原则，我们更新代码如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">People</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;普通话:你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHICustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HubeiPeople</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">People</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHICustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;湖北话：你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SichuanPeople</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">People</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHICustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;四川话：你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">People</span> hbPeople <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HubeiPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hbPeople<span class="token punctuation">.</span><span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    hbPeople<span class="token punctuation">.</span><span class="token function">SayHICustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">People</span> scPeople <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SichuanPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scPeople<span class="token punctuation">.</span><span class="token function">SayHIStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scPeople<span class="token punctuation">.</span><span class="token function">SayHICustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>总结</strong></p> <p><strong>不要覆盖父类中的方法</strong>，如果要改写，则在父类中编写虚方法，子类重写虚方法；父类中写抽象方法，子类实现抽象方法。</p> <p><strong>实现原理</strong></p> <ol><li><p>尽量声明的时候用父类，而不是具体的子类</p></li> <li><p>子类不要覆盖父类的方法，如果有需要，父类的方法应该定义为abstract/virtual，子类override.</p></li></ol> <p><strong>里氏替换原则的优点</strong></p> <ol><li>代码共享，减少创建类的工作量，每个子类都拥有父类的方法和属性；</li> <li>提高代码的重用性；</li> <li>子类可以形似父类，但又异于父类。</li> <li>提高代码的可扩展性。</li> <li>提高产品或项目的开放性。</li></ol> <p><strong>里氏替换原则的缺点</strong></p> <ol><li>继承是侵入性的。只要继承，就必须拥有父类的所有属性和方法；</li> <li>降低代码的灵活性。子类必须拥有父类的属性和方法。</li> <li>增强了耦合性。当父类的常量、变量和方法被修改时，需要考虑子类的修改，可能导致大段的代码需要重构。</li></ol> <h3 id="迪米特法则"><a href="#迪米特法则" class="header-anchor">#</a> 迪米特法则</h3> <p><strong>原则定义</strong></p> <p><strong>迪米特法则</strong>又叫做最少知道原则，就是说一个对象应当对其它对象有尽可能少的了解，不要和陌生人说话。</p> <p>强调只和朋友说话，不和陌生人说话。这里的朋友指的是:出现在成员中<strong>变量</strong>，<strong>方法输入</strong>，<strong>输出参数</strong>中的类称为成员朋友类，而出现在方法体内部的类不属于朋友类。</p> <p><strong>实现原理</strong></p> <p>迪米特法则初衷在于降低类之间的耦合。由于每个类尽量减少对其它类的依赖，因此。很容易使得系统的功能模块独立，相互之间不存在(或很少有)依赖关系。</p> <p>从迪米特法则的定义和特点可知，它强调以下两点：</p> <ol><li><p>从依赖者的角度来说，只依赖应该依赖的对象。</p></li> <li><p>从被依赖者的角度说，只暴露应该暴露的方法。</p></li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code>  <span class="token comment">//总公司员工</span>
    <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token return-type class-name">String</span> id<span class="token punctuation">{</span><span class="token keyword">get</span><span class="token punctuation">;</span><span class="token keyword">set</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//分公司员工</span>
    <span class="token keyword">class</span> <span class="token class-name">SubEmployee</span><span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token return-type class-name">String</span> id<span class="token punctuation">{</span><span class="token keyword">get</span><span class="token punctuation">;</span><span class="token keyword">set</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token comment">//分公司</span>
    <span class="token keyword">class</span> <span class="token class-name">SubCompanyManager</span><span class="token punctuation">{</span>
        <span class="token comment">//初始化员工ID</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List</span> <span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">SubEmployee</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SubEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//为分公司人员按顺序分配一个ID</span>
                emp<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;分公司&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//打印分公司员工</span>
        
    <span class="token punctuation">}</span>
    <span class="token comment">//总公司</span>
    <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span><span class="token punctuation">{</span>
        <span class="token class-name">SubCompanyManager</span> sub <span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SubCompanyManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//总公司员工分配ID</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List</span> <span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">Employee</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//为总公司人员按顺序分配一个ID</span>
                emp<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;总公司&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//打印所有员工</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">printAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//调用分公司员工初始化方法</span>
            <span class="token class-name">List</span> list1 <span class="token operator">=</span> sub<span class="token punctuation">.</span><span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//打印:问题出在这里，总公司为什么要打印分公司的员工？</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">SubEmployee</span> e<span class="token punctuation">:</span>list1<span class="token punctuation">)</span><span class="token punctuation">{</span>
                System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//打印总公司</span>
            <span class="token class-name">List</span> list2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token punctuation">:</span>list2<span class="token punctuation">)</span><span class="token punctuation">{</span> 
                System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span><span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">CompanyManager</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CompanyManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printAllEmployee</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SubCompanyManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>现在这个设计的主要问题出在CompanyManager中，根据迪米特法则，只与直接的朋友发生通信，而SubEmployee类并不是CompanyManager类的直接朋友（以局部变量出现的耦合不属于直接朋友），从逻辑上讲总公司只与他的分公司耦合就行了，与分公司的员工并没有任何联系，这样设计显然是增加了不必要的耦合。按照迪米特法则，应该避免类中出现这样非直接朋友关系的耦合。修改后的代码如下:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">class</span> <span class="token class-name">SubCompanyManager</span><span class="token punctuation">{</span>
        <span class="token comment">//初始化员工</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List</span> <span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">SubEmployee</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SubEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//为分公司人员按顺序分配一个ID</span>
                emp<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;分公司&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//打印分公司员工</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">printEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">SubEmployee</span> e<span class="token punctuation">:</span>list<span class="token punctuation">)</span><span class="token punctuation">{</span>
                System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span><span class="token punctuation">{</span>
     <span class="token comment">//初始化总公司</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List</span> <span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">Employee</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//为总公司人员按顺序分配一个ID</span>
                emp<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;总公司&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
       <span class="token comment">//调用分公司的打印方法</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">printAllEmployee</span><span class="token punctuation">(</span><span class="token class-name">SubCompanyManager</span> sub<span class="token punctuation">)</span><span class="token punctuation">{</span>
            sub<span class="token punctuation">.</span><span class="token function">printEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span> list2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAllEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token punctuation">:</span>list2<span class="token punctuation">)</span><span class="token punctuation">{</span>
                System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>修改后，为分公司增加了打印人员ID的方法，总公司直接调用来打印，从而避免了与分公司的员工发生耦合。</p> <p>迪米特法则的初衷是降低类之间的耦合，由于每个类都减少了不必要的依赖，因此的确可以降低耦合关系。但是凡事都有度，虽然可以避免与非直接的类通信，但是要通信，必然会通过一个&quot;中介&quot;来发生联系，例如本例中，总公司就是通过分公司这个&quot;中介&quot;来与分公司的员工发生联系的。过分的使用迪米特原则，会产生大量这样的中介和传递类，导致系统复杂度变大。所以在采用迪米特法则时要反复权衡，既做到结构清晰，又要高内聚低耦合。</p> <h3 id="接口隔离"><a href="#接口隔离" class="header-anchor">#</a> 接口隔离</h3> <p><strong>原则定义</strong></p> <p>接口隔离原则要求程序员尽量将臃肿庞大的接口拆分成更小的和更具体的接口，让接口中只包含客户感兴趣的方法。</p> <p>客户端不应该被迫依赖于它不使用的方法。该原则还有另外一个定义：一个类对另一个类的依赖应该建立在最小的接口上。</p> <p>要为各个类建立它们需要的专用接口，而不要试图去建立一个很庞大的接口供所有依赖它的类去调用。</p> <p><strong>实现原理</strong></p> <p>在具体应用接口隔离原则时，应该根据以下几个规则来衡量。</p> <ol><li>接口尽量小，但是要有限度。一个接口只服务于一个子模块或业务逻辑。</li> <li>为依赖接口的类定制服务。只提供调用者需要的方法，屏蔽不需要的方法。</li> <li>了解环境，拒绝盲从。每个项目或产品都有选定的环境因素，环境不同，接口拆分的标准就不同深入了解业务逻辑。</li> <li>提高内聚，减少对外交互。使接口用最少的方法去完成最多的事情。</li></ol> <h3 id="依赖倒置dependence-inversion-principle"><a href="#依赖倒置dependence-inversion-principle" class="header-anchor">#</a> 依赖倒置Dependence Inversion Principle</h3> <p><strong>原则定义</strong></p> <ul><li><p>高层模块不应该依赖低层模块，两者都应该依赖其抽象</p> <p>​                                         UI层不要实例化Service</p></li> <li><p>抽象不应该依赖细节      接口不能继承类</p></li> <li><p>细节应该依赖抽象          类要继承接口</p></li></ul> <p><strong>实现原理</strong></p> <p>每一个逻辑的实现都是由原子逻辑组成的，不可分割的原子逻辑就是低层模块(一般是接口，抽象类)，原子逻辑的组装就是高层模块。在Java和C#语言中，抽象就是指<strong>接口和或抽象类</strong>，两者都不能被直接实例化。细节就是<strong>实现类</strong>，实现接口或继承抽象类而产生的类就是细节，可以被直接实例化。下面是依赖倒置原则在Java语言中的表现：</p> <ul><li>模块间的依赖通过抽象发生，实现类之间不发生直接的依赖关系，其依赖关系是通过接口或抽象类产生的</li> <li>接口或抽象类不依赖于实现类</li> <li>实现类依赖于接口或抽象类</li></ul> <p><strong>示例</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span> <span class="token punctuation">{</span>
  <span class="token comment">//司机的主要职责就是驾驶汽车</span>
   <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token class-name">Benz</span> benz<span class="token punctuation">)</span><span class="token punctuation">{</span>
      benz<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Benz</span> <span class="token punctuation">{</span>
    <span class="token comment">//汽车肯定会跑</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;奔驰汽车开始运行...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//高层模块</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">Driver</span> xiaoLi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">Benz</span> benz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Benz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//小李开奔驰车</span>
    xiaoLi<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span>benz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果小李想换个宝马开怎么办？</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BMW</span> <span class="token punctuation">{</span>
    <span class="token comment">//宝马车当然也可以开动了</span>
   <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;宝马汽车开始运行...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的设计思想没有使用依赖倒置，模块与模块之间耦合度太高，生产力太低，只要需求一变就需要大面积重构，说明这样的设计是不合理。</p> <p>依赖倒置原则</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//将司机模块抽象为一个接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IDriver</span> <span class="token punctuation">{</span>
     <span class="token comment">//是司机就应该会驾驶汽车</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span> ： IDriver<span class="token punctuation">{</span>
    <span class="token comment">//司机的主要职责就是驾驶汽车</span>
    <span class="token comment">//开的是什么车？</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> car<span class="token punctuation">)</span><span class="token punctuation">{</span>
        car<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//将汽车模块抽象为一个接口：可以是奔驰汽车，也可以是宝马汽车</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICar</span> <span class="token punctuation">{</span>
      <span class="token comment">//是汽车就应该能跑</span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Benz</span> ： ICar<span class="token punctuation">{</span>
    <span class="token comment">//汽车肯定会跑</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;奔驰汽车开始运行...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BMW</span> ： ICar<span class="token punctuation">{</span>
   <span class="token comment">//宝马车当然也可以开动了</span>
   <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;宝马汽车开始运行...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//高层模块</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">IDriver</span> xiaoLi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">ICar</span> benz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Benz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//小李开奔驰车</span>
      xiaoLi<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span>benz<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在新增低层模块时，只修改了高层模块(业务场景类)，对其他低层模块(Driver类)不需要做任何修改，可以把&quot;变更&quot;的风险降低到最低。</p> <p>总结：所谓的依赖倒置中的倒置，指的是原本司机开什么车是由司机决定的，但是现在是由接口接收的注入对象决定的。</p> <h2 id="设计模式"><a href="#设计模式" class="header-anchor">#</a> 设计模式</h2> <h3 id="mvc模式"><a href="#mvc模式" class="header-anchor">#</a> MVC模式</h3> <p>MVC 模式代表 Model-View-Controller（模型-视图-控制器） 模式。这种模式用于应用程序的分层开发。</p> <ul><li><strong>Model（模型）</strong> - 模型代表一个存取数据的对象或 JAVA POJO。它也可以带有逻辑，在数据变化时更新控制器。</li> <li><strong>View（视图）</strong> - 视图代表模型包含的数据的可视化。</li> <li><strong>Controller（控制器）</strong> - 控制器作用于模型和视图上。它控制数据流向模型对象，并在数据变化时更新视图。它使视图与模型分离开。</li></ul> <p><img src="https://www.runoob.com/wp-content/uploads/2014/08/1200px-ModelViewControllerDiagram2.svg_.png" alt="img"></p> <h4 id="三层架构和mvc模式区别"><a href="#三层架构和mvc模式区别" class="header-anchor">#</a> 三层架构和MVC模式区别</h4> <p>数据访问层：对数据库的基本操作</p> <p>业务逻辑层：对业务逻辑进行封装，组合数据访问层层中基本功能，形成复杂的业务逻辑功能</p> <p>表现层：接收请求，封装数据，调用业务逻辑层，响应数据</p> <h3 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h3> <h4 id="介绍-2"><a href="#介绍-2" class="header-anchor">#</a> 介绍</h4> <p>单例模式（Singleton Pattern）是 Java 中最简单的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p> <p>这种模式涉及到一个单一的类，该类负责创建自己的对象，同时确保只有单个对象被创建。这个类提供了一种访问其唯一的对象的方式，可以直接访问，不需要实例化该类的对象。</p> <p><strong>注意：</strong></p> <ul><li>1、单例类只能有一个实例。</li> <li>2、单例类必须自己创建自己的唯一实例。</li> <li>3、单例类必须给所有其他对象提供这一实例。</li></ul> <p>**意图：**保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p> <p>**主要解决：**一个全局使用的类频繁地创建与销毁。</p> <p>**何时使用：**当您想控制实例数目，节省系统资源的时候。</p> <p>**如何解决：**判断系统是否已经有这个单例，如果有则返回，如果没有则创建。</p> <p>**关键代码：**构造函数是私有的。</p> <p><strong>应用实例：</strong></p> <ul><li>1、一个班级只有一个班主任。</li> <li>2、Windows 是多进程多线程的，在操作一个文件的时候，就不可避免地出现多个进程或线程同时操作一个文件的现象，所以所有文件的处理必须通过唯一的实例来进行。</li> <li>3、一些设备管理器常常设计为单例模式，比如一个电脑有两台打印机，在输出的时候就要处理不能两台打印机打印同一个文件。</li></ul> <p><strong>优点：</strong></p> <ul><li>1、在内存里只有一个实例，减少了内存的开销，尤其是频繁的创建和销毁实例（比如管理学院首页页面缓存）。</li> <li>2、避免对资源的多重占用（比如写文件操作）。</li></ul> <p>**缺点：**没有接口，不能继承，与单一职责原则冲突，一个类应该只关心内部逻辑，而不关心外面怎么样来实例化。</p> <p><strong>使用场景：</strong></p> <ul><li>1、要求生产唯一序列号。</li> <li>2、WEB 中的计数器，不用每次刷新都在数据库里加一次，用单例先缓存起来。</li> <li>3、创建的一个对象需要消耗的资源过多，比如 I/O 与数据库的连接等。</li></ul> <p>**注意事项：**getInstance() 方法中需要使用同步锁 synchronized (Singleton.class) 防止多线程同时进入造成 instance 被多次实例化。</p> <h4 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h4> <p>我们将创建一个 <em>SingleObject</em> 类。<em>SingleObject</em> 类有它的私有构造函数和本身的一个静态实例。</p> <p><em>SingleObject</em> 类提供了一个静态方法，供外界获取它的静态实例。<em>SingletonPatternDemo</em> 类使用 <em>SingleObject</em> 类来获取 <em>SingleObject</em> 对象。</p> <p><img src="https://www.runoob.com/wp-content/uploads/2014/08/62576915-36E0-4B67-B078-704699CA980A.jpg" alt="单例模式的 UML 图"></p> <h4 id="单例模式的几种实现方式"><a href="#单例模式的几种实现方式" class="header-anchor">#</a> 单例模式的几种实现方式</h4> <p>单例模式的实现有多种方式，如下所示：</p> <h5 id="_1、懒汉式-线程不安全"><a href="#_1、懒汉式-线程不安全" class="header-anchor">#</a> 1、懒汉式，线程不安全</h5> <p>**是否 Lazy 初始化：**是</p> <p>**是否多线程安全：**否</p> <p>**实现难度：**易</p> <p>**描述：**这种方式是最基本的实现方式，这种实现最大的问题就是不支持多线程。因为没有加锁 synchronized，所以严格意义上它并不算单例模式。
这种方式 lazy loading 很明显，不要求线程安全，在多线程不能正常工作。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>      
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>      
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>        
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          
        <span class="token punctuation">}</span>          
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre></div><p><strong>接下来介绍的几种实现方式都支持多线程，但是在性能上有所差异。</strong></p> <h5 id="_2、懒汉式-线程安全"><a href="#_2、懒汉式-线程安全" class="header-anchor">#</a> 2、懒汉式，线程安全</h5> <p>**是否 Lazy 初始化：**是</p> <p>**是否多线程安全：**是</p> <p>**实现难度：**易</p> <p>**描述：**这种方式具备很好的 lazy loading，能够在多线程中很好的工作，但是，效率很低，99% 情况下不需要同步。
优点：第一次调用才初始化，避免内存浪费。
缺点：必须加锁 synchronized 才能保证单例，但加锁会影响效率。
getInstance() 的性能对应用程序不是很关键（该方法使用不太频繁）。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>      
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>      
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          
        <span class="token punctuation">}</span>          
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_3、饿汉式"><a href="#_3、饿汉式" class="header-anchor">#</a> 3、饿汉式</h5> <p>**是否 Lazy 初始化：**否</p> <p>**是否多线程安全：**是</p> <p>**实现难度：**易</p> <p>**描述：**这种方式比较常用，但容易产生垃圾对象。
优点：没有加锁，执行效率会提高。
缺点：类加载时就初始化，浪费内存。
它基于 classloader 机制避免了多线程的同步问题，不过，instance 在类装载时就实例化，虽然导致类装载的原因有很多种，在单例模式中大多数都是调用 getInstance 方法， 但是也不能确定有其他的方式（或者其他的静态方法）导致类装载，这时候初始化 instance 显然没有达到 lazy loading 的效果。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>      
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>      
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_4、双检锁-双重校验锁-dcl-即-double-checked-locking"><a href="#_4、双检锁-双重校验锁-dcl-即-double-checked-locking" class="header-anchor">#</a> 4、双检锁/双重校验锁（DCL，即 double-checked locking）</h5> <p>**JDK 版本：**JDK1.5 起</p> <p>**是否 Lazy 初始化：**是</p> <p>**是否多线程安全：**是</p> <p>**实现难度：**较复杂</p> <p>**描述：**这种方式采用双锁机制，安全且在多线程情况下能保持高性能。
getInstance() 的性能对应用程序很关键。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> singleton<span class="token punctuation">;</span>      
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>      
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              
                <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  
                    singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              
                <span class="token punctuation">}</span>          
            <span class="token punctuation">}</span>      
        <span class="token punctuation">}</span>      
        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre></div><h5 id="c-实现单例模式"><a href="#c-实现单例模式" class="header-anchor">#</a> C#实现单例模式</h5> <p>饿汉</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 在静态变量中直接创建实例</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Singleton</span> <span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>懒汉</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Singleton</span> <span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="代理模式"><a href="#代理模式" class="header-anchor">#</a> 代理模式</h3> <p>在代理模式（Proxy Pattern）中，一个类代表另一个类的功能。这种类型的设计模式属于结构型模式。</p> <p>在代理模式中，我们创建具有现有对象的对象，以便向外界提供功能接口。</p> <h4 id="介绍-3"><a href="#介绍-3" class="header-anchor">#</a> 介绍</h4> <p>**意图：**为其他对象提供一种代理以控制对这个对象的访问。</p> <p>**主要解决：**在直接访问对象时带来的问题，比如说：要访问的对象在远程的机器上。在面向对象系统中，有些对象由于某些原因（比如对象创建开销很大，或者某些操作需要安全控制，或者需要进程外的访问），直接访问会给使用者或者系统结构带来很多麻烦，我们可以在访问此对象时加上一个对此对象的访问层。</p> <p>**何时使用：**想在访问一个类时做一些控制。</p> <p>**如何解决：**增加中间层。</p> <p>**关键代码：**实现与被代理类组合。</p> <p><strong>应用实例：</strong> 1、Windows 里面的快捷方式。 2、猪八戒去找高翠兰结果是孙悟空变的，可以这样理解：把高翠兰的外貌抽象出来，高翠兰本人和孙悟空都实现了这个接口，猪八戒访问高翠兰的时候看不出来这个是孙悟空，所以说孙悟空是高翠兰代理类。 3、买火车票不一定在火车站买，也可以去代售点。 4、一张支票或银行存单是账户中资金的代理。支票在市场交易中用来代替现金，并提供对签发人账号上资金的控制。 5、spring aop。</p> <p><strong>优点：</strong> 1、职责清晰。 2、高扩展性。 3、智能化。</p> <p><strong>缺点：</strong> 1、由于在客户端和真实主题之间增加了代理对象，因此有些类型的代理模式可能会造成请求的处理速度变慢。 2、实现代理模式需要额外的工作，有些代理模式的实现非常复杂。</p> <p>**使用场景：**按职责来划分，通常有以下使用场景： 1、远程代理。 2、虚拟代理。 3、Copy-on-Write 代理。 4、保护（Protect or Access）代理。 5、Cache代理。 6、防火墙（Firewall）代理。 7、同步化（Synchronization）代理。 8、智能引用（Smart Reference）代理。</p> <p><strong>注意事项：</strong> 1、和适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口。 2、和装饰器模式的区别：装饰器模式为了增强功能，而代理模式是为了加以控制。</p> <h4 id="实现-2"><a href="#实现-2" class="header-anchor">#</a> 实现</h4> <p>我们将创建一个 <em>Image</em> 接口和实现了 <em>Image</em> 接口的实体类。<em>ProxyImage</em> 是一个代理类，减少 <em>RealImage</em> 对象加载的内存占用。</p> <p><em>ProxyPatternDemo</em> 类使用 <em>ProxyImage</em> 来获取要加载的 <em>Image</em> 对象，并按照需求进行显示。</p> <p><img src="https://www.runoob.com/wp-content/uploads/2014/08/20211025-proxy.svg" alt="代理模式的 UML 图"></p> <p>定义抽象接口类，该类在代理模式中扮演的是一个抽象功能的角色，该案例中就是把出售手机抽象为了一个接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 售卖手机的接口(代理模式——抽象角色)
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IPhone</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">sellPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义苹果手机公司类，该类在代理模式中扮演的是一个目标角色，实现了IPhone接口，重写出售手机的方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 苹果公司（代理模式——目标角色）
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TargetPhone</span> <span class="token keyword">implements</span> <span class="token class-name">IPhone</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sellPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;苹果公司正在出售手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义代理类，通过代理类进而调用目标类的出售手机的方法，并加上自己的扩展功能</p> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 代理商（代理模式——代理角色）
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyPhone</span> <span class="token keyword">implements</span> <span class="token class-name">IPhone</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">IPhone</span> iPhone<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ProxyPhone</span><span class="token punctuation">(</span><span class="token class-name">IPhone</span> iPhone<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>iPhone <span class="token operator">=</span> iPhone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sellPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;代理商正在循环播放广告，赚取广告商广告费&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;代理商正在推荐自己的电子周边产品，赚取费用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhone<span class="token punctuation">.</span><span class="token function">sellPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;代理商正在卖出苹果手机，赚取差价&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代理商赚钱的奥秘尽在下图红框中，卖出了苹果手机赚钱，卖出了其他东西赚钱，广告费也赚钱</p> <p>定义测试类</p> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 测试类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TargetPhone</span> targetPhone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TargetPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProxyPhone</span> proxyPhone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyPhone</span><span class="token punctuation">(</span>targetPhone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyPhone<span class="token punctuation">.</span><span class="token function">sellPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="工厂模式"><a href="#工厂模式" class="header-anchor">#</a> 工厂模式</h3> <h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="header-anchor">#</a> 抽象工厂模式</h3> <p><strong>在实例化某一个类的时候，不直接实例化，而是由抽象工厂进行实例化。</strong></p> <p>优点：安全</p> <p>​           生产的类一定是受到某种约束</p> <p><strong>三层架构中的接口层</strong></p> <p>接口层主要是对DAL进行行为约束</p> <p>该模式也叫做：抽象工厂三层架构模式</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/前端笔记.html" class="prev">
        前端笔记
      </a></span> <span class="next"><a href="/blog/数据库.html">
        数据库
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3e89323d.js" defer></script><script src="/assets/js/2.733019b2.js" defer></script><script src="/assets/js/10.4e92518d.js" defer></script>
  </body>
</html>
